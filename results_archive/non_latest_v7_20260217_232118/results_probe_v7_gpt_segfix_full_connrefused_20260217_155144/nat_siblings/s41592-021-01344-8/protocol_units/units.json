{
  "units": [
    {
      "title": "Methods",
      "text": "Methods such as RNA velocity provide an additional layer of infor- tion. Immunohistochemistry has shown that diverse brain regions\nmation to assist with inferring differentiation trajectory and fate can form within these tissues, and the relative positions of certain\npotentials11. However, it is not possible to use these inferences to brain regions suggest that regional patterning gradients emerge that\nidentify direct cell lineages; therefore, it remains difficult to study are reflective of in vivo development23. It was shown in forebrain\nhow lineages are established during organoid self-organization. organoid models that the range of dorsoventral identities can be\nSeveral lineage-coupled single-cell transcriptomic strategies generated within a continuous neuroepithelium and that organizhave emerged to investigate clonal expansion and differentiation ing centers emerge that express secreted growth factors associated\nin mouse and zebrafish embryos as well as complex multicellu- with dorsoventral patterning22. Single-cell transcriptome analysis\nlar culture systems12–16. These efforts rely on either expression of over a time course of cerebral organoid development confirmed\nreporter transcripts tagged with a unique sequence barcode12,16, that diverse brain regions form within individual organoids5 and\nscarring patterns generated by CRISPR–Cas9 genomic modi- that brain region signatures in organoids strongly resemble counfication of expressed targets13–15 or a combination of the two15,17. terparts from spatial in situ atlases of the developing mouse brain24.\nLineage-coupled scRNA-seq has allowed for better annotation of However, very little is known about spatiotemporal lineage dynamcell fate specifications and trajectory inferences in complex tissues ics during organoid formation and patterning or how these dynamand other cell differentiation scenarios. Additionally, image-based ics relate to the establishment of neuronal fates.\nmethods such as four-dimensional (4D) light-sheet microscopy We used iTracer to explore lineages coupled with molecular\nprovide a complementary approach to capture comprehensive signatures during brain organoid patterning and neurogenesis and\ndevelopmental dynamics in tissues and embryos18,19. Long-term show that the system is compatible with spatial transcriptomics.\nlive 4D light-sheet microscopy of a sample with minimum pho- We also leverage 4D light-sheet microscopy to provide an assesstotoxicity over days allows for observation and quantification of ment of clonal and morphological dynamics as the neuroepithedynamic cellular behaviors at high spatiotemporal resolution20,21. lium develops at the onset of brain regionalization. We incorporate\nSubsequent analysis allows for visualization, annotation and accu- CRISPR-based gene perturbation into the lineage-recorder system\nrate lineage reconstruction of development. Lineage-coupled (iTracer-perturb) to enable temporal control of gene loss of funcsingle-cell transcriptomics and long-term light-sheet microscopy tion during organoid development, providing both transcriptomic\n\nDepartment of Biosystems Science and Engineering, ETH Zürich, Basel, Switzerland. 2Max Planck Institute for Evolutionary Anthropology, Leipzig, Germany.\n1\n\n3\n Institute of Molecular and Clinical Ophthalmology, Basel, Switzerland. 4Department of Ophthalmology, University of Basel, Basel, Switzerland. 5These authors\ncontributed equally: Zhisong He, Ashley Maynard, Akanksha Jain, Tobias Gerber. ✉e-mail: jarrettgrayson.camp@unibas.ch; barbara.treutlein@bsse.ethz.ch\n\n90 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\na d\n Clusters\n e Reporter\n iTracing AAA\n 2.5 detected\n\n No. cells (×104)\n vector U6 RPBSA Barcode Inducible gRNA iTracer NES 100%\n\n Detection rate\n DCX 2.0\n ITR gRNA GFP ITR Cas9 iPSCs iPSCs\n GLI3 1.5\n FOXG1 1.0\n RSPO3 Bc.\n 0.5\nb Cerebral organoid\n OTX2\n HOXB2\n 25% 0\n Scarred\n iTracer EB N. ecto. N. epith.\n HOXB5\n iPSCs Cells SIX6 f\n scRNA-seq t = n TTR Both (2)\n\n No. of scars (×103)\n Max 16\n scar MSX1\n\n Insertion Deletion\n Expression\n PRPH 12\nTime t 0 5 8 10 12 15 20 25 30 60 t=0 SOX10\n (d) barcode EPCAM 8\n Dox-induced scarring AIF1\n DCN 4\n Min 0\n 25\nc Microglia Days 30–60 h Barcode families i Barcode families\n scRNA-seq\n 8 Org1–1 Org2–1\n Org1–2 Org2–2\n Mesenchyme Rhombencephalon Other Other\n neurons\n Epithelial\n 24 21 Diencephalon–\n Retina 1\n Neural crest mesencephalon\n 20 derivatives 13 neurons\n 4\n Rhomben- 5\n cephalon 16\n NPCs 11 Dorsal\n 7 3 6 Organoid 1 Organoid 2\n 14 telencephalon\n 15 neurons\n 23 19\n Diencephalon 10 22\n NPCs\n 17 2 g Rhomben. Proportion of cells Proportion of cells\n 0 0.2 0.4 0.6 0.8 1.0 0 0.2 0.4 0.6 0.8 1.0\n 9\n 18 Dorsal telen.\n 12 Normalized\n BF sharing Org1–1 Telencephalon Org2–1 Mesenchyme\n\n *\n UMAP 2\n\n *\n Dorsal Telen. All Mesen.\n Min Max All\n telencephalon barcodes\n barcodes Rhomben. Rhomben.\n NPCs Non-neural\n\n *\n UMAP 1\n\n *\n Org1–2 Rhombencephalon Org2–2 Rhombencephalic\n\nvector used for lineage recording. ITR, inverted terminal repeat. b, Scarring is induced at different time points of organoid development through doxycycline\n(dox) induction of Cas9. N. ecto., neuroectoderm; N. epith., neuroepithelial. c, UMAP embedding of scRNA-seq data of 44,275 cells from 12 cerebral\norganoids after data integration using CSS16. Cells are colored and numbered by transcriptome cluster and labeled with brain region and cell type\nannotations. d, Dot plot shows expression of genes marking clusters observed in organoids. e, Stacked bar plot showing the number of cells in which the\niTracer reporter was detected (light gray), with only barcodes (Bc., dark gray) or barcodes and scars (black). Max, maximum; min, minimum. f, Stacked\nbar plot showing the number of scars created from insertions (light gray), deletions (dark gray) or both. g, Heatmap showing relative proportion of shared\nbarcodes between transcriptome clusters. Rhomben., rhombencephalon; telen., telencephalon. h,i, Top, UMAP embedding as in c, colored by four different\nclones, showing that iPSC clones tend to accumulate in distinct brain regions or cell types. Bottom, bar plots showing proportions of cells of specific\nbarcode families or all barcoded cells annotated with a given regional identity. Mesen., mesenchyme. Fisher’s exact test (two sided) was performed,\ncomparing cell frequencies of a barcode family with those of all barcoded cells in the organoid in different clusters; *P < 0.0001.\n\nand cell lineage readouts. In proof-of-principle experiments, we direction, 91 bases away from the RPBSA promoter, we have introtarget TSC2 (encoding tuberous sclerosis complex 2), a gene asso- duced a human U6 promoter driving a guide RNA (gRNA) that tarciated with neurodevelopmental dysplasias25–27. Using these meth- gets a region in the 3′ portion of the sequence coding for GFP or RFP.\nodologies, we suggest that clone restriction plays a fundamental This iTracer construct is introduced by electroporation into iPSCs\nrole in cerebral organoid regionalization, identify patterning pro- that contain a doxycycline-inducible Cas9 cassette (iCRISPR)29,30.\nfiles that are consistent with in vivo brain development and find Fluorescent cells containing the reporter can be isolated using flow\nthat TSC2 gene perturbations may augment metabolism and delay cytometry before being propagated or cryopreserved for later use\nneural development. (Extended Data Fig. 1a,b). From these uniquely barcoded iPSCs, we\n initiate cerebral organoids using approximately 2,000 cells to record\nResults lineages during organoid development (Fig. 1b). At a time point of\niTracer: a dynamic dual-channel lineage recorder. We established choice, doxycycline introduction into the medium induces Cas9\na dual-channel lineage recorder called iTracer by coupling a com- expression in organoid cells, followed by formation of Cas9–gRNA\nplex barcode library together with an inducible Cas9 scarring sys- complexes, leading to double-stranded break formation at the tartem in iPSCs (Fig. 1a). The lineage recorder is based on the Sleeping geted location in the fluorescent reporter region of the recorder.\nBeauty transposon system, which enables efficient transposition28 These breaks are repaired by cellular machinery, resulting in inserof exogenous DNA into multiple genomic loci within iPSCs. A tions and/or deletions at the cut site, so-called scars, which serve\npoly-adenylated green or red fluorescent protein (GFP or RFP) as the second channel of our lineage recorder and can be read by\nreporter is driven by the RPBSA promoter and contains a barcode sequencing the reporter transcript. Multiple barcodes and induced\n(11 nucleotides of random bases) in the 3′ untranslated region, scars per cell could in principle be detected due to multiple inserwhich serves as the first channel of the recorder. In the opposite tions of the transposon-based reporter.\n\nNature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 91\n\nArticles NaTuRE METHODS\n\n We measured barcode diversity using scRNA-seq data from resulted in a similar proportion of insertion and deletion scar types,\nthree iTracer iPSC pools and found approximately 60,000 unique which varied in overall length (Fig. 1f and Extended Data Fig. 3f,g).\nsequences (Methods). We followed barcode diversity throughout Scarring efficiency varied per organoid (Supplementary Table 1);\norganoid development using targeted amplicon sequencing of the yet, of those cells in which we detected a barcode, 17% were also\nbarcode region (Extended Data Fig. 1b,c) and found relatively stable scarred. We found 237 groups of cells sharing the same scar and\ndiversity over the course of organoid development from pluripo- barcode composition, which were termed scar families.\ntency (Extended Data Fig. 1c). Further scRNA-seq characteriza- We first focused on barcodes, which mark clones derived from\ntion of an iTracer iPSC pool revealed 2.85 barcodes per cell; the one given cell in the initializing EB, and explored the clonality of\naverage group size of the cells that shared the same barcode was transcriptionally distinct organoid cell clusters. We performed\n1.54 cells. Cells with a higher number of barcodes also had higher a permutation enrichment analysis using single cells from all\nexpression of iTracer fluorescent reporter mRNA (Extended Data lineage-traced organoids together to determine the likelihood that\nat the embryoid body (EB) and neuroectoderm stages of cerebral Extended Data Fig. 4a,b). We identified three groups of cell clusters\norganoid development by testing the duration and concentration of with significant enrichment of distinct barcode clones. Each group\ndoxycycline treatment (Extended Data Fig. 1e,f). We found scar- labeled distinct brain regional identities, indicating that there was\nring was most efficient when samples were incubated with 8 µg ml−1 a robust trend during organoid development during which initiatdoxycycline for 24 h and applied these conditions in all subsequent ing iPSC clones accumulate in distinct brain regions. Importantly,\nexperiments. Together, these data established suitable conditions for these results could not be solely explained by differences in cell type\nlineage-coupled single-cell transcriptomics in iPSC-derived cells composition between organoids. We illustrated regional barcode\nand tissues using the iTracer system. accumulation by projecting four different barcode families on the\n overall uniform manifold approximation and projection (UMAP)\niTracer reveals clonality of distinct cell populations. We next embedding and observed that iPSC clones were distributed into disset out on a series of experiments using iTracer to study lineage tinct brain regions or cell types (Fig. 1h,i).\ndynamics during cerebral organoid development from pluripotency.\nOrganoids were generated from approximately 2,000 iPSCs contain- Spatial iTracer identifies clone enrichment in organoid regions.\ning the iTracer recorder. We induced scarring at different organoid We hypothesized that enrichment of barcodes in molecularly disdevelopmental time points (day 4, 7, 15, 20 or 30) and subsequently tinct cell populations with different brain regional identities may\nperformed scRNA-seq after 1, 1.5 or 2 months of culture (Fig. 1b). be associated with the spatial arrangement of clones throughout the\nTime points of scarring induction were selected around critical steps organoid. To link molecular state, cell lineage and location informaof organoid development including EB formation (day 4), neural tion, we established ‘Spatial iTracer’, which uses spatial transcripinduction (day 7), neuroepithelium development (day 15) and neu- tome sequencing based on the 10x Visium platform to measure gene\nrogenesis (days 20 and 30). We used cluster similarity spectrum expression and iTracer readouts. We applied Spatial iTracer to three\n(CSS) analysis31 to integrate 44,275 cells from 12 organoids across two intact 10-µm tissue sections derived from one 2-month-old cerebatches (Fig. 1c, Extended Data Fig. 2a,b and Supplementary Tables 1 bral organoid scarred during the neuroepithelium stage (day 15)\nand 2), resulting in 25 cell clusters. Based on marker gene analysis (Fig. 2a and Supplementary Tables 1 and 4). Briefly, each tissue secand comparisons with primary reference atlases (Methods), 90% of tion was adhered to a slide with 6.5 × 6.5-mm capture areas concells were annotated to central nervous system cell types from the taining several thousand spots, where each spot harbors millions\ndorsal telencephalon, diencephalon, mesencephalon, rhombenceph- of capture oligonucleotides each with a unique spatial barcode.\nalon and retina, while a small fraction was annotated as non-brain Tissue sections were permeabilized to facilitate mRNA capture, and\npopulations including neural crest derivatives and mesenchymal captured sequences were amplified and sequenced. We obtained\ncells (Fig. 1c,d and Extended Data Fig. 2c–f). Although proportions transcriptome, barcode and scar topology of 2,038 spots, for which\nof cells with different regional identities varied among individual each spot covers an area of approximately one to ten cells. We used\norganoids, we detected all major cell populations in multiple organ- two independent methods (machine learning-based classification\noids, consistent with previous reports using cerebral organoids5,32. and CIBERSORTx35) to assign each spot to cell clusters identified\n Overall, we detected iTracer readouts in 22,489 cells (51%) in cerebral organoids using scRNA-seq (Fig. 2a and Extended Data\nfrom this dataset (Extended Data Fig. 3a). Between organoids, we Fig. 5a). Spots were assigned to the telencephalon, diencephalon–\ndetected a variable number of reporter-expressing cells, barcodes mesencephalon and rhombencephalon as well as non-neuronal\nand scars (Extended Data Fig. 3b and Supplementary Table 1). identities, and both deconvolution methods showed agreement\nWe noted that, while the entire starting population of iTracer in region identity assignment (Fig. 2b–d and Extended Data\niPSCs contained the reporter, transgene silencing and sparsity of Fig. 5b–l), suggesting that annotations were robust to computascRNA-seq data are likely contributors to loss of reporter detec- tional approaches. Spots with the same annotation clustered within\ntion33,34. Nonetheless, of those cells in which the reporter transcript the same slice and persisted throughout the depth of the organoid,\nwas detected by scRNA-seq, we identified at least one unique molec- revealing transcriptome regionality. Spots showed varying levels of\nular identifier (UMI) covering the barcode region in 73% of cells neural progenitor cell (NPC) or neuron signatures, revealing areas\n(Fig. 1e and Extended Data Fig. 3c,d). Importantly, we found no in the tissue slice enriched for progenitors and differentiated cells,\nsignificant associations of cell type or regional identity with lack of respectively (Extended Data Fig. 5m). Regional and differentiaiTracer expression (Extended Data Fig. 3e). Due to the nature of the tion heterogeneity largely accounted for overall spot heterogeneity\nSleeping Beauty system, cells can have multiple iTracer insertions, (Extended Data Fig. 5n). In total, 41.7% of spots contained at least\nallowing for unique barcode and scar compositions in individual one barcode, consistent with our iTracer data (Extended Data Fig. 5i\ncells. In those cells in which at least one barcode was detected, we and Supplementary Table 1). Spots with the highest barcode detecfound an average of 2.10 barcodes per cell. Groups of cells that share tion colocalized with the highest expression of the iTracer RFP\nthe same barcode composition, termed barcode families, ranged in reporter (Extended Data Fig. 5h).\nsize from two to 801 and averaged approximately 11 family mem- We explored the spatial distribution of iTracer lineages and\nbers. On average, 77.9% (batch 1) and 97.6% (batch 2) of barcode found that cells belonging to the same barcode family accumulated\nfamilies were unique to a given organoid within a batch, indicating in distinct regions in the organoid slice, whereas cells belonging\na limited overlap of highly diverse barcodes. CRISPR–Cas9 scars to different barcode families were spatially segregated (Fig. 2e,f\n\n92 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\na Bc. Scar Spatial\n b c\n Organoid scRNA-seq Telen. Dien.Ðmesen. Rhomben. Retina FOXG1 EMX1 OTX2 HOXB2\n t reference atlas\nDay 0 15 60\n\n x z High\n Expr\n\n Likelihood\n S3 Max\n ML-based classifier Neural crest Microglia Epithelial Mesenchymal SOX10 AIF1 EPCAM DCN\n y S1 S2 S1\n Other\n signatures 0\n Low\n\n Spatial transcriptome Spot identity likelihood\n sequencing\n\nd Spot annotation e f g h\n Clone location All Same Different Scar families (barcode 6)\n S1 S1 regions region regions\n P < 0.0001\n\n *** *** *** 2.5\n 6\n\n Spatial distance (mm)\n\n Spot distance (mm)\n S2 S2\n 5 2.0\n 4 1.5\n 3\n 1.0\n 2\n S3 Telen. S3 Barcodes 0.5\n 1 1\n Dien.Ðmesen.\n 1/3 0\n Rhomben. 0\n 2\n Neural crest\n\n e\n\n .\n 2/3\n\n iff\n m\n\n D\n Epithelial\n\n e\n e\n\n Sa\n e\n\n Ex ed\n Ex red\n Ex red\n 3\n\n iv\n iv\n\n iv\n Scar-1 Scar-2 Scar-3\n\n us\n us\n\n ar\n us\n Mesenchymal Scar identity\n\n a\n a\n 4\n\n Sh\n Sh\n Sh\n\n cl\n cl\n\n cl\n y Unassigned y Scar-4 Scar-5 Scar-6\n x x Barcode composition Unscarred Other scars\n\nSpatial iTracer. ML, machine learning. b,c, Spot plots for section 1 (S1) colored by projection likelihood to organoid reference clusters (b) or by marker\ngene expression (expr) (c). Dien.–mesen., diencephalon–mesencephalon. d,e, Spot plots for each section (S1–S3), colored by machine learning-based\ndeconvolution for cell type assignment (d), or four example iTracer barcodes highlighting restriction of lineages to specific regions in the organoid (e).\nf, Box plots of pairwise spatial distance between spots found in the three sections, grouped by whether a shared barcode was identified by the spot\npair. Regions that are spatially close to each other share similar barcode composition, whereas spots that are distant in space have decreased barcode\nsimilarity. This occurs when comparing any two spots, regardless of spot-annotated brain region (left), between any two spots in the same annotated\nbrain region (middle) and between any two spots that are assigned to different annotated brain regions (right). Two-sided Wilcoxon rank-sum tests were\nperformed comparing ‘shared’ with ‘same’ and ‘exclusive’ groups (nshared = 53,618 (left), 14,698 (middle) and 18,200 (right) spot pairs from three slices;\nnexclusive = 197,444 (left), 42,178 (middle) and 74,366 (right) spot pairs); ***unadjusted P value < 0.0001. g, Spot plot for each section colored by scar\nfamilies within a single barcode. h, Box plots show the distributions of spatial distances between spots with the same scar or with different (diff.) scars.\nP values represent significance values from two-sided Wilcoxon tests (nshared = 4,200, ndifferent = 24,268 spot pairs from three slices). Boxes in box plots\nrepresent upper and lower quartiles. The center line represents the median. Whiskers show the minimum and maximum of the data if there is no outlier.\nOutliers are defined as data points outside 1.5 times the interquartile range above the upper quartile and below the lower quartile.\n\nand Extended Data Fig. 5o,p). The same spatial distribution was We directly tracked the lineage of a single nucleus throughout\nobserved on the level of scar families, in which spots containing the recording time using Mastodon37, a framework allowing for\nthe same barcode–scar combination were found closer together semi-automated tracking and curation of nuclei lineages in large\nand were more likely to belong to the same brain regional identity 4D datasets (Fig. 3d,e). We visualized the spatial distribution\nthan those with the same barcode but different scars (Fig. 2g,h and of daughter cells derived from the originating nucleus, which\norganoid development, related cells tend to accumulate in the same from 100 h of proliferation (Fig. 3f, Extended Data Fig. 6a and\narea of the organoid, receive similar patterning signals and therefore Supplementary Video 3). The average duration of one cell cycle\non average become restricted to the same brain regional identity. was estimated to be 17.3 h (Extended Data Fig. 6b). We observed\nTogether, iTracer and Spatial iTracer revealed an enrichment of cell that L1 remained confined to the same area of the lumen throughclones in distinct brain regions of the cerebral organoid that can be out the recording time (Fig. 3d and Extended Data Fig. 6c).\ntraced back to clonality within the initializing EB. We tracked three additional nuclei, for which two nuclei were\n neighbors in the same lumen area as L1 (L2–L3) and the third\nLineage tracing with long-term light-sheet microscopy. To directly nucleus (L4) was positioned diametrically opposite in a distinct\nmeasure lineage dynamics and spatial accumulation of clones in a future lumen area in the EB (Fig. 3g, Extended Data Fig. 6c,d\ndeveloping organoid during the neuroectoderm-to-neuroepithelium and Supplementary Video 4). We quantified spatial distances\nstage, we established long-term live imaging of developing cerebral between each tree and inspected the distribution of all daughter\norganoids using 4D light-sheet microscopy (Fig. 3a, Extended Data cells within the organoid 3D space (Fig. 3g–i). During the course\norganoids containing 5% iPSCs that had nuclei labeled with a uniform on average, which all populated the expanding organoid but\nfluorescent reporter, FUS–mEGFP36 and imaged the sparsely labeled remained spatially restricted to the parent lumen, exhibiting limorganoids with an inverted light-sheet microscope (Fig. 3a). EBs ited migration away from their lineage members (Fig. 3g–i and\nwere embedded in Matrigel in the imaging chamber and cultured in Extended Data Fig. 6e,f). These results suggest that early spatial\nneural-induction medium, and development was tracked for 65–100 h arrangement of clones followed by local amplification results in\n(Fig. 3b and Supplementary Video 1). As the EB grew and developed, distinct lineage compositions of brain regions, which confirms\nwe observed the formation of several lumens, each of which could be our previous iTracer-based observation of organoid brain region\ntracked in three dimensions (Fig. 3c). clonality (Fig. 3j).\n\nNature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 93\n\nArticles NaTuRE METHODS\n\n a\n 4D light-sheet\n No label FUS–GFP microscopy Image every 30 min for 100 h\n\n 5%\n Sparsely labeled\n EBs Track nuclei Spatial lineage analysis\n\n b 0h 20 h 40 h 60 h 80 h 100 h\n\n Lumen Lumen\n c 88 h\n area\n\n x\n y\n z\n\n d 0h 40 h 100 h e f\n z\n Time (h)\n 100\n\n 0\n L1\n x\n L1\n\n L1 L1 L1\n y\n\n 0 100\n Time (h)\n g 0 h < t < 65 h z i\n Same Same lumen, Different\n lineage different lineage lumen\n 400\n Internuclear\n distance\n\n x\n 200\n\n 0\n Lineage 0 20 40 60 0 20 40 60 0 20 40 60\n y\n Time (h)\n 1 2 3 4\n\n h j\n Lumenization and\n regionalization\n Density\n\n x y z Proliferation and\n neuroectoderm\n Position formation t\n\nimages from time points at 0–100 h. Labeled nuclei are colored in green. c, Three-dimensional projection and cross-sections of x–y, x–z and y–z planes at\n88 h. The empty lumen cavity and lumen areas are annotated on the image. d, Selected images show the increment in nuclei tracks of L1 from three time\npoints over 100 h. Scale bar, 100 µm in all images (b–d). e, Three-dimensional plot showing spatial distribution of all nuclei in L1 over 100 h. f, Lineage\ntree across time for L1. g, Three-dimensional scatterplot of spatial distribution of nuclei from four lineages (L1–L4) traced over 65 h. Big, medium and\nsmall dots represent time points at 0 h and 65 h and times between 0 and 65 h, respectively. h, Density plot showing the distribution of all four lineages\nin x–y–z planes. i, Scatterplot showing internuclear distance between any two nuclei in the same lineage (L1, L2, L3 and L4), different lineages in the same\nlumen (L1–L3) and for nuclei in different lineages (L1–L3 and L4). Error bands show the first to 99th percentiles. j, Illustration shows proliferation and\nregionalization of tracked lineages in the organoid over 100 h.\n\nLineage dynamics during cerebral organoid patterning. Next, single-cell transcriptomes to construct fate-mapped whole-organoid\nwe used iTracer to determine when cells restrict their fate dur- phylogenies (Fig. 4a,b and Extended Data Fig. 7a–i). We analyzed\ning brain organoid development. We used both channels of the cell type diversity in scar families in which organoids were treated\nlineage recorder (barcodes introduced in the initializing EB and with doxycycline over a scarring time course. In an example of scarscars induced during a developmental time course) together with ring induction at the neuroepithelial stage (day 15), we found one\n\n94 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\na Bc. Scar scRNA-seq\n e f g\n Scarred clones Bc. Scar scRNA-seq Clusters\n t t\n Single Scar\n\n Mb.\n Mouse\n\n Hb.\n 0 15 63 d\n\n NE\n 0 7 15 d Fb.\n cells family organizers\n Org1 Hindbrain\n NE\n POU5F1 HOXB2 D\n\n Floor plate\n Midbrain\n BF1 Scar M\n Barcode R\n Scarred clone Unscarred clone OTX2 FOXG1\n Forebrain\n\n Roof plate Bound\n b Cell type Scar family NE T\n M\n Forebrain\n Hypo- R\n RG\n thalamic FGF17 WNT3A T\n\n UMAP 2\n RG M/R\n Dorsal telencephalon\n Dien.–mesen. Antihem\n Forebrain\n\n t-SNE 2\n Rhombencephalon\n t-SNE 2\n\n UMAP 1\n Neural crest derivatives Samples Similarity (PCC)\n WNT8B BMP7\n Epithelial Mesenchyme\n t-SNE 1 t-SNE 1 –0.10 0.34\n\nc Barcode family d Shared scars between Different scars between h Day 15 BF1 i P = 0.532\n Org1-s15-d60-bc1 different cell types different cell types organoid 14\n Scar Forebrain\n 0.15 12 Hindbrain\n Excess of frequency\n\n Number of cells\n 8 P = 0.555\n Cell type 0 BF1 Barcode\n Scarring time 4\n Days 4–7\n Day 15 Cell\n Unscarred −0.15 Days 20–30 0\n Scarred clone Unscarred clone Scar families\n\n d\n Scar\n\n rre\n −4 −2 0 2 4\n NE Hindbrain Midbrain\n\n ca\n family\n z score (scar similarity distance\n\n ns\n Forebrain\n\n U\n between clusters)\n\nshows full lineage reconstructions from a single organoid scarred at day 15 and sequenced at day 63 (left) as well as the subset of cells in which scars were\ndetected (right). First- and second-order deviation nodes represent barcode and scar families, respectively, with terminal branches indicating individual\ncells. Each cell is colored based on the cell type designation. b, t-distributed stochastic neighbor embeddings (t-SNE) show cells for this organoid colored\nby both cell type annotation and scar families (≥5 members). c, Force-directed graph embedding of cells from a single barcode family within organoid 1\n(Org1), with cells colored by scar family or cell type (inset). Scar families in orange show enrichment in cortical brain regions. d, Frequency distribution of\nz scores of scarring pattern distances between cell clusters after subtraction of background distribution estimated by random sampling of scars. Different\nscarring times are shown separately. Dashed shadow backgrounds show 90% confidence intervals, accordingly colored by scarring time. This plot\nhighlights that scarring at later time points separates lineages with different cell fates. e, UMAP embedding of developing cerebral organoids scarred at\nday 7 and sequenced at day 15, with cells colored by cell types and estimated brain regional identity or samples (inset). RG, radial glia; NE, neuroepithelial.\nf, Expression of regional marker genes and selected morphogen genes. g, Heatmap of relative similarity of organoid clusters to organizing centers\nidentified in developing mouse brains. T, telencephalon; D, diencephalon; M, mesencephalon; R, rhombencephalon; Hb., hindbrain; Mb., midbrain; Fb.,\nforebrain; PCC, Pearson’s correlation coefficient. h, Lineage plot shows full lineage reconstructions from one day 15 organoid (sample 1). The zoomed-in\nview highlights a barcode family with diverse patterning states. i, Bar plot showing region composition of scar families, revealing that cells are not yet\nrestricted at the time point of scarring at day 7. P values show results of two-sided Fisher’s exact tests to compare regional proportions in different scar\nfamilies, with or without consideration of unscarred cells.\n\nscar family restricted to a cortical fate, while other scar families were among different scar families (Fig. 4i). Our results imply that brain\nfound distributed across different cell types (Fig. 4c). We globally regional heterogeneity starts to emerge after the neuroectoderm\nanalyzed scar families and found that fate restriction increased over stage and before the neuroepithelium stage. Altogether, these data\nthe scarring time course, starting at day 15 (Fig. 4d). This analy- provide molecular profiles of nascently regionalized human neurosis revealed a coarse patterning window for brain regionalization; epithelium and lineage information at the onset of brain patterning\nhowever, sparse sampling of cells in whole organoids limits the in human cerebral organoids.\ndepth of these analyses.\n Guided by the observation of a patterning window, we inves- Variability of lineage dynamics in individual organoid\ntigated gene expression heterogeneity at the neuroepithelial stage regions. Next, we wished to use iTracer to assess variability in\n(day 15) using iTracer organoids scarred at the neuroectoderm progenitor-to-neuron lineages in distinct brain organoid regions at\nstage (day 7) (Fig. 4e and Extended Data Fig. 8a,b). To interpret high resolution. To achieve deep lineage sampling, we performed\nexpression patterns at this early time point, organoid cells were lineage-coupled single-cell transcriptomics on two microdissected\nprojected to an atlas of radial glia in the primary prenatal mouse peripheral regions of a 200-µm iTracer organoid section (2 months,\nbrain38 (Extended Data Fig. 8c–h) based on a k-nearest-neighbor scarred at day 15) (Fig. 5a and Supplementary Tables 1 and 3).\nclassifier trained on the mouse atlas CSS representation31 (Extended Analysis of single-cell transcriptomes revealed region 1 (R1) as the\nData Fig. 8i). The projection revealed regionality in the neuroepi- diencephalon–mesencephalon and R2 as the rhombencephalon\nthelium at day 15 and strong correspondence between human and (Fig. 5b,c and Extended Data Fig. 9a–c). We reconstructed barcode\nmouse patterning profiles (Fig. 4f,g). Consistent with our previous and scar families and found that lineages in R1 and R2 were entirely\nobservation of regional clonality, barcode families showed distinct diverged (Fig. 5d,e). We grouped transcriptionally distinct clusters\nbrain region compositions (Fig. 4h). However, in the largest bar- based on barcode families (Extended Data Fig. 9d) and applied\ncode family containing the highest regional diversity (BF1), we hierarchical clustering within these cluster groups (CGs) based\nfound no significant difference in regional identity composition on their scar family composition. This analysis revealed that CGs\n\nNature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 95\n\nArticles NaTuRE METHODS\n\ncontain distinct scar family compositions and transcriptomic sig- underlie certain focal cortical dysplasias in humans25–27. We crenatures (CG2-1, CG2-2, CG3-1–CG3-3; Extended Data Fig. 9e–j), ated four targeting guide vectors, each containing a gRNA targetindicating cell fate restriction before neuroepithelium formation ing a different exon in the TSC2 gene (Extended Data Fig. 10a,b).\nat day 15. Notably, trajectory inference and RNA velocity analysis We generated mosaic cerebral organoids composed of 10%\nwere not able to resolve distinct lineage relationships that could be iTracer-perturb control cells (BFP+GFP+), 10% iTracer-perturb\ndistinguished using iTracer (for example, cluster 6, BF3; Fig. 5b and TSC2-targeting cells (RFP+GFP+) and 80% wild-type cells\n To compare neurogenic lineages within the same brain region, the EB stage (day 5), thereby creating TSC2 perturbations and\nwe ordered cells of all hindbrain scar families (R2) along a differ- GFP scars simultaneously. At 1 month, we dissociated the mosaic\nentiation pseudotime using the transcriptome portion of the data organoids and used flow cytometry to sort reporter-positive cells,\n(Fig. 5f,g). We found that sister lineages, for example, scar families followed by scRNA-seq (Fig. 6a and Extended Data Fig. 10d–g).\nbelonging to the same barcode family and hence derived from the Focusing on scarred cell populations (Fig. 6b,c and Extended\nsame barcoded cell in the EB, showed similar NPC-to-neuron distri- Data Fig. 10h,i), we performed differential expression analysis\nbutions along pseudotime, indicating synchrony in differentiation between cells with targeting (RFP+) and nontargeting (BFP+) vecdynamics (Fig. 5h). By contrast, non-sister lineages showed larger tors and between nontargeting cell clones as background (Fig. 6d\nvariability in the distribution of cells along pseudotime and hence and Extended Data Fig. 10j–l). We identified 197 differentially\nless synchronized differentiation of NPCs to neurons. We next com- expressed genes (DEGs) that were unique to TSC2-targeting\npared neurogenic lineages on a transcriptional level and identified cells. Functional enrichment analysis of these genes using the\na limited set of genes differentially expressed between different lin- database for annotation, visualization and integrated discovery\neages (Fig. 5i). However, sister lineages did not show greater tran- (DAVID) revealed oxidative phosphorylation, the mitochondrial\nscriptional similarity than non-sister lineages (two-sided Wilcoxon’s inner membrane and the respiratory chain as enriched categories\nrank-sum test, P = 0.25). (Fig. 6e, Extended Data Fig. 10m,n and Supplementary Table 8),\n consistent with previous reports of TSC2 ablation affecting mito-\nTracing perturbed lineages with iTracer-perturb. The ability to chondria via mTOR activation39. We combined lineage informarecord lineages and measure molecular states simultaneously in high tion with pseudotemporal ordering to compare the distribution of\nthroughput is particularly interesting when studying the effect of cells over pseudotime in different lineages (Fig. 6f,g). Importantly,\ndisease-associated genetic mutations on development. We therefore TSC2-targeted lineages (RFP+) were enriched for early neuroepiextended the iTracer system to enable simultaneous targeted gene thelial cells (NECs) relative to control cells (BFP+) (odds ratio = 1.5;\nperturbation, lineage recording and molecular state phenotyping in Fisher’s exact test, P = 0.03), suggesting a role of TSC2 during\nmosaic organoids. We introduced a second gRNA under the control early differentiation into NPCs. This is consistent with previous\nof a bovine U6 promoter into the iTracer vector, which can target reports of delayed neuronal differentiation in patient-derived\nany gene of interest. In addition, we incorporated a second fluores- TSC2-heterozygous NPCs40. Together, incorporating gene perturcent reporter linked through a 2A self-cleaving peptide sequence bation into the iTracer lineage-recording system provides a flexible\nto the barcoded GFP, which is not targeted by a scarring guide and method to explore mosaic loss-of-function mutations in human\ntherefore enables selection of lineage-recorded cells. iTracer-perturb organoids to understand mechanisms of developmental disorders.\ntargeting vectors contain gRNA species targeting the gene of interest (bU6) and GFP (hU6) as well as RFP and barcoded GFP report- Discussion\ners linked through the 2A peptide. iTracer-perturb nontargeting Here we established three new approaches to trace lineages in\nvectors contain a control dummy gRNA (bU6) and a gRNA target- human iPSC-derived organoids. First, we present iTracer, a dynamic\ning GFP (hU6) as well as BFP and barcoded GFP reporters linked dual-channel cell lineage recorder for human iPSC-derived organthrough the 2A peptide (Fig. 6a). We designed an experiment in oids designed to trace clones from an initializing iPSC pool as well\nwhich cells within the same mosaic organoid would either be wild as to dynamically trace lineages using inducible scarring. Second,\ntype or would carry targeting or nontargeting recording vectors. we present Spatial iTracer, which links molecular state, lineage and\nGFP scarring and target gene knockout could then be induced location information in organoids. Third, we accomplished direct\nsimultaneously at a time point of choice by doxycycline-mediated lineage tracking using long-term light-sheet microscopy with mosaic\ninduction of Cas9 expression in the developing organoid. fluorescent organoids. Importantly, all of these lineage-recording\n We targeted the gene TSC2, which encodes a negative regula- approaches, along with computational and data-visualization methtor of mTOR; somatic mutations in this gene have been shown to ods that we developed, can be applied to any human iPSC-derived\n\nsampling. One 200-µm section was cut before selecting two spatially distant regions for microdissection. Single cells were isolated from microdissected\nregions and processed for scRNA-seq separately. b, UMAP embedding of scRNA-seq data from 26,894 cells from two microdissected regions in a single\ncerebral organoid scarred at day 15 and sequenced at day 60; cells are colored by cluster or originating region and annotated with brain regional or cell\ntype identity. c, Expression heatmap showing brain region and cell type markers across clusters and regions shown in b. d, Lineage plot shows lineage\nreconstruction combining both microdissected regions from the single organoid. First- and second-order deviation nodes represent barcode and scar\nfamilies (SF), respectively, with terminal branches indicating individual cells. The originating region is annotated in the outer circle, with example barcode\nand scar families annotated. e, UMAP embedding of single cells from the two microdissected regions colored by example barcode families indicated in\nd. f, Pseudotime (Pt) analysis was applied to cells from dissected region R2 (left) and colored by the nine scar families with at least 50 cells (right).\ng, Pseudotime distribution of cells in different scar families. SOX2 (red) and DCX (green) expression patterns along the reconstructed pseudotime are\nshown (top). The dendrogram shows lineage reconstruction from barcode and scar families. Cells in each scar family are ordered by pseudotimes.\nh, Hierarchical clustering of scar families based on their pairwise distances (dist) on the pseudotime distribution. The box plot shows the distribution of\ndistances between scar families from the same barcode family (left) or different barcode families (right). The P value indicates the significance score from\ntwo-sided Wilcoxon’s rank-sum test (n1 = 29, n2 = 81 scar families). Boxes in box plots represent upper and lower quartiles. The center line represents the\nmedian. Whiskers show the minimum and maximum of the data if there is no outlier. Outliers are defined as data points outside 1.5 times the interquartile\nrange above the upper quartile and below the lower quartile. i, Examples of genes with differential expression among NPCs from different scar families.\n\n96 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\ncell differentiation or organoid system. We use these approaches to that brain regionalization initiates early in development, and, as\nprovide an extensive examination of lineage dynamics in developing NECs do not migrate very far from where they are born, cells related\ncerebral organoids. We observed accumulation of cell lineages in to each other by lineage tend to contribute to the same part of the\ndistinct molecularly and spatially defined regions, which we could brain. Importantly, our findings corroborate results from the analytrace back to spatial restriction of lineages in the neuroepithelium sis of somatic mutation landscapes in different regions of the adult\nbefore patterning. This brain regional clonality is consistent with human brain, which also revealed clonal relationships linked to\nfate maps in Drosophila41, zebrafish42–44 and mice45, which revealed brain regions46. Cerebral organoids therefore represent a powerful\n\n a b R1\n Bc. Scar scRNA-seq 6\n t Rhomben. R2\n 0 15 60 NPC\n 5\n 7 17\n 15 Rhomben.\n 12 neuron\n x 13 16 1\n Dien.Ð 8\n z 9\n mesen. 14 RNA\n y 4 velocity\n NPC 10\n 200-µm 11\n section 18\n R1 Mesenchyme 3\n 2\n scRNA-seq\n UMAP 2\n\n 0\n Dien.Ðmesen.\n R2 neuron\n UMAP 1\n\n c d Scarred\n BF2 BF1\n Regions Unscarred\n BF3\n 14 6 3 2 11 0 1316 7 5 151217 9 10 1 8 4 18 Clusters\n Regions\n GNG5\n VIM\n NES SF6-1\n DCX\n MAP2\n STMN2 BF4\n RSPO3\n OTX2\n LHX9\n NR2F1\n NR2F2\n PCDH9\n TFAP2A\n TFAP2B\n HOXB5\n HOXB2\n HOXA2\n HOXA3 Expr\n SF6-2\n DCN High\n DDIT4\n BF5 BF6\n MKI67 Low\n\n e g P = 0.07\n Barcode families h\n Dist (Pt)\n\n NPC Neuron Distance (Pt)\n 2.0 DCX\n Expression\n\n Scar\n family\n D e\n\n 1.0\n .\n m\n iff\n\n SOX2\n Sa\n\n 5\n 0 i DBI HOPX BNIP3\n\n BF4\n\n 2\n 4\n SF6-1\n BF6\n UMAP 2\n\n SF6-2\n 3 1\n UMAP 1\n\n f\n BF5\n\n Pt\n 1 Pt\n\n 0 Scar family 0 5 0 50 4\n Expression at NPCs\n\nNature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 97\n\nArticles NaTuRE METHODS\n\n a b\n scRNA-seq BFP+\n hU6 bU6 RPBSA Barcode G2M\n RFP+\n gRNA gRNA BFP 2A GFP Telen. 3\n GFP+\n RG\n Nontargeting\n TSC2 Barcode 5\n hU6 bU6 RPBSA\n\n UMAP 2\n gRNA gRNA RFP 2A GFP\n\n TCS2 targeting UMAP 1\n\n 4 1\n AAA 31 d\n gRNA 0\n Inducible iTracer 6\n EB (5 d) Early 2\n Cas9 iPSCs iPSCs\n Dox-induced NE Telen.\n scarring RG\n\n d 20 e c\n DAVID enrichment SLC31A1 Expr\n 19 Oxidative phosphorylation Max\n −log10 (P (RFP+/BFP+))\n\n 15\n 20 Mitochondrial inner membrane\n 12 Respiratory chain\n 10 Unique to 15 Parkinson's disease SOX2\n RFP+/BFP+ Alzheimer's disease 0\n 15\n Shared with\n 10 NADH dehydrogenase activity\n 5 BFP+ clonal DE\n Expr (RFP+) Expr (RFP+) 15 Huntington's disease\n DCX MKI67\n 26 Metabolic pathways\n 0\n 15 10 5 0\n −0.8 −0.4 0 0.4\n Ðlog10 (P)\n log (FC (RFP+/BFP+))\n\n f g All SFs with ≥ 20 cells\n Pt SF B1-1\n 1 30 SF B1-2 BF1\n SF B1-3 BFP+\n 25\n 0 SF B2-1 BF2\n Number of cells\n\n 20\n SF B3-1 BF3 RFP+\n 15\n\n 10\n\n 5\n\n 0\n Pt\n\ncontrol iTracer-perturb vectors. This system was applied to TSC2 in mosaic cerebral organoids. b, UMAP embedding of scRNA-seq data from 1,673 RFP+,\n4,766 BFP+ and 7,992 GFP+ cells sorted from one mosaic iTracer-perturb organoid at 1 month. Cells are colored by cell clusters (bottom) or fluorescent\nsignals (top). c, Feature plot shows marker gene expression. d, Volcano plot shows overall differential expression analysis between RFP+ (TSC2-targeting)\nand BFP+ (control) cells, resulting in 385 DEGs (red), 197 of which are unique to the RFP+ versus BFP+ comparison (dark red). FC, fold change; DE,\ndifferentially expressed. e, DAVID functional enrichment analysis of DEGs with significantly increased expression that was uniquely observed in RFP+\ncells. Bars show −log10 (P) values from tests, and numbers show the number of DEGs annotated with each term. f, UMAP with cells colored by their\nscar families (≥20 members) and fluorescent signals or by pseudotime (inset). g, Distribution of cells from different scar families (≥20 members)\nacross the constructed pseudotime course.\n\nsystem to systematically study the relationship between regionaliza- give unreliable state flows, and methods that directly measure lintion and clonal dynamics during human brain development. eage are important to confirm trajectory inferences.\n Transgene silencing, single-cell dropout and limited cell sam- The iTracer-perturb system enables inducible or temporally conpling are hurdles in collecting complete lineage information using trolled gene perturbations while also recording lineage. As a proof\nthe iTracer system. Nonetheless, we were able to successfully of principle, we targeted TSC2 immediately before neuroectoderm\nreconstruct sparse lineages in whole organoids at various stages of formation, as mutations in this gene have been shown to underlie\ndevelopment and observe a coarse timing for cell fate restriction. certain focal cortical dysplasias in humans25–27. Our results indi-\nMicrodissection enabled deeper lineage sampling, identifying dif- cated that clones carrying the TSC2 gRNA have differential gene\nferent differentiation states that were derived from the same lineage expression profiles associated with metabolic changes as compared\nfor many different lineages. This strategy can be used to search for to control counterparts, which is consistent with the role of TSC2 as\ndifferences in gene expression between lineage families as well as negative regulator of mTOR, a master regulator of cellular metabodifferences in the timing of differentiation events. We have observed lism. More generally, iTracer-perturb provides a strategy to simulthat indirect trajectory reconstructions from transcriptomes can taneously perturb, trace and measure states in any mosaic organoid\n\n98 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\nsystem. In the future, iTracer and iTracer-perturb, together with 24. Fleck, J. S. et al. Resolving organoid brain region identities by mapping\nlong-term 4D light-sheet imaging, will be powerful methodologi- single-cell genomic data to reference atlases. Cell Stem Cell 28,\n 1148–1159 (2021).\ncal approaches to understand the effect of mutations that underlie 25. Au, K. S. et al. Genotype/phenotype correlation in 325 individuals referred\ndevelopmental disorders in human organoid systems. for a diagnosis of tuberous sclerosis complex in the United States. Genet.\n Med. 9, 88–100 (2007).\nOnline content 26. Lim, J. S. et al. Brain somatic mutations in MTOR cause focal cortical\n dysplasia type II leading to intractable epilepsy. Nat. Med. 21, 395–400 (2015).\nAny methods, additional references, Nature Research report-\n 27. Sancak, O. et al. Mutational analysis of the TSC1 and TSC2 genes in a\ning summaries, source data, extended data, supplementary infor- diagnostic setting: genotype–phenotype correlations and comparison of\nmation, acknowledgements, peer review information; details of diagnostic DNA techniques in tuberous sclerosis complex. Eur. J. Hum. Genet.\nauthor contributions and competing interests; and statements of 13, 731–741 (2005).\ndata and code availability are available at https://doi.org/10.1038/ 28. Kowarz, E., Loscher, D. & Marschalek, R. Optimized Sleeping Beauty\n transposons rapidly generate stable transgenic cell lines. Biotechnol. J. 10,\ns41592-021-01344-8. 647–653 (2015).\n 29. Riesenberg, S. & Maricic, T. Targeting repair pathways with small molecules\nReceived: 10 June 2021; Accepted: 4 November 2021; increases precise genome editing in pluripotent stem cells. Nat. Commun. 9,\nPublished online: 30 December 2021 2164 (2018).\n 30. Gonzalez, F. et al. An iCRISPR platform for rapid, multiplexable, and\nReferences inducible genome editing in human pluripotent stem cells. Cell Stem Cell 15,\n1. Kim, J., Koo, B. K. & Knoblich, J. A. Human organoids: model systems for 215–226 (2014).\n human biology and medicine. Nat. Rev. Mol. Cell Biol. 21, 571–584 (2020). 31. He, Z., Brazovskaja, A., Ebert, S., Camp, J. G. & Treutlein, B. CSS: cluster\n2. Bhaduri, A. et al. Cell stress in cortical organoids impairs molecular subtype similarity spectrum integration of single-cell genomics data. Genome Biol. 21,\n specification. Nature 578, 142–148 (2020). 224 (2020).\n3. Birey, F. et al. Assembly of functionally integrated human forebrain spheroids. 32. Velasco, S. et al. Individual brain organoids reproducibly form cell diversity of\n Nature 545, 54–59 (2017). the human cerebral cortex. Nature 570, 523–527 (2019).\n4. Camp, J. G. et al. Human cerebral organoids recapitulate gene expression 33. Garrison, B. S., Yant, S. R., Mikkelsen, J. G. & Kay, M. A. Postintegrative gene\n programs of fetal neocortex development. Proc. Natl Acad. Sci. USA 112, silencing within the Sleeping Beauty transposition system. Mol. Cell. Biol. 27,\n 15672–15677 (2015). 8824–8833 (2007).\n5. Kanton, S. et al. Organoid single-cell genomic atlas uncovers human-specific 34. Kharchenko, P. V., Silberstein, L. & Scadden, D. T. Bayesian approach to\n features of brain development. Nature 574, 418–422 (2019). single-cell differential expression analysis. Nat. Methods 11, 740–742 (2014).\n6. Pollen, A. A. et al. Establishing cerebral organoids as models of 35. Newman, A. M. et al. Determining cell type abundance and expression from\n human-specific brain evolution. Cell 176, 743–756 (2019). bulk tissues with digital cytometry. Nat. Biotechnol. 37, 773–782 (2019).\n7. Quadrato, G. et al. Cell diversity and network dynamics in photosensitive 36. Roberts, B. et al. Systematic gene tagging using CRISPR/Cas9 in human stem\n human brain organoids. Nature 545, 48–53 (2017). cells to illuminate cell organization. Mol. Biol. Cell 28, 2854–2874 (2017).\n8. Camp, J. G., Wollny, D. & Treutlein, B. Single-cell genomics to guide human 37. Schindelin, J. et al. Fiji: an open-source platform for biological-image analysis.\n stem cell and tissue engineering. Nat. Methods 15, 661–667 (2018). Nat. Methods 9, 676–682 (2012).\n9. Haghverdi, L., Buttner, M., Wolf, F. A., Buettner, F. & Theis, F. J. Diffusion 38. La Manno, G. et al. Molecular architecture of the developing mouse brain.\n pseudotime robustly reconstructs lineage branching. Nat. Methods 13, Nature 596, 92–96 (2021).\n 845–848 (2016). 39. Koyanagi, M. et al. Ablation of TSC2 enhances insulin secretion by increasing\n10. Trapnell, C. et al. The dynamics and regulators of cell fate decisions are the number of mitochondria through activation of mTORC1. PLoS ONE 6,\n revealed by pseudotemporal ordering of single cells. Nat. Biotechnol. 32, e23238 (2011).\n 381–386 (2014). 40. Zucco, A. J. et al. Neural progenitors derived from tuberous sclerosis complex\n11. La Manno, G. et al. RNA velocity of single cells. Nature 560, patients exhibit attenuated PI3K/AKT signaling and delayed neuronal\n 494–498 (2018). differentiation. Mol. Cell. Neurosci. 92, 149–163 (2018).\n12. Weinreb, C., Rodriguez-Fraticelli, A., Camargo, F. D. & Klein, A. M. Lineage 41. Chow, K. K. et al. Imaging cell lineage with a synthetic digital recording\n tracing on transcriptional landscapes links state to fate during differentiation. system. Science 372, eabb3099 (2021).\n Science 367, eaaw3381 (2020). 42. Cavodeassi, F. & Houart, C. Brain regionalization: of signaling centers and\n13. McKenna, A. et al. Whole-organism lineage tracing by combinatorial and boundaries. Dev. Neurobiol. 72, 218–233 (2012).\n cumulative genome editing. Science 353, aaf7907 (2016). 43. Warga, R. M., Kane, D. A. & Ho, R. K. Fate mapping embryonic blood in\n14. Spanjaard, B. et al. Simultaneous lineage tracing and cell-type identification zebrafish: multi- and unipotential lineages are segregated at gastrulation. Dev.\n using CRISPR–Cas9-induced genetic scars. Nat. Biotechnol. 36, 469–473 (2018). Cell 16, 744–755 (2009).\n15. Chan, M. M. et al. Molecular recording of mammalian embryogenesis. Nature 44. Woo, K. & Fraser, S. E. Order and coherence in the fate map of the zebrafish\n 570, 77–82 (2019). nervous system. Development 121, 2595–2609 (1995).\n16. Biddy, B. A. et al. Single-cell mapping of lineage and identity in direct 45. Inoue, T., Nakamura, S. & Osumi, N. Fate mapping of the mouse\n reprogramming. Nature 564, 219–224 (2018). prosencephalic neural plate. Dev. Biol. 219, 373–383 (2000).\n17. Quinn, J. J. et al. Single-cell lineages reveal the rates, routes, 46. Lodato, M. A. et al. Somatic mutation in single human neurons tracks\n and drivers of metastasis in cancer xenografts. Science 371, developmental and transcriptional history. Science 350, 94–98 (2015).\n eabc1944 (2021).\n18. Huisken, J., Swoger, J., Del Bene, F., Wittbrodt, J. & Stelzer, E. H. Optical Publisher’s note Springer Nature remains neutral with regard to jurisdictional claims in\n sectioning deep inside live embryos by selective plane illumination published maps and institutional affiliations.\n microscopy. Science 305, 1007–1009 (2004). Open Access This article is licensed under a Creative Commons\n19. Jain, A. et al. Regionalized tissue fluidization is required for epithelial gap Attribution 4.0 International License, which permits use, sharing, adap-\n closure during insect gastrulation. Nat. Commun. 11, 5604 (2020). tation, distribution and reproduction in any medium or format, as long\n20. Icha, J., Weber, M., Waters, J. C. & Norden, C. Phototoxicity in live as you give appropriate credit to the original author(s) and the source, provide a link to\n fluorescence microscopy, and how to avoid it. Bioessays 39, 1700003 (2017). the Creative Commons license, and indicate if changes were made. The images or other\n21. Laissue, P. P., Alghamdi, R. A., Tomancak, P., Reynaud, E. G. & Shroff, H. third party material in this article are included in the article’s Creative Commons license,\n Assessing phototoxicity in live fluorescence imaging. Nat. Methods 14, unless indicated otherwise in a credit line to the material. If material is not included in\n 657–661 (2017). the article’s Creative Commons license and your intended use is not permitted by statu-\n22. Lancaster, M. A. et al. Cerebral organoids model human brain development tory regulation or exceeds the permitted use, you will need to obtain permission directly\n and microcephaly. Nature 501, 373–379 (2013). from the copyright holder. To view a copy of this license, visit http://creativecommons.\n23. Renner, M. et al. Self-organized developmental patterning and differentiation org/licenses/by/4.0/.\n in cerebral organoids. EMBO J. 36, 1316–1329 (2017). © The Author(s) 2021\n\nNature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 99\n\nArticles NaTuRE METHODS\n\nMethods Assessment of scarring efficiency. To test scarring efficiency upon doxycycline\nEthics statement. Permission for this work with human iPSC lines was obtained induction, iCRISPR cells were cultivated using standard feeder-free conditions in\nthrough the Sachsisches Staatsministerium fur Umwelt und Landwirtschaft (Az. mTeSR1 (Stemcell Technologies) on Matrigel-coated plates. Cells were nucleofected\n55-8811.72/26, Az. 55-8811.72/26/382, Az. 55-8811.72/26/393 and 54-8452/26/7), with 10 μg lineage-recorder DNA and 1 µg Sleeping Beauty transposase following\nthe Swiss Federal Office for the Environment (A120821-08, A192559-01), the the manufacturer’s protocol and using the B-16 program of the Nucleofector 2b\nEthics Committee of Northwest and Central Switzerland (2019-01016) and the (Lonza) in cuvettes for 100 µl Human Stem Cell nucleofection buffer (Lonza,\nSwiss Federal Office of Public Health. VVPH-5022). Nucleofection reactions were plated on Matrigel-coated plates\n and allowed to expand for 5–7 d before flow cytometry. To select for cells with\niCRISPR cell line. We used the iCRISPR iPSC cell line with doxycycline-inducible successful integration of the cell lineage reporter, RFP+ or GFP+ cells were sorted\nCas9, created previously as described29. Briefly, the human iPSC line h409b2 into 1.5-ml tubes (~120,000 cells in total) and plated in 12-cell Matrigel-coated\nfrom the RIKEN BRC cell bank4 was used to create a doxycycline-inducible plates with mTeSR1 and Rock inhibitor (1:250). Following cell recovery, we used\nCas9-expressing cell line30 by introducing two transcription activator-like effector 2 µg doxycycline30 for 0, 1, or 2 d before changing back to mTeSR1 base medium.\nnucleases targeting the AAVS1 locus, which has shown to be effective for sustained Optimization of the incubation of 3D cultures with doxycycline was performed\ntransgene expression, and two constructs encoding transcription activator-like at EB and neuroectoderm stages at concentrations of 0.5, 1, 2, 4 and 8 µg ml−1\neffector nucleases with donor plasmids. One of the donor plasmids contained a doxycycline for 24-h incubations before changing back to mTeSR1 and NIM\nconstitutive reverse tetracycline transactivator (AAVS1-Neo-M2rtTA), and the base media, respectively. iPSCs were collected using Accutase (Sigma-Aldrich)\nother one contained a doxycycline-inducible expression cassette (Puro-Cas9). for 5–7 min before quenching with KnockOut Media (Thermo Fisher Scientific)\nA mutation corresponding to D10A was introduced by site-directed mutagenesis of and centrifuging at 200g for 5 min. In total, 100,000 iPSCs were taken for DNA\nthe original Puro-Cas9 donor with the Q5 mutagenesis kit (New England Biolabs, extraction using QuickExtract (Lucigen), whereas organoid samples were directly\nE0554S) to generate Cas9n. The cell line was tested for the proper expression added to QuickExtract (Lucigen) and vortexed. All samples were vortexed shortly\nof pluripotency markers SOX2, OCT-4, TRA1-60 and SSEA. Quantitative PCR before heating to 65 °C for 6 min before vortexing again and heating to 98 °C for\nconfirmed the doxycycline-inducible Cas9n, and digital PCR was used to exclude 2 min. We used 50 ng input DNA for scar region amplification (primer sequences\noff-target integration29. DNA from iCRISPR cells was sent to the Cell Guidance are provided in Supplementary Table 5). Quality of the amplified product was\nSystems Genetics Service Cytogenetics Laboratory and tested for copy number checked with a 2% E-Gel (Thermo Fisher Scientific) before Illumina sequencing\nchanges using the Agilent ISCA 8x60K version 2 array. Array analysis revealed adaptors were added in a subsequent PCR reaction. Bulk scar libraries were\nthree apparently clonal changes in DNA copy number. Gain of the entire long arm cleaned with magnetic beads (Beckman Coulter) before checking quality with a 2%\nof chromosome 1 was detected and estimated to be present in about 70% of cells. E-Gel. Libraries were sequenced on the Illumina MiSeq Nano. Scar detection was\nA DNA copy number loss of approximately 3.7 Mb from the proximal short arm performed using CRISPResso48.\nof chromosome 19, band p12, was detected and present in about 30% of cells.\nA commonly found mutational gain of approximately 1 Mb was detected within the Preparation of organoids and scarring. iTracer+ iCRISPR cells were prepared\nproximal long arm of chromosome 20, band q11.21. Finally, applying inferCNV as previously described above. Following cell recovery after flow cytometry,\n(https://github.com/broadinstitute/inferCNV) to the scRNA-seq data of iCRISPR 2,000 cells per well in a 96-well plate were seeded and differentiated into cerebral\nsuggested the gain of a large portion of chromosome 12 in a subset of cells. organoids using a whole-organoid differentiation protocol5,22. Throughout\niCRISPR cells were regularly tested for mycoplasma using PCR validation (Venor development, organoids were scarred by activation of inducible Cas9 (Fig. 1b and\nGeM Classic, Minerva Biolabs) and found to be negative. Supplementary Table 1). Scarring was achieved by first selecting the organoid to be\n scarred and transferring it to a six- to 24-well plate (depending on organoid size)\nEstablishment of dynamic cell lineage-reporter vector. iTracer plasmids filled with scarring medium with 8 µg ml−1 doxycycline (base medium depending\nwere constructed by modifying Sleeping Beauty reporter plasmids pSBbi-GH on the age of the organoid, Supplementary Table 1). Organoids were incubated in\nand pSBbi-RH28. pSBbi plasmids were a gift from E. Kowarz (Institute of scarring medium for 24 h before returning to base medium without doxycycline.\nPharmaceutical Biology, Goethe University, Frankfurt am Main, Germany)\n(Addgene plasmids 60514 and 60516; http://n2t.net/addgene:60514, http:// Bulk barcode detection. IPSCs and 19 organoids ranging in stage from EB\nn2t.net/addgene:60516; RRID, Addgene_60514; RRID, Addgene_60516). to day 30 were used for bulk analysis to assess the capture and diversity of\nPlasmid generation consisted of two steps: initially removing the hygromycin iTracer barcodes. We propagated and collected samples in a manner similar\ncassette and inserting an 11-bp barcode tag in the 3′ untranslated region to that described above. Briefly, iCRISPR cells were cultivated using standard\nof the fluorescent reporter gene; second, the gene-of-interest site including feeder-free conditions in mTeSR1 (Stemcell Technologies) on Matrigel-coated\nits promoter region was replaced by the human U6 promoter driving the plates. Cells were nucleofected with 10 µg lineage-recorder DNA and 1 µg\nexpression of a gRNA that targets the fluorescence gene. In detail, a long-range Sleeping Beauty transposase following the manufacturer’s protocol and using\nPCR was performed to amplify and extract the plasmid backbone excluding the H9 program of the 4D-Nucleofector (Lonza) in cuvettes for 100 µl Human\nthe hygromycin cassette from pSBbi plasmids following the manufacturer’s Stem Cell nucleofection buffer (Lonza, VVPH-5022). Nucleofection reactions\nrecommendations (1× Phusion HiFi Ready Mix, 50 ng pSBbi, 0.2 µM of each were plated on Matrigel-coated plates and allowed to expand for 5–7 d before\nprimer (primer sequences are provided in Supplementary Table 5), 3% DMSO, flow cytometry. To select for cells with successful integration of the cell lineage\n50 µl in total, 25 cycles). To remove original plasmid from the backbone, the reporter, RFP+GFP+ cells were sorted into 1.5-ml tubes (~120,000 cells in\nPCR reaction was digested with a combination of restriction enzymes directly total) and plated in 12-cell Matrigel-coated plates with mTeSR1, Rock inhibitor\nadded to the PCR reaction (37 µl H2O; 10 µl Thermo Fisher FastDigest (FD) (1:250) and Primocin (1:250). DNA isolation and bulk barcode libraries were\nBuffer; 1 µl each FD enzyme DpnI, CpoI and Esp3I; 37 °C; 1 h). Reactions prepared as described for bulk scar libraries (primer sequences are provided in\nwere purified using the Qiagen PCR Purification kit. The purified backbone Supplementary Table 5). Libraries were sequenced on the Illumina MiSeq Nano.\nwas then used to perform Gibson assembly following the instructions in Analysis was performed using a custom Perl script to count the frequency of each\nthe CROP-seq manual47 to introduce barcodes by using an oligonucleotide uniquely detected barcode.\ncontaining random nucleotides (Supplementary Table 5). Instructions from\nthe manual were only adapted such that bacteria were not plated after recovery Preparation of single-cell transcriptomes from whole lineage-traced organoids.\nbut were instead completely transferred to an overnight culture with 1× Whole organoids were dissociated to generate single-cell gene expression libraries.\nampicillin to maintain barcode heterogeneity. Plasmid DNA was isolated using In brief, organoids were transferred to HBSS (without Ca2+ or Mg2+, −/−) and\nthe Qiagen Miniprep kit. CROP-seq plasmids containing a gRNA targeting cut into two pieces to clear away debris from the center of the organoid (two to\neither sequences for dTomato (GGTGTCCACGTAGTAGTAGC) or GFP three washes in total). Organoid pieces were then dissociated using the Neural\n(TGTTCTGCTGGTAGTGGT) were generated following protocol instructions Dissociation kit (P) and papain-based dissociation (Miltenyi Biotec). Organoid\n(oligonucleotide sequences are provided in Supplementary Table 5). These pieces were incubated in papain at 37 °C (enzyme mix 1) for an initial 15 min,\nplasmids acted as templates to amplify and extract the human U6 promoter, followed by addition of enzyme A (enzyme mix 2) to the papain mix. Organoid\ngRNA and the gRNA scaffold region using the PCR conditions described above. pieces were then triturated using wide-bore 1,000-ml tips and incubated for\nPrimers (Supplementary Table 5) compatible with subsequent cloning were additional intervals of 5–10 min with triturations between incubation steps,\nused, and the purified PCR product was digested with Thermo Fisher FD BshTI amounting to a total papain incubation time of approximately 45 min. Cells were\nand FD PaeI before ligation. The backbone for cloning was obtained by digesting filtered through a 30-μm strainer and washed, centrifuged for 5 min at 300g\nplasmids containing barcodes with Thermo Fisher FD BshTI and FD PaeI. To and washed three times with HBSS (−/−). Cells were filtered through a 20-μm\nguarantee that there was no ligation of the cut region back to the plasmid, the strainer and washed, centrifuged for 5 min at 300g and washed three times with\nbackbone digest was run on an agarose gel, and the backbone region was excised HBSS (−/−). The resulting cells were then assessed (count and viability) using\nand purified. Backbone and insert were ligated using NEB QuickLigase, and the Trypan blue assay and counted using the automated cell counter Countess\nEscherichia coli was subsequently electroporated with the ligation product by (Thermo Fisher). Finally, cells were diluted to an appropriate concentration\nfollowing instructions in the CROP-seq manual. Recovered cells were again to obtain approximately 5,000–7,000 cells per lane in a 10x microfluidic chip\ndirectly transferred to an overnight culture, and plasmid DNA was extracted and device. Single-cell cDNA was synthesized according to the manufacturer’s\npurified using Qiagen MediPrep. recommendations before continuing to library preparation with 25% of the total\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\ncDNA volume. Libraries were sequenced on the Illumina NovaSeq S1 and on the resolution of 0.6), implemented in Seurat, was applied based on the precalculated\nIllumina HiSeq 2500. top 20 PCs. Average expression of the predefined highly variable genes was\n calculated for each cluster in each organoid. Afterward, Spearman correlation\nBarcode and scar detection from single-cell cDNA. Barcode and scar regions coefficients were calculated between every cell and every cluster in all organoids.\nwere amplified from 60–70 ng of cDNA remaining from the scRNA-seq For each cell, its correlations with different clusters of each organoid were z\npreparation with three separate PCR reactions. First, cDNA was amplified via PCR transformed. Its z-transformed similarities with clusters of different organoids were\nbroadly targeting a region containing both the scar and the barcode. Subsequently, then concatenated as the final CSS representation. UMAP and Louvain clustering\nthe reaction was split equally, and we performed a nested PCR separately targeting (with a resolution of 1) were applied to the CSS representation. Cluster annotation\nthe barcode and scar regions (primer sequences are provided in Supplementary was carried out by combining expression patterns of canonical cell type markers, for\nreaction, samples were cleaned up using magnetic beads (0.9×) (Beckman the average transcriptome of clusters to that of different mouse brain regions.\nCoulter), and libraries were sequenced on the Illumina NovaSeq S1. For each organoid, a four-layer lineage tree was reconstructed. The pseudo-root\n node, representing the organoid, was considered as the first layer. Barcode families,\nAlignment of single-cell transcriptomes and iTracer readouts. We used Cell that is, cells with the same barcode combination detected, were considered as\nRanger (10x Genomics) to demultiplex base-call files to FASTQ files and align the second layer. Cells in the same barcode family were likely expanded from\nreads. Default alignment parameters were used to align reads to a modified human the same iPSC. In each barcode family, scar families, that is, cells with the same\nreference including the fluorescent reporter (GFP or RFP) from the cell lineage scar combination, were considered as the third layer, which represents cells in\nrecorder (hg38). Barcode and scar libraries generated from 10x cDNA were also the organoid expanded from the same cell when Cas9 was induced. At the end,\naligned using default parameters, with the exception that the force-cells argument cells were considered as the fourth layer. Lineage trees were visualized with the\nwas set to 200,000, and data were aligned to a custom reference of the region of ‘radialNetwork’ function in the ‘networkD3’ R package.\ninterest. This reference was constructed following 10x recommendations.\n Quantification of barcode family-composition similarity between clusters.\niTracer readout filtering. iTracer barcode transcripts were first filtered at the Barcode family-composition similarity between two cell clusters was quantified as\nUMI level, at which transcripts are only retained if they have more than three the number of cell pairs, with each cell in one cluster, that are of the same barcode\nreads. We then plotted the distribution of reads per UMI against the frequency family (denoted as ni,j; Fig. 3a). To control for confounding factors including\nof read depth per UMI and fit a line with loess through that distribution cell numbers in clusters and organoid composition, 100 random shufflings of\n(loess (nreads ≈ log (freq_nreads))), where values smaller than one were set to barcode family information for cells in each organoid were applied, and random\none. We then calculated the first minimum and removed everything that had composition similarity between two clusters was estimated in the same manner\nsmaller coverage than this point. iTracer barcodes began and ended with A or T (denoted as n′i,j). The observed barcode(family-composition\n ( )) similarity\n ( )was\nnucleotides; barcodes that did not match this pattern were removed. We filtered then normalized into the z score zi,j = ni,j − mean n′i,j (s.d. n′i,j )−1.\nbarcode transcripts such that, when we detected the same UMI for different z transformation was further applied to scale the resulting z scores between\nbarcodes in the same cell, the one with the highest read coverage was retained. different cluster pairs (denoted as zi,j ), and two cutoffs (0.01 and 0.99 quantiles\nFurthermore, when transcripts with the same UMI and barcode were found in\n of the standard normal distribution, that is, zcutoff− = −2.33 and zcutoff+ = 2.33) were\nmultiple cells, transcripts were removed from these cells. Barcodes were further\n applied to obtain cluster pairs with significantly similar ( zi,j > zcutoff+) or different\nfiltered such that, when any barcodes with a Hamming distance of one within any ( )\nsingle cell were found, the barcode with the highest coverage was retained. Lastly, zi,j < zcutoff− barcode family composition. To identify groups of cell clusters with\nif more than ten barcodes were detected in the same cell, the cell was ignored for\n similar barcode family composition, hierarchical clustering was applied, with the\nlineage reconstructions.\n input distance matrix defined as di,j = max(zi,j ) − zi,j.\n iTracer scar transcripts were filtered in a similar manner, in which transcripts\n Alternatively, hierarchical clustering was applied to the binomial-based\nwere first filtered at the UMI level; again, we only retained transcripts that had\n normalized barcode family-composition similarity distance matrix, which only\nmore than three reads. As we did for barcodes, we plotted the distribution of\n takes into account the sizes of cell clusters. In brief, assuming the total number\nreads per UMI against the frequency of read depth per UMI and fit a line with\n of cell pairs from the same barcode family is N and two clusters i and j represent\nloess through that distribution where values smaller than one were set to one. We\n proportions pi and pj of the whole dataset, the expected number of cell pairs in\ncalculated the first minimum and removed everything that had smaller coverage\n these two different clusters from the same barcode family is ni,j = N × 2pi pj with\nthan this point. We also filtered transcripts such that, when we detected the same\nUMI for different scars in the same cell, the one with the highest read coverage was\n √\n the expected standard deviation of σ i,j = N × 2pi pj 1 − 2pi pj , based on\n ( )\nretained. Transcripts were further filtered out if they had the same UMI and scar\nbut were found in multiple cells. Lastly, we only kept scar transcripts for which the binomial distribution. The observed barcode family-composition ) −1similarity was\n then normalized into the alternative z score zi,j = ni,j − ni,j σ i,j . Hierarchical\n (\nsame UMI was found in barcode and scar libraries. Similarly, barcode transcripts\nwithout corresponding scar transcripts were also excluded. clustering was then applied to identify groups of cell clusters with similar barcode\n family composition, with the input distance matrix defined as di,j = max(zi,j ) − zi,j\nEstimation of barcode complexity in the iTracer+ iCRISPR iPSC line. Single-cell with the alternative z scores.\niTracer barcode transcript readouts of three batches of the iTracer+ iCRISPR\niPSC line were generated. There were 6,966, 5,316 and 4,253 cells detected in the Spatial transcriptomics. Org14 was embedded in prechilled optimal cutting\nthree libraries, respectively, with, on average, 13,308 (13,218, 12,351 and 14,354) temperature compound. The sample was then set into a dry ice bath with\nbarcodes detected. For each library, on average, 62% ± 1% of detected barcodes isopentane until frozen and stored at −80 °C. Cryosections were cut at a thickness\nwere unique. As detected barcode numbers of the three batches were comparable, of 10 µm, adhered to ST slides (10x) and stored at −80 °C until the following day.\nwe simplified the scenario to three random samplings with the same sampling Tissue slices were fixed in cold methanol before being stained with hematoxylin\nratio (p) from the total population of N barcodes, where the likelihoods of and eosin. ST slides were imaged as recommended on a Nikon T2i at 20× using\ndifferent barcodes being selected are assumed to be equal. Therefore, the expected a tile scan over all slice sections. Following image capture, tissue slices were\nproportion of unique barcodes in one batch is (1 − p)2. The sampling ratio was permeabilized. Optimal permeabilization conditions were determined by using\ntherefore estimated to be ~21%, which suggests that the total number of barcodes the Tissue Optimization kit (10x), and the optimal time was found to be 24 min.\navailable in the iTracer+ iCRISPR iPSC pool is roughly 60,000 or, more precisely, Spot-captured RNA was reverse transcribed before second-strand synthesis\n62,597 based on the above calculation. and cDNA denaturation. qPCR was used to determine the optimal number of\n cDNA-amplification cycles as recommended by the manufacturer. cDNA was\nAnalysis of whole-organoid single-cell RNA-seq data. Seurat (version 3.1)49 amplified using 17–18 cycles before continuing to Visium spatial gene expression\nwas applied to scRNA-seq data for preprocessing. Ribosomal protein genes and library construction. Visium libraries were sequenced on the Illumina NovaSeq\npseudogenes were excluded from analysis. Generally, cells with more than 6,000 SP following sequencing recommendations. Barcode and scar libraries were\nor less than 600 detected genes as well as those with a mitochondrial transcript sequenced on the NextSeq (mid-output).\nproportion greater than 20% were excluded (Supplementary Table 1). After log The resulting sequencing reads were aligned using Space Ranger for the regular\nnormalization, 5,000 highly variable genes were identified using the default vst Visium libraries (10x Genomics). S1 and S3 were automatically tissue aligned,\nmethod, in which cell cycle-related genes were excluded (Supplementary Table whereas we manually annotated tissue-covering spots with Loupe Browser (10x\n6). Cell cycle scores were then calculated and regressed out from highly variable Genomics) for S3. Spots not covering tissue were discarded manually in Loupe\ngene expression to reduce its confounding effect. Regressed-out expression levels Browser (10x Genomics). Barcodes and scars were called using the methods\nwere then z transformed, followed by principal-component analysis (PCA) for described above with one exception. To use Cell Ranger to map barcode and scar\ndimension reduction. UMAP was applied to the top 20 principal components sequencing reads to the custom reference, the Cell Ranger barcode whitelist was\n(PCs) for visualization. replaced with the whitelist from the Space Ranger barcode set.\n To integrate data from different organoids, CSS31 was calculated as described. Two methods were used to annotate spots. First, an elastic net-based machine\nIn brief, cells from each organoid were subset, and Louvain clustering (with a learning classifier (implemented as glmnet in R) was trained by a random subset\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\nof whole-organoid scRNA-seq data with 2,626 cells in total, with each of the eight that more cluster pairs show significantly different scar family composition than\nregional identities (telencephalic, dien–mesencephalic, rhombencephalic, retinal, expected by random chance, therefore implying that significant cell fate restriction\nneural crest derivatives, microglia, mesenchymal, epithelial) having no more than occurred when scars were induced.\n400 cells, given highly variable gene expression as the input to predict cluster labels. To identify cell clusters sharing similar scar family composition, hierarchical\nThe trained model was applied to transcriptomic profiles of spots to estimate the clustering was applied to the cell clusters of interest. The input distance matrix was\nlikelihood of each spot being different clusters. Likelihoods of clusters assigned to defined as Di,j = zi,j − min(zi,j ).\nthe same regional (or NPC–neuron state) identity were summed up, and spots were\nannotated to be the region or state with maximal likelihood, if it was at least 5% Regional heterogeneity in early cerebral organoid development. Four early\nhigher than the second largest estimated likelihood; otherwise, it was annotated cerebral organoids, which were cultured for 15 d with scars introduced at day 7,\nas ‘unassigned’. were dissociated to generate single-cell gene expression libraries. Dissociated cell\n Spots were also annotated using CIBERSORTx35, with which we digitally suspensions were pooled into two samples, each representing two early organoids.\nsorted each spatial spot into fractions of cell types present. To this end, we first Single-cell transcriptomes and iTracer readouts were preprocessed and filtered as\nconstructed a signature matrix for deconvolution using the highly variable genes described above.\nand a subset of cells across all cell annotations from the whole-organoid analysis Seurat (version 3.1) was applied to the transcriptome data for log normalization\n(Supplementary Table 7). We then input each detected spot across all tissue and highly variable gene identification (vst method, 3,000 genes). PCA was applied\nsections (S1–S3) for sorting, which resulted in a matrix of spots versus each cell to the z-transformed expression levels of the highly variable genes, with the top\nannotation in which each row summed to 1. We plotted the distribution of the 20 PCs used for UMAP embedding construction and Louvain clustering (with a\nhighest proportion (score) for each spot and set a threshold such that all spots resolution of 0.6). Cell clusters were annotated as pluripotent stem cells (PSCs),\nwith the highest contributing proportion less than the first quartile (0.405 or NECs, neural crest cells, mesodermal cells, endodermal cells and others based on\n40.5%) were called ‘unassigned’. The remaining spots were then assigned the expression of canonical markers (Extended Data Fig. 8). Cells annotated as PSCs\ncorresponding cell annotation of their highest contributing proportion. and NECs were subset for the following analysis.\n To quantify the relationship between barcode-composition differences and Focusing on the subset cells, highly variable genes were re-identified (vst, 3,000\nspatial proximity between spots, we first defined barcode-composition similarity genes). Genes related to the cell cycle were excluded from the identified genes. Cell\nbetween any two detected spots i and j as the Jaccard index (Ji,j) of detected cycle scores were calculated for cells following the vignette in Seurat and regressed\nbarcodes in the two spots, that is, the ratio of shared barcode number to unique out from the expression levels before applying z transformation of highly variable\nbarcode number. Barcode-composition distance was then defined as di,j = 1 − Ji,j. gene expression levels. PCA was then applied to the z-transformed expression\nThe correlation between barcode-composition distances and spatial distances levels, with the top 20 PCs used for UMAP embedding construction and Louvain\nwas next calculated. Alternatively, spot pairs were grouped into two groups: (1) clustering (with a resolution of 0.6). Cells were annotated as either PSCs or NECs.\nspot pairs with at least one barcode shared and (2) spot pairs with no overlapping To further annotate regional identities of cells in early cerebral organoids,\ndetected barcode. Spatial distances between spot pairs in the two groups were scRNA-seq data of early neural tube cells and radial glia in the murine early\ncompared using two-sided Wilcoxon’s rank-sum test. fetal brain were retrieved by subsetting cells in the developing mouse brain\n scRNA-seq atlas38, requiring cells from samples no older than E11.0, annotated\nLight-sheet imaging and tracking of cerebral organoids. We generated organoids as neural tube cells and radial glia and with at least 3,000 genes detected. Seurat\nusing iPSCs expressing the FUS protein tagged with EGFP, which uniformly (version 3.1) was applied to identify highly variable genes (vst, 3,000 genes), and\nlabels nuclei, and mTagRFP–T–CAAX, which labels membrane, and unlabeled PCA of their z-transformed expression levels was performed. CSS31 was used to\niPSCs. FUS-mEGFP (cell line ID AICS-0080 cl.69), mTagRFP-T-CAAX (cell line integrate and represent cells from different samples (default parameters). The\nID AICS-0054-091) and WTC lines (cell line ID GM25256) used for imaging CSS representation was used for UMAP embedding construction and Louvain\nwere procured from the Coriell Institute. Organoids were imaged with the LS1 clustering (with a resolution of 2). Cell clusters were annotated by combining\nLive light-sheet microscope developed by Viventis Microscopy, using a ×25 sample meta-information of dissected tissues and regional markers. Regional\nobjective demagnified to ×18.5, with a field of view that was ~700 µm. Successive identities of clusters (combinations of forebrain, midbrain and hindbrain) were\nz steps were acquired every 2 µm for 150 steps. The frame rate for acquisition was determined by combining cluster annotation and proportions of cells from\n30 min, and, in total, 100 h of development (200 frames) were used for tracking. different dissected brain regions. High-resolution Louvain clustering (with a\nFor imaging, EBs were embedded in neural-induction medium together with resolution of 20) was also applied to identify cell niches, with regional identities\nMatrigel. Light-sheet data were converted into HDF5 format and visualized using of niches summarized as the majority.\nthe BigDataViewer50 in Fiji37. In total, four nuclei were tracked, the first one for To project early cerebral organoid NECs to the atlas of mouse early neural\n100 h and the next three for 65 h. Three neighboring nuclei were tracked in the tube cells and radial glia, we calculated the projected CSS for organoid cells\nsame developing lumen area and one in another diametrically opposite location by calculating normalized similarities between the cell transcriptome and the\nsurrounding another lumen in Org15. Nuclei were continually tracked in 3D using transcriptome of clusters in mouse reference samples31 across the one-to-one\na new large-scale tracking and track-editing framework, Mastodon (preview), a orthologous highly variable genes between human and mouse (Ensembl version\nnext-generation software of the successful tools51,52 developed by the Tomancak 93) in the reference dataset. k-nearest neighbors (k = 50) of each organoid cell\nlaboratory at the MPI-CBG (https://sites.imagej.net/Mastodonpreview/) as a in the mouse reference were identified, and the major reference cell niche label\nplugin in Fiji. It allows semi-automated tracking and manual curation of nuclei was transferred to the organoid cell. The regional label of an NEC in the early\ntracks. During lumen expansion and growth, some nuclei tracks are prematurely cerebral organoid was then decided in a hierarchical manner. In brief, an NEC\nterminated when they move out of focus. was defined as a hindbrain cell if the projected niche had hindbrain identity.\n Otherwise, it was defined as a midbrain cell if the projected niche had midbrain\nQuantification of scar family-composition differences between clusters. To identity. Only if the projected niche only had forebrain identity, the NEC was\nquantify scar family-composition differences between clusters, proportions of defined as a forebrain cell.\ncells in different scar families of each barcode family were calculated. To increase Focusing on the 13 barcode families (six and seven barcode families in each of\nthe robustness of the estimate, one pseudocount was added to each scar family the two samples) with at least 20 PSCs and NECs, a two-sided χ2 test was applied\nbefore calculating proportions. Here, only barcode families satisfying the following to compare proportions of NECs with different estimated regional identities in\ncriteria were considered: (1) families that contain at least five scarred cells and (2) different barcode families. On the other hand, a two-sided Fisher’s exact test was\nthe second most frequent scar contains at least 10% of scarred cells in the barcode applied to cells in one barcode family (BF1 in sample 1) to compare proportions of\nfamily. For each cell cluster, its scar family proportions of different barcode families NECs with different estimated regional identities in different scar families.\nin different organoids were concatenated to represent its scar family composition\n(denoted as si). Scar family-composition differences between two clusters i and j Microdissection of single organoid regions. A 200-µm slice of a single organoid\n(denoted as di,j) were then defined as the Euclidean distance between si and sj. (Org13) was cut with a vibratome. Regions that were spatially distinct were selected\n To estimate the statistical significance of the scar family distance between two and microdissected away from the slice. Each microdissected area was dissociated\nclusters, 1,000 random shufflings of scars were performed. During each shuffling, (as described above), adjusting times and volumes to account for smaller tissue\nthe scar information of cells in the same barcode family was randomly shuffled. input. Following single-cell isolation, cells were captured using 10x Chromium\nAfterward, the shuffled scar family distance di,j was calculated in the same manner targeting 17,000 cells per region across four separate reactions such that each\nas described above. The observed scar family distance was then normalized into region was split into two capture reactions. Transcriptome, barcode and scar\nthe z score zi,j = di,j − mean(d′i,j ) (s.d. d′i,j )−1. A z score that is significantly libraries were prepared as described above. All libraries were pooled and sequenced\n ( ) ( )\nlarger than zero indicates a significantly large scar family-composition difference on the Illumina NovaSeq S1.\nbetween two clusters, implying that fate restriction occurred when scarring The resulting sequencing reads were aligned and preprocessed as described\nwas induced. above. Seurat (version 3.1) was applied for log normalization and highly variable\n To capture the global restriction signal, the distribution of observed z scores gene identification (vst method, 5,000 genes; Supplementary Table 6). PCA was\nacross all cluster pairs was subtracted by the average distribution of the 1,000 applied to z-transformed expression levels of the highly variable genes, with the top\nshuffling-based results, resulting in the excess of frequency at different z scores. 20 PCs used for UMAP embedding construction and Louvain clustering (with a\nIf significant excess of frequency is observed for positive z scores, it indicates resolution of 0.6). Cell cluster annotation was performed by combining canonical\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\nmarker gene expression and CSS projection of cells to the whole-organoid 05888). Additionally, 2 µg ml−1 doxycycline was added to the doxycycline-exposed\nscRNA-seq data described above. In brief, whole-organoid CSS representations of cell suspension. In total, 100 µl of the cell solution and 50 µl of the lipofection\ncells in the scRNA-seq data from microdissected samples were calculated as the solution were combined for each condition in a well of a 96-well plate coated with\nnormalized Spearman correlation between the cell transcriptome and the average Matrigel (Corning, 35248). After 24 h, wells were washed with 150 µl DPBS (Gibco,\ntranscriptome of cell clusters in whole-organoid scRNA-seq data. The k-nearest 14190250), and medium was exchanged with 150 µl fresh StemFlex medium. After\nneighbors (k = 50) of each cell in the whole-organoid scRNA-seq data were lipofection (48 h), cells reached ∼80% confluency. Wells were washed with 150 µl\nidentified as those with the shortest Euclidean distances at CSS representations. DPBS, and the gDNA content of cells was extracted by adding 50 µl QuickExtract\nThe major cell cluster label of the identified neighbors was assigned to the query solution (Epicentre, QE0905T) according to the manufacturer’s protocol.\ncell in the scRNA-seq data from microdissected samples as the transferred label to Amplification of each guide target site was performed by PCR using specific\nassist annotation of scRNA-seq data from microdissected samples. primers containing Illumina sequencing adaptors (Supplementary Table 5).\n Barcode family-composition similarities between cell clusters were quantified gDNA treated with QuickExtract (1 µl) from each condition was combined with\nas described above. Hierarchical clustering was applied to the random barcode 1 µl of the corresponding forward and reverse primers, 10 µl Phusion HF MasterMix\nshuffling-based quantification (ward.D2 method) to group cell clusters into three (Thermo Scientific, F-531L) and 7 µl nuclease-free water before the reaction was run\ngroups. Scar family-composition differences between cell clusters in each of the in a thermocycler with the following program: 98 °C, 30 s; 30 × (98 °C, 8 s; 62 °C, 20 s;\nthree groups were then quantified as described above. 72 °C, 22 s); 72 °C, 7 min 30 s. Indexing PCR was then performed by combining 1 µl\n To study the neurogenic synchrony of different stem cells, pseudotime analysis of the previous PCR product with 12.5 µl Phusion HF MasterMix, 9 µl nuclease-free\nwas applied to cells from the microdissected R2, which were in CG3-1. Pseudotime water and 1.25 µl unique P5 and P7 Illumina indices from the Nextera XT Index kit\nanalysis was performed with a diffusion map (implemented in the destiny R version 2, set A (Illumina, FC-131-2001) before running the following thermocycler\npackage) on the top 20 PCs of selected cells. The ranked first diffusion component program: 98 °C, 30 s; 25 × (98 °C, 10 s; 58 °C, 10 s; 72 °C, 20 s); 72 °C, 5 min.\nwas used as the pseudotime value of each cell. The constructed pseudotime course Double-indexed libraries were pooled and purified twice with SPRI beads (0.9×).\nwas split evenly into ten bins. The number of cells in each scar family and each Purified libraries were sequenced on the MiSeq (Illumina), resulting in paired-end\nbarcode family was counted for each pseudotime bin. Distributions of cells in sequences of 2 × 150 bp. Finally, guide cutting efficiency was determined from the\ndifferent pseudotime bins of different barcode or scar families were compared sequencing results using CRISPResso2 (ref. 54) with default settings.\nusing a χ2 test.\n Preparation of iTracer-perturb organoids. iCRISPR cells were cultivated\nEstablishment of iTracer-perturb. iTracer-perturb plasmids were constructed in six-well plates using standard feeder-free conditions in mTeSR1 (Stemcell\nby modifiying the iTracer plasmids in four main steps. All steps were carried Technologies) on Matrigel-coated plates. Cells were infected with 65 µl lentivirus\nout using Gibson assembly unless otherwise specified. (1) Replacement of the per well. Transfected cells were allowed to expand for 4 d before flow cytometry. To\nsequence for GFP on iTracer with that for RFP–2A–GFP or BFP–2A–GFP. (2) select for cells with successful integration of both TSC2-targeted and nontargeted\nCloning and incorporation of TSC2-targeting or nontargeting gRNA species driven iTracer-perturb, RFP+GFP+ and BFP+GFP+ cells were sorted into separate flow\nby the bovine U6 promoter. (3) Construction of the pLenti vector containing cytometry tubes and plated in 12-cell Matrigel-coated plates with mTeSR1.\na hygromycin resistance gene driven by the PGK promoter. (4) Movement of Following cell recovery after flow cytometry, 2,000 cells per well in a 96-well\niTracer-perturb from the pSBbi backbone to the pLenti backbone. In detail, the plate (10% RFP+GFP+, 10% BFP+GFP+ and 80% wild-type cells) were seeded\nsequence for the 2A peptide was included as an overhang on oligonucleotides used and differentiated into cerebral organoids using a whole-organoid differentiation\nto amplify sequences for GFP, RFP and BFP. The overhand was turned into an protocol5,22. Organoids were scarred by activation of inducible Cas9 at day 5.\noverlap region that enabled assembly onto the long-range PCR-amplified iTracer Scarring was achieved using 8 µg ml−1 doxycycline in NIM for 24 h. Organoids\nbackbone. Sequences for either TSC2-targeting or nontargeting gRNA were cloned were incubated in scarring medium for 24 h before returning to base medium\ninto the PMJ114 vector (Addgene, 85995) downstream of the bovine U6 promoter without doxycycline.\nfollowing instructions in the Perturb-seq manual. Sequences for corresponding Organoids were dissociated as previously described, and RFP+, GFP+ and BFP+\nbovine U6 promoter-driven gRNA species were amplified by PCR and cloned cells were sorted into separate pools by flow cytometry. Cell pools were directly\nupstream of sequences for human U6 promoter-driven gRNA species targeting loaded onto the 10x microfluidic chip device. Single-cell cDNA was synthesized\nGFP in the iTracer plasmid. In parallel, the PGK promoter and hygromycin according to the manufacturer’s recommendations before continuing to library\nresistance gene were respectively amplified from AAVS1-mEGFP (Addgene, preparation with 25% of the total cDNA volume. Libraries were sequenced on the\n114404) and the Hygro-Cas9 donor (Addgene, 86883) and assembled onto the Illumina NovaSeq S1. Barcode and scar regions were amplified from 30–50 ng\npLenti backbone from PMJ114. iTracer-perturb was then moved from the pSBbi of cDNA remaining from the scRNA-seq preparation with three separate PCR\nbackbone to the pLenti vector between the 5′-LTR and PKG-hygroR. Barcodes reactions. First, cDNA was amplified, broadly targeting a region containing both\ngenerated by PCR using oligonucleotides containing random nucleotides as a the scar and barcode; this was performed by monitoring qPCR amplification and\ntemplate were introduced at the last step into the pLenti-PLT vector. stopping amplification before the plateau. Subsequently, the reaction was split\n Lentiviruses were packaged by first culturing HEK293T cells in DMEM with equally, and we performed PCR, separately targeting the barcode and scar regions\n10% FBS and antibiotics at 37 °C in an atmosphere with 5% CO2. To prepare (primer sequences are provided in Supplementary Table 5). Lastly, we added\nlentiviruses, HEK293T cells were passaged 1:2 every day for at least 2 d for optimal Illumina sequencing adaptors. Following every PCR reaction, samples were cleaned\ncell conditions. Cells at 90% confluency were transfected with pLenti plasmids, up using magnetic beads (0.9×) (Beckman Coulter), and libraries were sequenced\npGag/pol, pVSVG, pRev and pTat using the TransIT-293 transfection reagent on the Illumina NovaSeq S1.\n(Mirus Bio). Medium containing transfection reagents was replaced 16 h after\ntransfection with rich medium containing 30% FBS. Lentiviruses were collected Analysis of iTracer-perturb. scRNA-seq and iTracer readouts were aligned\n48 h after transfection and concentrated 50× using the Lenti-X concentrator as previously described. Seurat (version 4) was applied to scRNA-seq data for\n(Takara Bio) following the manufacturer’s instructions. Concentrated lentiviruses preprocessing. Generally, cells with less than 1,000 detected genes as well as those\nwere preserved in a −80 °C freezer until use. with mitochondrial transcript proportion greater than 10% were excluded. After\n log normalization, 3,000 highly variable genes were identified using the default\nValidation of TSC2 guide cutting. Guides were designed using vst method, in which cell cycle-related genes, mitochondrial genes and ribosomal\nCRISPRdirect targeting exons 11, 13, 22 and 28 of TSC2 (ref. 53): protein-encoding genes were excluded. Cell cycle scores were then calculated\nGGCCATGGCATGTCCGAACG, GTGGATGGACTGCGCTCTAT, and regressed out from highly variable gene expression to reduce its confounding\nTGGACAAGGCCACGACGCAC and ACCGGGACCCGGTCGTTACT, effect. Regressed-out expression levels were then z transformed, followed by PCA\nrespectively. iCRISPR iPSCs were cultured in StemFlex medium (Gibco, A3349401) for dimension reduction (the top 20 PCs were used). CSS was then calculated in a\nsupplemented with 1:200 penicillin–streptomycin (Gibco, 15140-122) unless manner similar to that described above (clustering resolution of 1) to integrate cells\notherwise mentioned. Before lipofection (24 h), cells were treated either without or sorted by different fluorescence signals. PCA was then applied to further summarize\nwith 2 µg ml−1 doxycycline (Clontech, 631311) in StemFlex medium to induce Cas9 the calculated CSS into ten PCs. UMAP and Louvain clustering (with a resolution\nexpression. The Alt-R CRISPR–Cas9 System (IDT) was used for guide delivery of 0.5) was applied to the PCA-on-CSS representation. Cluster annotation was\nwith lipofection according to the manufacturer’s protocol. To form the crRNA– performed by combining expression patterns of canonical cell type markers. We\ntracrRNA complex at a final concentration of 3 µM for each guide complex, 1.5 µl detected at least one barcoded transcript for GFP in 221 RFP+ and 3,808 BFP+\nof each guide crRNA was combined with 3 µl tracrRNA and 44 µl Nuclease-Free cells, with 19.7% of these cells containing at least one GFP scar. For each cluster,\nDuplex Buffer (IDT, 11-01-03-01) and heated at 95 °C for 5 min. For reverse the number of RFP+ or BFP+ cells with at least one GFP scar detected (that is, fully\ntransfection, 1.5 µl of the crRNA–tracrRNA complex mix and 0.75 µl RNAiMAX informative cells) was calculated. Cell clusters with at least 100 fully informative\n(Invitrogen, 13778075) were diluted in 47.75 µl Opti-MEM (Gibco, 1985-062) and cells were defined as sufficiently scarred clusters and used for the following analysis.\nincubated for 20 min at room temperature. During incubation, ∼70% confluent Mixscape analysis, adapted from the online tutorial (https://satijalab.org/seurat/\niCRISPR cells from both the no-doxycycline control and doxycycline-exposed articles/mixscape_vignette.html), was applied to cells in these clusters to obtain the\ncells were detached separately with TrypLE (Gibco, 12605010), centrifuged and posterior perturbation probability, using BFP+ cells as nontargeting cells and RFP+\nresuspended at a concentration of 400,000 cells per ml in StemFlex medium cells as targeting cells. Next, a five-layer lineage tree was reconstructed for cells in\nwithout penicillin–streptomycin supplemented with 1:10 CloneR (Stemcell, the sufficiently scarred clusters using a method similar to the one described above.\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\nOne extra layer (RFP+ or BFP+) was added between the organoid layer and the 48. Pinello, L. et al. Analyzing CRISPR genome-editing experiments with\nbarcode family layer. UMAP and Louvain clustering (with a resolution of 1) was CRISPResso. Nat. Biotechnol. 34, 695–697 (2016).\nfurther applied to dissect cell state heterogeneity. 49. Butler, A., Hoffman, P., Smibert, P., Papalexi, E. & Satija, R. Integrating\n To compare transcriptomic profiles of RFP+ and BFP+ cells as well as different single-cell transcriptomic data across different conditions, technologies, and\nscar families of BFP+ cells, we applied analysis of covariance to genes detected in species. Nat. Biotechnol. 36, 411–420 (2018).\nat least 1% of cells. For each gene, we applied an F-test to compare the full model 50. Pietzsch, T., Saalfeld, S., Preibisch, S. & Tomancak, P. BigDataViewer:\nwith both covariates (cell clusters and log-transformed UMI numbers) and the visualization and processing for large image data sets. Nat. Methods 12,\ncondition variable (for example, RFP+ or BFP+) and the reduced model with only 481–483 (2015).\nthe covariates. DEGs were defined as genes with Bonferroni-corrected P < 0.01, 51. Wolff, C. et al. Multi-view light-sheet imaging and tracking with the MaMuT\nwith the coefficient of the condition variable greater than 0.1 or less than −0.1. software reveals the cell lineage of a direct developing arthropod limb. eLife 7,\n To compare the cell state trajectory of different cell lineages, pseudotime was e34410 (2018).\nconstructed to represent the cell state transition from NECs to NPCs. In brief, cell 52. Tinevez, J. Y. et al. TrackMate: an open and extensible platform for\ncycle scores were first regressed out from PCA-on-CSS representations, followed by single-particle tracking. Methods 115, 80–90 (2017).\ndiffusion map analysis of the resulting representations. The resulting first diffusion 53. Naito, Y., Hino, K., Bono, H. & Ui-Tei, K. CRISPRdirect: software for\ncomponent was ranked across cells and considered as the pseudotime. designing CRISPR/Cas guide RNA with reduced off-target sites.\n Bioinformatics 31, 1120–1123 (2015).\nFlow cytometry. To select iTracer+ iPSCs, cells were detached from 54. Clement, K. et al. CRISPResso2 provides accurate and rapid genome editing\nMatrigel-coated plates to create a single-cell suspension. Briefly, cells were washed sequence analysis. Nat. Biotechnol. 37, 224–226 (2019).\nwith DPBS before being lifted from the Matrigel plate with Accutase for 5–7 min\nbefore quenching with KnockOut Media and centrifuging at 200g for 5 min. Cells Acknowledgements\nwere resuspended and filtered through a 30-µm cell strainer in 500 µl mTeSR1 We thank J.P. Junker, B. Spanjaard and B. Hu for inspiring discussions and protocols.\nsupplemented with Rock inhibitor (1:200) and Primocin (1:500). Cells were We also thank the Camp and Treutlein laboratories for their support and particularly\nsorted on the BD Aria Fusion or the BD Aria III using a 100-µm nozzle, selecting acknowledge B. Kashanian and R. Okamoto for their assistance with stem cell\nfor single cells and excluding doublets, based on their florescent reporter. For and organoid culture. We also thank A. Boni and P. Strnad for helping us acquire\niTracer experiments, selection was based on GFP or RFP positivity, whereas movies of developing organoids with their light-sheet system. Additionally, we\niTracer-perturb cells were identified based on dual expression (RFP and GFP; BFP thank P. Tomancak, V. Ulman and T. Pietzsch for their support in implementing\nand GFP). All cells were sorted into mTeSR1 medium supplemented with PenStrep the Mastodon plugin for tracking light-sheet data. Illumina sequencing was\n(1:200), Rock inhibitor (1:200) and Primocin (1:500). Flow cytometry data were performed in the Genomics Facility at D-BSSE, ETH Zurich and by B. Schellbach\nvisualized with BD FACSDiva 9.0.1. and A. Weihmann at the Max Planck Institute for Evolutionary Anthropology.\n To select iTracer-perturb cells from organoids, organoids were first dissociated Flow cytometry sorting support was provided by the single-cell facility at D-BSSE,\nas previously described. After dissociation, cells were resuspended in DPBS ETH Zurich. This project has been made possible in part by the Chan Zuckerberg\nsupplemented with BSA (0.04%, Miltenyi, 130-091-376). Cells were sorted on the Initiative DAF (grant CZF2017-173814, J.G.C. and B.T.), an advised fund from the\nBD Aria Fusion or the BD Aria III using a 100-µm nozzle, selecting for single cells Silicon Valley Community Foundation, by Human Frontier in Science Program\nand excluding doublets, based on their florescent reporter (dual BFP- and GFP-, and EMBO Postdoctoral Fellowships (H.-C.L.), the European Research Council\ndual RFP- and GFP- or GFP-positivity alone). All cells were sorted into DPBS (Anthropoid-803441, J.G.C.; Organomics-758877, B.T.; Braintime-874606, B.T.), the\nsupplemented with BSA (0.04%), and flow cytometry data were visualized with Swiss National Science Foundation (project grant 310030_184795, J.G.C.; project\nBD FACSDiva 8.1. grant 310030_192604, B.T.) and the National Center of Competence in Research,\n Molecular Systems Engineering (B.T.). H.-C.L. is supported by the Human Frontier\nStatistics and reproducibility. No statistical method was used to predetermine Science Program (LT000399/2020-L).\nsample size. No data were excluded from analysis. Experiments were not\nrandomized. Investigators were not blinded to allocation during experiments\nand outcome assessment. Boxes in all the box plots represent upper and lower Author contributions\nquartiles. The center line represents the median. Whiskers show the minimum T.G., B.T. and J.G.C. designed the iTracer system. R.P., T.G., L.S. and S.R. established\nand maximum of the data if there is no outlier. Outliers are defined as data points the iTracer system. H.-C.L. and A.M. established the iTracer-perturb system. J.-S.D.\noutside 1.5 times the interquartile range above the upper quartile and below validated iTracer-perturb gRNA species. M.S., R.P. and A.M. performed flow cytometry.\nthe lower quartile. Only one cerebral organoid was imaged by 4D light-sheet R.P., A.M., A.J., F.S.C. and S.M.J.J. performed organoid culturing. R.P., A.M. and T.G.\nmicroscopy and is shown in Fig. 3b–d and Extended Data Fig. 6a,c. Bright-field performed bulk and single-cell genomic experiments. A.M. and J.G.C. performed\nand fluorescence imaging of iTracer reporter (RFP) in organoids shown in organoid microdissection experiments. A.M. performed organoid spatial transcriptomic\n microscopy. A.J., K.L., M.S. and Z.H. performed nuclei tracking and data analysis. Z.H.,\nReporting Summary. Further information on research design is available in the A.M., T.G., A.J., J.G.C. and B.T. designed the study and wrote the manuscript.\nNature Research Reporting Summary linked to this article.\n Competing interests\nData availability The authors declare no competing interests.\nSequence data that support the findings of this study have been deposited in\nArrayExpress under the accession codes E-MTAB-10973, E-MTAB-10974\n(scRNA-seq data based on 10x Genomics), E-MTAB-10972 (spatial transcriptomic\n Additional information\n Extended data is available for this paper at https://doi.org/10.1038/s41592-021-01344-8.\nRNA-seq data based on 10x Visium) and E-MTAB-10971 (iTracer-perturb data).\nBulk sequencing of barcode and scar library data as well as processed sequencing Supplementary information The online version contains supplementary material\ndata have been deposited in Mendeley Data at https://doi.org/10.17632/nj3p3pxv6p. available at https://doi.org/10.1038/s41592-021-01344-8.\n Correspondence and requests for materials should be addressed to\nCode availability J. Gray Camp or Barbara Treutlein.\nThe computational code used in this study is available at GitHub (https://github. Peer review information Nature Methods thanks Samantha A. Morris and the other,\ncom/quadbiolab/iTracer) or upon request. anonymous, reviewer(s) for their contribution to the peer review of this work.\n Editor recognition statement: Madhura Mukhopadhyay was the primary editor on this\nReferences article and managed its editorial process and peer review in collaboration with the rest of\n47. Datlinger, P. et al. Pooled CRISPR screening with single-cell transcriptome the editorial team.\n readout. Nat. Methods 14, 297–301 (2017). Reprints and permissions information is available at www.nature.com/reprints.\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n\niTracer positive cells. Cells were gated first based on the main population to avoid debris, followed by gating for single cells excluding doublets, and lastly\nsorted for RFP or GFP positive cells as compared to non-fluorescent negative controls. (b) Brightfield and fluorescence imaging of iTracer reporter (RFP)\nin representative organoids during cerebral organoid development. Scale bar is 500 µm in all images (c) Stacked bar plots showing frequency of unique\nbarcodes detected in bulk targeted amplicon sequencing libraries throughout cerebral organoid development. (d) Barplots of the number of iTracer\nbarcodes detected from single-cell transcriptomes. The left panel shows frequencies of cells with different numbers of detected barcodes. The dashed\nline shows the average number of detected barcodes per cell (2.85). The middle panel shows numbers of barcodes in relation to fluorescent reporter\ndetection. Each dot represents one cell. The right panel shows frequencies of barcodes detected in different numbers of cells. The dashed line indicates\nthat on average one barcode is detected in 1.54 cells. (e) Scar detection in iPSCs treated with no doxycycline, 2 µg of doxycycline for one day, and 2 µg of\ndoxycycline for two days. (f) Bar plots showing percentage of scarred GFP transcripts detected in 3D cultures treated with 0-8 µg of doxycycline at EB and\nneuroectoderm stages (mean values +/− SEM). Dots show the values of individual samples.\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\nfrom two batches of iTracer whole-organoids without integration, colored by organoid. (b) UMAP embedding of single-cells from two batches of iTracer\nwhole-organoids colored by cell type annotation (telen. - telencephalon; dien./mesen. - diencephalon/mesencephalon; rhomben. - rhombencephalon;\nneural crest deriv. - neural crest derivatives). (c) UMAP colored by expression of selected marker genes. (d) Schematic of cluster annotation of CSS\nintegrated whole-organoid data using VoxHunt. Similarity scores are calculated between average gene expressions of identified clusters in the wholeorganoid data and in situ hybridization signals in the E13.5 mouse brain in Allen Brain Atlas. (e) Sagittal projections colored by scaled similarity scores of\neach cluster from integrated whole-organoid data to voxel maps of the E13.5 mouse brain. (f) Heatmap of cell type and cell state marker genes across all\nCSS integrated whole-organoid clusters (mesen. - mesenchyme).\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\n\ngrey), where only iTracer reporter was captured (light grey), with reporter and barcodes (dark grey) or reporter, barcodes and scars (black). (b) Histograms\nof the cell numbers with different numbers of barcodes detected across all 12 organoids. (c) Stacked barplot showing the proportion of cells with barcode\ndetected under different iTracer reporter transcript cutoffs. (d) Barplot of the number of barcode families and sizes of families detected. (e) UMAP embedding\nof scRNA-seq data of 44,275 cells from 12 cerebral organoids, cells are colored by cluster and boxplot of iTracer reporter expression (eGFP or Tomato) for\neach cluster in the corresponding UMAP projection. (f) Stacked bar plots showing frequency of unique scars among all 12 organoids. (g) Barplot of number of\nscars and scar lengths detected.\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n\nwith hierarchical clustering (ward.D2 method) applied to cell-number-normalized barcode family composition distances. (b) Heatmap of similarity of\norganoid composition, defined as the Pearson’s correlation coefficient between cell frequencies of each cluster across different organoids, with hierarchical\nclustering (ward.D2 method) applied to the correlation distances between cell frequencies of clusters across different organoids.\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n(b-g) 3D spatial feature plots of expression of genes marking different cell types and brain regions. (h) 3D spatial feature plots of expression of iTracer\nRFP reporter. (i) 3D spatial plot of spots with (red) and without (grey) iTracer barcodes detected. Barplot of detected iTracer barcodes across all sections.\nScatterplot of detected barcodes and iTracer RFP reporter. (j) Spot plot for section 1 colored by deconvolved cell type assignment by CIBERSORTx. (k)\nSpot plot for each section (S1-S3), colored by deconvolved cell type assignment by CIBERSORTx (l) spot comparison between ML-based (Fig. 2b-d) and\nCIBERSORTx spot annotations (m) NPC and neuron scores plotted for section 1 (n) UMAP embedding of spots from sections 1-3 colored by regional\nidentity, NPC/neuron scores, and expression of selected genes. (o) Boxplots of the iTracer barcode composition of each spot pair vs the spatial distance of\neach spot pair across all sections (S1-S3) in any regions (left), same cell type regions (middle) and different cell type regions (right). Two-sided Wilcoxon\nrank sum tests were performed comparing shared to same and exclusive groups, *** indicates p-values<0.0001 (n > 2898 spot pairs). (p) Scatter plots of\nbarcode distance between each spot pair at the same section vs their spatial distance, in all the three sections, in any regions (left), same cell type regions\n(top-right) and different cell type regions (bottom-right). (q-r) 3D plot of spots across the three tissue sections where different scars on two example\nbarcodes: barcode 5 (q) and barcode 6 (r) are highlighted. Boxplots show the distributions of spatial distances between spots with the same scar or with\ndifferent scars. P values represent unadjusted two-sided Wilcoxon test significance (nShared = 298 (c), 4200 (d); nDiff = 1206 (c), 24268 (d) spot pairs from\nthree slices). (s) Stacked bar plots showing the proportion of spots with different annotated brain regional identities, with each bar representing spots with\none barcode and one scar detected. P values show the χ2 test significance without adjustment.\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\n\ntwo daughter nuclei in the developing organoid. White circles represent manual detection and tracking over time. (b) Scatter plot shows increase in the\nnumber of nuclei over 100 hours of tracking in lineage one (L1). The curve shows the exponential model estimated by the data, with the estimated doubling\ntime being 17.3 hours. (c) Nuclei tracking of three lineages (L1-L3) in the same lumen area (top) and of a fourth lineage (L4) surrounding a diametrically\nopposite lumen (bottom). Scale bar is 100 µm in all images. (d) Lineage trees for the four tracked nuclei lineages. (e) Spatial distribution in the x-y plane\nof the four tracked lineages. Nuclei are shown at 0 hours and 65 hours, colored by lineage. (f) Dotplot shows the increase in the number of daughter nuclei\nfor all four lineages over 65 hours.\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n\nreconstructions, as well as the subset of cells where scars were detected from 9 organoids. The first and second order deviation nodes represent barcode\nand scar families respectively, with the terminal branches indicating individual cells. Each cell is colored based on the cell type designation.\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\n\nby annotated cell types or samples. (b) Expression of genes marking different cell types. (c) Overview of the developing mouse brain scRNA-seq atlas [La\nManno preprint]. Cells are colored by annotated cell classes or sample ages. (d) A subset of cells, representing the early neural tube cells (ENTCs) and\nradial glia (RG) in different regions of the developing mouse brain, were selected and integrated using CSS. (e-f) UMAP embedding of mouse ENTCs and\nRG with cells colored by (e) sample ages and (f) dissected tissues. (g) Expression of genes marking different brain regions and genes encoding selected\nmorphogens. (h) UMAP embedding of mouse ENTCs and RG with cells colored by cell clusters (left) or cluster regional identities (right). Labels show the\norganizer cells. (i) Schematic showing the computational workflow of projecting human early cerebral organoid cells to the developing mouse brain ENTCs\nand RG references to estimate their regional identities.\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n\nNature Methods | www.nature.com/naturemethods\n\nArticles NaTuRE METHODS\nfor single-cells from two regions of a micro-dissected organoid to the whole-organoid scRNA-seq data to assist cell annotation. UMAP embedding\nof single cells colored by projected annotation from the whole-organoid scRNA-seq data. (b) Expression of selected cell type markers in cells in the\ntwo regions of the micro-dissected organoid. (c) Heatmap of cell type and cell state marker genes across all micro-dissected organoid clusters. (d)\nHierarchical clustering of the micro-dissected organoid clusters, based on the barcode family composition distances. UMAP embedding of single-cells\nis colored by the resulting three groups of clusters (CG.1-CG.3). Clusters in each group share similar barcode family compositions. (e) Hierarchical\nclustering of cluster group 2 (CG.2) based on scar family composition distance, to identify two subgroups of clusters. Clusters in each of the subgroups\nshare similar scar family compositions. (f) Stacked bar plots showing distributions of cell proportions across subgroups of CG.2 clusters with distinct scar\nfamily compositions. Each stacked bar shows a different scar family in the same example barcode family 3. (g) UMAP embedding of cells in CG.2 clusters,\ncolored by the two cluster subgroups with distinct scar family compositions, and expression of example genes with differential expression between the\ntwo subgroups. (h) Hierarchical clustering of cluster group 3 (CG.3) based on scar family composition distance, to identify three subgroups of clusters.\nClusters in each of the subgroups share similar scar family compositions. (i) Stacked bar plots showing distributions of cell proportions across subgroups\nof CG.3 clusters with distinct scar family compositions. Each stacked bar shows a different scar family in the same example barcode family 4 (left) or\nbarcode family 5 (right). (j) UMAP embedding of cells in CG.3 clusters, colored by the three cluster subgroups with distinct scar family compositions, and\nexpression of example genes with differential expression between the two subgroups.\n\n Nature Methods | www.nature.com/naturemethods\n\nNaTuRE METHODS Articles\n\n(b) Bar plots of cut efficiency, represented as fold changes of modified read proportions to negative controls, at the predicted target site when different\ngRNAs were lipofected. (c) FACs plots of sorting scheme used to isolate TSC2-targeting and non-targeting perturb-iTracer positive cells. Cells were\ngated first based on the main population to avoid debris, followed by gating for single cells excluding doublets, and lastly sorted for GFP + RFP positive\n(TSC2-targeting) or GFP + BFP positive (non-targeting) cells as compared to non-fluorescent negative controls. (d) FACs plots of sorting scheme used\nto isolate cells in the TSC2-perturb-iTracer organoid. Cells were firstly gated similar to (c), and lastly sorted for GFP-only positive, RFP positive and BFP\npositive cells. (e-g) UMAP embeddings show the complete scRNA-seq data in the cerebral organoid, with cells colored by (e) their cell clusters and\nannotations, (f) expression of selected marker genes, and (g) fluorescence of all cells or only cells with GFP scars. (h) Numbers of RFP + /BFP + cells with\nGFP scars in each cell cluster. The dash line shows 100 cells. Clusters with at least 100 RFP + /BFP + cells with GFP scars are considered as sufficiently\nscarred clusters. (i) UMAP embeddings show cells in the sufficiently scarred clusters, colored by their fluorescence, cell clusters and scar families (>=20\nmembers). (j) Mixscape-estimated posterior probability of perturbation, with BFP + cells as non-targeting and RFP+ cells as targeting. The numbers show\nthe cell number estimated in each category. (k) Lineage plot of cells in the sufficiently scarred clusters. The first order deviation nodes represent BFP+ and\nRFP+ cells; second and third order deviation nodes represent barcode and scar families respectively. The terminal branches indicate individual cells. Each\ncell is colored based on the cell cluster designation. (l) Numbers of cells in different BFP + scar families, and numbers of DEGs identified between cells in\neach BFP+ scar family and other BFP + cells. (m) Frequency of genes identified as DEGs between different BFP+ scar families. Genes detected as DEGs in\nat least three BFP+ scar families are defined as reproducible clonal DEGs. (n) DAVID functional enrichment of reproducible clonal DEGs.\n\nNature Methods | www.nature.com/naturemethods",
      "rationale": "heuristic fallback",
      "detected_categories": [
        {
          "id": "molecular_cloning",
          "hits": 95,
          "confidence": 1.0,
          "matched_patterns": [
            "clon",
            "ligation",
            "plasmid",
            "vector",
            "insert"
          ]
        },
        {
          "id": "sequencing_library_prep",
          "hits": 79,
          "confidence": 1.0,
          "matched_patterns": [
            "sequenc",
            "illumina",
            "hiseq",
            "miseq",
            "library"
          ]
        },
        {
          "id": "microscopy_imaging",
          "hits": 64,
          "confidence": 1.0,
          "matched_patterns": [
            "microscop",
            "fluorescen",
            "\\bimag"
          ]
        },
        {
          "id": "cell_culture",
          "hits": 39,
          "confidence": 1.0,
          "matched_patterns": [
            "cultured",
            "incubat",
            "passage",
            "confluen",
            "\\bwell\\b"
          ]
        },
        {
          "id": "dna_rna_extraction",
          "hits": 35,
          "confidence": 1.0,
          "matched_patterns": [
            "lysis"
          ]
        },
        {
          "id": "pcr_qpcr",
          "hits": 35,
          "confidence": 1.0,
          "matched_patterns": [
            "\\bpcr\\b",
            "\\bq\\s*pcr\\b",
            "primer",
            "amplicon"
          ]
        },
        {
          "id": "animal_experiment",
          "hits": 28,
          "confidence": 1.0,
          "matched_patterns": [
            "\\bmouse\\b",
            "zebrafish",
            "in vivo"
          ]
        },
        {
          "id": "transfection",
          "hits": 22,
          "confidence": 1.0,
          "matched_patterns": [
            "transfect",
            "lipofect",
            "electroporat",
            "nucleofect"
          ]
        },
        {
          "id": "flow_cytometry",
          "hits": 14,
          "confidence": 1.0,
          "matched_patterns": [
            "flow cytometr",
            "\\bfacs\\b"
          ]
        },
        {
          "id": "purification_cleanup",
          "hits": 11,
          "confidence": 1.0,
          "matched_patterns": [
            "purif",
            "magnetic bead"
          ]
        },
        {
          "id": "centrifugation",
          "hits": 5,
          "confidence": 1.0,
          "matched_patterns": [
            "centrifug"
          ]
        },
        {
          "id": "gel_electrophoresis",
          "hits": 3,
          "confidence": 0.75,
          "matched_patterns": [
            "agarose gel",
            "\\bband\\b"
          ]
        }
      ],
      "split_audit": {
        "char_count": 123383,
        "word_count": 19406,
        "sentence_count": 1376,
        "category_count": 12,
        "flags": [
          "UNIT_CATEGORY_OVERMIXED"
        ]
      }
    }
  ],
  "created_at": "2026-02-17T06:45:39.605354+00:00"
}