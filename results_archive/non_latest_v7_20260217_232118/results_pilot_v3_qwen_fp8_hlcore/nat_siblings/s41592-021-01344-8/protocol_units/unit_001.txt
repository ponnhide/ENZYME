Methods such as RNA velocity provide an additional layer of infor- tion. Immunohistochemistry has shown that diverse brain regions
mation to assist with inferring differentiation trajectory and fate can form within these tissues, and the relative positions of certain
potentials11. However, it is not possible to use these inferences to brain regions suggest that regional patterning gradients emerge that
identify direct cell lineages; therefore, it remains difficult to study are reflective of in vivo development23. It was shown in forebrain
how lineages are established during organoid self-organization. organoid models that the range of dorsoventral identities can be
Several lineage-coupled single-cell transcriptomic strategies generated within a continuous neuroepithelium and that organizhave emerged to investigate clonal expansion and differentiation ing centers emerge that express secreted growth factors associated
in mouse and zebrafish embryos as well as complex multicellu- with dorsoventral patterning22. Single-cell transcriptome analysis
lar culture systems12–16. These efforts rely on either expression of over a time course of cerebral organoid development confirmed
reporter transcripts tagged with a unique sequence barcode12,16, that diverse brain regions form within individual organoids5 and
scarring patterns generated by CRISPR–Cas9 genomic modi- that brain region signatures in organoids strongly resemble counfication of expressed targets13–15 or a combination of the two15,17. terparts from spatial in situ atlases of the developing mouse brain24.
Lineage-coupled scRNA-seq has allowed for better annotation of However, very little is known about spatiotemporal lineage dynamcell fate specifications and trajectory inferences in complex tissues ics during organoid formation and patterning or how these dynamand other cell differentiation scenarios. Additionally, image-based ics relate to the establishment of neuronal fates.
methods such as four-dimensional (4D) light-sheet microscopy We used iTracer to explore lineages coupled with molecular
provide a complementary approach to capture comprehensive signatures during brain organoid patterning and neurogenesis and
developmental dynamics in tissues and embryos18,19. Long-term show that the system is compatible with spatial transcriptomics.
live 4D light-sheet microscopy of a sample with minimum pho- We also leverage 4D light-sheet microscopy to provide an assesstotoxicity over days allows for observation and quantification of ment of clonal and morphological dynamics as the neuroepithedynamic cellular behaviors at high spatiotemporal resolution20,21. lium develops at the onset of brain regionalization. We incorporate
Subsequent analysis allows for visualization, annotation and accu- CRISPR-based gene perturbation into the lineage-recorder system
rate lineage reconstruction of development. Lineage-coupled (iTracer-perturb) to enable temporal control of gene loss of funcsingle-cell transcriptomics and long-term light-sheet microscopy tion during organoid development, providing both transcriptomic


Department of Biosystems Science and Engineering, ETH Zürich, Basel, Switzerland. 2Max Planck Institute for Evolutionary Anthropology, Leipzig, Germany.
1

3
 Institute of Molecular and Clinical Ophthalmology, Basel, Switzerland. 4Department of Ophthalmology, University of Basel, Basel, Switzerland. 5These authors
contributed equally: Zhisong He, Ashley Maynard, Akanksha Jain, Tobias Gerber. ✉e-mail: jarrettgrayson.camp@unibas.ch; barbara.treutlein@bsse.ethz.ch

90 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods

NaTuRE METHODS Articles
a d
 Clusters
 e Reporter
 iTracing AAA
 2.5 detected


 No. cells (×104)
 vector U6 RPBSA Barcode Inducible gRNA iTracer NES 100%


 Detection rate
 DCX 2.0
 ITR gRNA GFP ITR Cas9 iPSCs iPSCs
 GLI3 1.5
 FOXG1 1.0
 RSPO3 Bc.
 0.5
b Cerebral organoid
 OTX2
 HOXB2
 25% 0
 Scarred
 iTracer EB N. ecto. N. epith.
 HOXB5
 iPSCs Cells SIX6 f
 scRNA-seq t = n TTR Both (2)


 No. of scars (×103)
 Max 16
 scar MSX1


 Insertion Deletion
 Expression
 PRPH 12
Time t 0 5 8 10 12 15 20 25 30 60 t=0 SOX10
 (d) barcode EPCAM 8
 Dox-induced scarring AIF1
 DCN 4
 Min 0
 25
c Microglia Days 30–60 h Barcode families i Barcode families
 scRNA-seq
 8 Org1–1 Org2–1
 Org1–2 Org2–2
 Mesenchyme Rhombencephalon Other Other
 neurons
 Epithelial
 24 21 Diencephalon–
 Retina 1
 Neural crest mesencephalon
 20 derivatives 13 neurons
 4
 Rhomben- 5
 cephalon 16
 NPCs 11 Dorsal
 7 3 6 Organoid 1 Organoid 2
 14 telencephalon
 15 neurons
 23 19
 Diencephalon 10 22
 NPCs
 17 2 g Rhomben. Proportion of cells Proportion of cells
 0 0.2 0.4 0.6 0.8 1.0 0 0.2 0.4 0.6 0.8 1.0
 9
 18 Dorsal telen.
 12 Normalized
 BF sharing Org1–1 Telencephalon Org2–1 Mesenchyme


 *
 UMAP 2


 *
 Dorsal Telen. All Mesen.
 Min Max All
 telencephalon barcodes
 barcodes Rhomben. Rhomben.
 NPCs Non-neural


 *
 UMAP 1


 *
 Org1–2 Rhombencephalon Org2–2 Rhombencephalic


Fig. 1 | iTracer dual-channel lineage recorder uncovers clonality of cell fates in human cerebral organoids. a, Schematic of the iTracer Sleeping Beauty
vector used for lineage recording. ITR, inverted terminal repeat. b, Scarring is induced at different time points of organoid development through doxycycline
(dox) induction of Cas9. N. ecto., neuroectoderm; N. epith., neuroepithelial. c, UMAP embedding of scRNA-seq data of 44,275 cells from 12 cerebral
organoids after data integration using CSS16. Cells are colored and numbered by transcriptome cluster and labeled with brain region and cell type
annotations. d, Dot plot shows expression of genes marking clusters observed in organoids. e, Stacked bar plot showing the number of cells in which the
iTracer reporter was detected (light gray), with only barcodes (Bc., dark gray) or barcodes and scars (black). Max, maximum; min, minimum. f, Stacked
bar plot showing the number of scars created from insertions (light gray), deletions (dark gray) or both. g, Heatmap showing relative proportion of shared
barcodes between transcriptome clusters. Rhomben., rhombencephalon; telen., telencephalon. h,i, Top, UMAP embedding as in c, colored by four different
clones, showing that iPSC clones tend to accumulate in distinct brain regions or cell types. Bottom, bar plots showing proportions of cells of specific
barcode families or all barcoded cells annotated with a given regional identity. Mesen., mesenchyme. Fisher’s exact test (two sided) was performed,
comparing cell frequencies of a barcode family with those of all barcoded cells in the organoid in different clusters; *P < 0.0001.


and cell lineage readouts. In proof-of-principle experiments, we direction, 91 bases away from the RPBSA promoter, we have introtarget TSC2 (encoding tuberous sclerosis complex 2), a gene asso- duced a human U6 promoter driving a guide RNA (gRNA) that tarciated with neurodevelopmental dysplasias25–27. Using these meth- gets a region in the 3′ portion of the sequence coding for GFP or RFP.
odologies, we suggest that clone restriction plays a fundamental This iTracer construct is introduced by electroporation into iPSCs
role in cerebral organoid regionalization, identify patterning pro- that contain a doxycycline-inducible Cas9 cassette (iCRISPR)29,30.
files that are consistent with in vivo brain development and find Fluorescent cells containing the reporter can be isolated using flow
that TSC2 gene perturbations may augment metabolism and delay cytometry before being propagated or cryopreserved for later use
neural development. (Extended Data Fig. 1a,b). From these uniquely barcoded iPSCs, we
 initiate cerebral organoids using approximately 2,000 cells to record
Results lineages during organoid development (Fig. 1b). At a time point of
iTracer: a dynamic dual-channel lineage recorder. We established choice, doxycycline introduction into the medium induces Cas9
a dual-channel lineage recorder called iTracer by coupling a com- expression in organoid cells, followed by formation of Cas9–gRNA
plex barcode library together with an inducible Cas9 scarring sys- complexes, leading to double-stranded break formation at the tartem in iPSCs (Fig. 1a). The lineage recorder is based on the Sleeping geted location in the fluorescent reporter region of the recorder.
Beauty transposon system, which enables efficient transposition28 These breaks are repaired by cellular machinery, resulting in inserof exogenous DNA into multiple genomic loci within iPSCs. A tions and/or deletions at the cut site, so-called scars, which serve
poly-adenylated green or red fluorescent protein (GFP or RFP) as the second channel of our lineage recorder and can be read by
reporter is driven by the RPBSA promoter and contains a barcode sequencing the reporter transcript. Multiple barcodes and induced
(11 nucleotides of random bases) in the 3′ untranslated region, scars per cell could in principle be detected due to multiple inserwhich serves as the first channel of the recorder. In the opposite tions of the transposon-based reporter.

Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 91

Articles NaTuRE METHODS

 We measured barcode diversity using scRNA-seq data from resulted in a similar proportion of insertion and deletion scar types,
three iTracer iPSC pools and found approximately 60,000 unique which varied in overall length (Fig. 1f and Extended Data Fig. 3f,g).
sequences (Methods). We followed barcode diversity throughout Scarring efficiency varied per organoid (Supplementary Table 1);
organoid development using targeted amplicon sequencing of the yet, of those cells in which we detected a barcode, 17% were also
barcode region (Extended Data Fig. 1b,c) and found relatively stable scarred. We found 237 groups of cells sharing the same scar and
diversity over the course of organoid development from pluripo- barcode composition, which were termed scar families.
tency (Extended Data Fig. 1c). Further scRNA-seq characteriza- We first focused on barcodes, which mark clones derived from
tion of an iTracer iPSC pool revealed 2.85 barcodes per cell; the one given cell in the initializing EB, and explored the clonality of
average group size of the cells that shared the same barcode was transcriptionally distinct organoid cell clusters. We performed
1.54 cells. Cells with a higher number of barcodes also had higher a permutation enrichment analysis using single cells from all
expression of iTracer fluorescent reporter mRNA (Extended Data lineage-traced organoids together to determine the likelihood that
Fig. 1d). We next analyzed the efficiency of Cas9-induced scarring barcode families were shared between cell clusters (Fig. 1g and
at the embryoid body (EB) and neuroectoderm stages of cerebral Extended Data Fig. 4a,b). We identified three groups of cell clusters
organoid development by testing the duration and concentration of with significant enrichment of distinct barcode clones. Each group
doxycycline treatment (Extended Data Fig. 1e,f). We found scar- labeled distinct brain regional identities, indicating that there was
ring was most efficient when samples were incubated with 8 µg ml−1 a robust trend during organoid development during which initiatdoxycycline for 24 h and applied these conditions in all subsequent ing iPSC clones accumulate in distinct brain regions. Importantly,
experiments. Together, these data established suitable conditions for these results could not be solely explained by differences in cell type
lineage-coupled single-cell transcriptomics in iPSC-derived cells composition between organoids. We illustrated regional barcode
and tissues using the iTracer system. accumulation by projecting four different barcode families on the
 overall uniform manifold approximation and projection (UMAP)
iTracer reveals clonality of distinct cell populations. We next embedding and observed that iPSC clones were distributed into disset out on a series of experiments using iTracer to study lineage tinct brain regions or cell types (Fig. 1h,i).
dynamics during cerebral organoid development from pluripotency.
Organoids were generated from approximately 2,000 iPSCs contain- Spatial iTracer identifies clone enrichment in organoid regions.
ing the iTracer recorder. We induced scarring at different organoid We hypothesized that enrichment of barcodes in molecularly disdevelopmental time points (day 4, 7, 15, 20 or 30) and subsequently tinct cell populations with different brain regional identities may
performed scRNA-seq after 1, 1.5 or 2 months of culture (Fig. 1b). be associated with the spatial arrangement of clones throughout the
Time points of scarring induction were selected around critical steps organoid. To link molecular state, cell lineage and location informaof organoid development including EB formation (day 4), neural tion, we established ‘Spatial iTracer’, which uses spatial transcripinduction (day 7), neuroepithelium development (day 15) and neu- tome sequencing based on the 10x Visium platform to measure gene
rogenesis (days 20 and 30). We used cluster similarity spectrum expression and iTracer readouts. We applied Spatial iTracer to three
(CSS) analysis31 to integrate 44,275 cells from 12 organoids across two intact 10-µm tissue sections derived from one 2-month-old cerebatches (Fig. 1c, Extended Data Fig. 2a,b and Supplementary Tables 1 bral organoid scarred during the neuroepithelium stage (day 15)
and 2), resulting in 25 cell clusters. Based on marker gene analysis (Fig. 2a and Supplementary Tables 1 and 4). Briefly, each tissue secand comparisons with primary reference atlases (Methods), 90% of tion was adhered to a slide with 6.5 × 6.5-mm capture areas concells were annotated to central nervous system cell types from the taining several thousand spots, where each spot harbors millions
dorsal telencephalon, diencephalon, mesencephalon, rhombenceph- of capture oligonucleotides each with a unique spatial barcode.
alon and retina, while a small fraction was annotated as non-brain Tissue sections were permeabilized to facilitate mRNA capture, and
populations including neural crest derivatives and mesenchymal captured sequences were amplified and sequenced. We obtained
cells (Fig. 1c,d and Extended Data Fig. 2c–f). Although proportions transcriptome, barcode and scar topology of 2,038 spots, for which
of cells with different regional identities varied among individual each spot covers an area of approximately one to ten cells. We used
organoids, we detected all major cell populations in multiple organ- two independent methods (machine learning-based classification
oids, consistent with previous reports using cerebral organoids5,32. and CIBERSORTx35) to assign each spot to cell clusters identified
 Overall, we detected iTracer readouts in 22,489 cells (51%) in cerebral organoids using scRNA-seq (Fig. 2a and Extended Data
from this dataset (Extended Data Fig. 3a). Between organoids, we Fig. 5a). Spots were assigned to the telencephalon, diencephalon–
detected a variable number of reporter-expressing cells, barcodes mesencephalon and rhombencephalon as well as non-neuronal
and scars (Extended Data Fig. 3b and Supplementary Table 1). identities, and both deconvolution methods showed agreement
We noted that, while the entire starting population of iTracer in region identity assignment (Fig. 2b–d and Extended Data
iPSCs contained the reporter, transgene silencing and sparsity of Fig. 5b–l), suggesting that annotations were robust to computascRNA-seq data are likely contributors to loss of reporter detec- tional approaches. Spots with the same annotation clustered within
tion33,34. Nonetheless, of those cells in which the reporter transcript the same slice and persisted throughout the depth of the organoid,
was detected by scRNA-seq, we identified at least one unique molec- revealing transcriptome regionality. Spots showed varying levels of
ular identifier (UMI) covering the barcode region in 73% of cells neural progenitor cell (NPC) or neuron signatures, revealing areas
(Fig. 1e and Extended Data Fig. 3c,d). Importantly, we found no in the tissue slice enriched for progenitors and differentiated cells,
significant associations of cell type or regional identity with lack of respectively (Extended Data Fig. 5m). Regional and differentiaiTracer expression (Extended Data Fig. 3e). Due to the nature of the tion heterogeneity largely accounted for overall spot heterogeneity
Sleeping Beauty system, cells can have multiple iTracer insertions, (Extended Data Fig. 5n). In total, 41.7% of spots contained at least
allowing for unique barcode and scar compositions in individual one barcode, consistent with our iTracer data (Extended Data Fig. 5i
cells. In those cells in which at least one barcode was detected, we and Supplementary Table 1). Spots with the highest barcode detecfound an average of 2.10 barcodes per cell. Groups of cells that share tion colocalized with the highest expression of the iTracer RFP
the same barcode composition, termed barcode families, ranged in reporter (Extended Data Fig. 5h).
size from two to 801 and averaged approximately 11 family mem- We explored the spatial distribution of iTracer lineages and
bers. On average, 77.9% (batch 1) and 97.6% (batch 2) of barcode found that cells belonging to the same barcode family accumulated
families were unique to a given organoid within a batch, indicating in distinct regions in the organoid slice, whereas cells belonging
a limited overlap of highly diverse barcodes. CRISPR–Cas9 scars to different barcode families were spatially segregated (Fig. 2e,f

92 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods

NaTuRE METHODS Articles
a Bc. Scar Spatial
 b c
 Organoid scRNA-seq Telen. Dien.Ðmesen. Rhomben. Retina FOXG1 EMX1 OTX2 HOXB2
 t reference atlas
Day 0 15 60


 x z High
 Expr


 Likelihood
 S3 Max
 ML-based classifier Neural crest Microglia Epithelial Mesenchymal SOX10 AIF1 EPCAM DCN
 y S1 S2 S1
 Other
 signatures 0
 Low

 Spatial transcriptome Spot identity likelihood
 sequencing


d Spot annotation e f g h
 Clone location All Same Different Scar families (barcode 6)
 S1 S1 regions region regions
 P < 0.0001

 *** *** *** 2.5
 6


 Spatial distance (mm)


 Spot distance (mm)
 S2 S2
 5 2.0
 4 1.5
 3
 1.0
 2
 S3 Telen. S3 Barcodes 0.5
 1 1
 Dien.Ðmesen.
 1/3 0
 Rhomben. 0
 2
 Neural crest


 e

 .
 2/3


 iff
 m

 D
 Epithelial


 e
 e


 Sa
 e

 Ex ed
 Ex red
 Ex red
 3


 iv
 iv


 iv
 Scar-1 Scar-2 Scar-3


 us
 us


 ar
 us
 Mesenchymal Scar identity


 a
 a
 4


 Sh
 Sh
 Sh


 cl
 cl


 cl
 y Unassigned y Scar-4 Scar-5 Scar-6
 x x Barcode composition Unscarred Other scars


Fig. 2 | Spatial iTracer links lineage, molecular state and location information in cerebral organoids. a, Schematic of tissue section selection for
Spatial iTracer. ML, machine learning. b,c, Spot plots for section 1 (S1) colored by projection likelihood to organoid reference clusters (b) or by marker
gene expression (expr) (c). Dien.–mesen., diencephalon–mesencephalon. d,e, Spot plots for each section (S1–S3), colored by machine learning-based
deconvolution for cell type assignment (d), or four example iTracer barcodes highlighting restriction of lineages to specific regions in the organoid (e).
f, Box plots of pairwise spatial distance between spots found in the three sections, grouped by whether a shared barcode was identified by the spot
pair. Regions that are spatially close to each other share similar barcode composition, whereas spots that are distant in space have decreased barcode
similarity. This occurs when comparing any two spots, regardless of spot-annotated brain region (left), between any two spots in the same annotated
brain region (middle) and between any two spots that are assigned to different annotated brain regions (right). Two-sided Wilcoxon rank-sum tests were
performed comparing ‘shared’ with ‘same’ and ‘exclusive’ groups (nshared = 53,618 (left), 14,698 (middle) and 18,200 (right) spot pairs from three slices;
nexclusive = 197,444 (left), 42,178 (middle) and 74,366 (right) spot pairs); ***unadjusted P value < 0.0001. g, Spot plot for each section colored by scar
families within a single barcode. h, Box plots show the distributions of spatial distances between spots with the same scar or with different (diff.) scars.
P values represent significance values from two-sided Wilcoxon tests (nshared = 4,200, ndifferent = 24,268 spot pairs from three slices). Boxes in box plots
represent upper and lower quartiles. The center line represents the median. Whiskers show the minimum and maximum of the data if there is no outlier.
Outliers are defined as data points outside 1.5 times the interquartile range above the upper quartile and below the lower quartile.


and Extended Data Fig. 5o,p). The same spatial distribution was We directly tracked the lineage of a single nucleus throughout
observed on the level of scar families, in which spots containing the recording time using Mastodon37, a framework allowing for
the same barcode–scar combination were found closer together semi-automated tracking and curation of nuclei lineages in large
and were more likely to belong to the same brain regional identity 4D datasets (Fig. 3d,e). We visualized the spatial distribution
than those with the same barcode but different scars (Fig. 2g,h and of daughter cells derived from the originating nucleus, which
Extended Data Fig. 5q–s). These data suggest that, during brain we call lineage 1 (L1), and generated a lineage tree resulting
organoid development, related cells tend to accumulate in the same from 100 h of proliferation (Fig. 3f, Extended Data Fig. 6a and
area of the organoid, receive similar patterning signals and therefore Supplementary Video 3). The average duration of one cell cycle
on average become restricted to the same brain regional identity. was estimated to be 17.3 h (Extended Data Fig. 6b). We observed
Together, iTracer and Spatial iTracer revealed an enrichment of cell that L1 remained confined to the same area of the lumen throughclones in distinct brain regions of the cerebral organoid that can be out the recording time (Fig. 3d and Extended Data Fig. 6c).
traced back to clonality within the initializing EB. We tracked three additional nuclei, for which two nuclei were
 neighbors in the same lumen area as L1 (L2–L3) and the third
Lineage tracing with long-term light-sheet microscopy. To directly nucleus (L4) was positioned diametrically opposite in a distinct
measure lineage dynamics and spatial accumulation of clones in a future lumen area in the EB (Fig. 3g, Extended Data Fig. 6c,d
developing organoid during the neuroectoderm-to-neuroepithelium and Supplementary Video 4). We quantified spatial distances
stage, we established long-term live imaging of developing cerebral between each tree and inspected the distribution of all daughter
organoids using 4D light-sheet microscopy (Fig. 3a, Extended Data cells within the organoid 3D space (Fig. 3g–i). During the course
Fig. 6a and Supplementary Videos 1 and 2). Briefly, we generated of 65 h, the initializing nuclei gave rise to 13 descendant nuclei
organoids containing 5% iPSCs that had nuclei labeled with a uniform on average, which all populated the expanding organoid but
fluorescent reporter, FUS–mEGFP36 and imaged the sparsely labeled remained spatially restricted to the parent lumen, exhibiting limorganoids with an inverted light-sheet microscope (Fig. 3a). EBs ited migration away from their lineage members (Fig. 3g–i and
were embedded in Matrigel in the imaging chamber and cultured in Extended Data Fig. 6e,f). These results suggest that early spatial
neural-induction medium, and development was tracked for 65–100 h arrangement of clones followed by local amplification results in
(Fig. 3b and Supplementary Video 1). As the EB grew and developed, distinct lineage compositions of brain regions, which confirms
we observed the formation of several lumens, each of which could be our previous iTracer-based observation of organoid brain region
tracked in three dimensions (Fig. 3c). clonality (Fig. 3j).

Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 93

Articles NaTuRE METHODS

 a
 4D light-sheet
 No label FUS–GFP microscopy Image every 30 min for 100 h


 5%
 Sparsely labeled
 EBs Track nuclei Spatial lineage analysis


 b 0h 20 h 40 h 60 h 80 h 100 h


 Lumen Lumen
 c 88 h
 area


 x
 y
 z

 d 0h 40 h 100 h e f
 z
 Time (h)
 100


 0
 L1
 x
 L1

 L1 L1 L1
 y

 0 100
 Time (h)
 g 0 h < t < 65 h z i
 Same Same lumen, Different
 lineage different lineage lumen
 400
 Internuclear
 distance


 x
 200


 0
 Lineage 0 20 40 60 0 20 40 60 0 20 40 60
 y
 Time (h)
 1 2 3 4

 h j
 Lumenization and
 regionalization
 Density


 x y z Proliferation and
 neuroectoderm
 Position formation t


Fig. 3 | Long-term light-sheet microscopy of cerebral organoid development. a, Schematic showing the experimental setup. b, Cross-sectional (x–y) still
images from time points at 0–100 h. Labeled nuclei are colored in green. c, Three-dimensional projection and cross-sections of x–y, x–z and y–z planes at
88 h. The empty lumen cavity and lumen areas are annotated on the image. d, Selected images show the increment in nuclei tracks of L1 from three time
points over 100 h. Scale bar, 100 µm in all images (b–d). e, Three-dimensional plot showing spatial distribution of all nuclei in L1 over 100 h. f, Lineage
tree across time for L1. g, Three-dimensional scatterplot of spatial distribution of nuclei from four lineages (L1–L4) traced over 65 h. Big, medium and
small dots represent time points at 0 h and 65 h and times between 0 and 65 h, respectively. h, Density plot showing the distribution of all four lineages
in x–y–z planes. i, Scatterplot showing internuclear distance between any two nuclei in the same lineage (L1, L2, L3 and L4), different lineages in the same
lumen (L1–L3) and for nuclei in different lineages (L1–L3 and L4). Error bands show the first to 99th percentiles. j, Illustration shows proliferation and
regionalization of tracked lineages in the organoid over 100 h.


Lineage dynamics during cerebral organoid patterning. Next, single-cell transcriptomes to construct fate-mapped whole-organoid
we used iTracer to determine when cells restrict their fate dur- phylogenies (Fig. 4a,b and Extended Data Fig. 7a–i). We analyzed
ing brain organoid development. We used both channels of the cell type diversity in scar families in which organoids were treated
lineage recorder (barcodes introduced in the initializing EB and with doxycycline over a scarring time course. In an example of scarscars induced during a developmental time course) together with ring induction at the neuroepithelial stage (day 15), we found one

94 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods

NaTuRE METHODS Articles
a Bc. Scar scRNA-seq
 e f g
 Scarred clones Bc. Scar scRNA-seq Clusters
 t t
 Single Scar


 Mb.
 Mouse


 Hb.
 0 15 63 d


 NE
 0 7 15 d Fb.
 cells family organizers
 Org1 Hindbrain
 NE
 POU5F1 HOXB2 D


 Floor plate
 Midbrain
 BF1 Scar M
 Barcode R
 Scarred clone Unscarred clone OTX2 FOXG1
 Forebrain


 Roof plate Bound
 b Cell type Scar family NE T
 M
 Forebrain
 Hypo- R
 RG
 thalamic FGF17 WNT3A T


 UMAP 2
 RG M/R
 Dorsal telencephalon
 Dien.–mesen. Antihem
 Forebrain


 t-SNE 2
 Rhombencephalon
 t-SNE 2


 UMAP 1
 Neural crest derivatives Samples Similarity (PCC)
 WNT8B BMP7
 Epithelial Mesenchyme
 t-SNE 1 t-SNE 1 –0.10 0.34


c Barcode family d Shared scars between Different scars between h Day 15 BF1 i P = 0.532
 Org1-s15-d60-bc1 different cell types different cell types organoid 14
 Scar Forebrain
 0.15 12 Hindbrain
 Excess of frequency


 Number of cells
 8 P = 0.555
 Cell type 0 BF1 Barcode
 Scarring time 4
 Days 4–7
 Day 15 Cell
 Unscarred −0.15 Days 20–30 0
 Scarred clone Unscarred clone Scar families


 d
 Scar


 rre
 −4 −2 0 2 4
 NE Hindbrain Midbrain


 ca
 family
 z score (scar similarity distance


 ns
 Forebrain


 U
 between clusters)


Fig. 4 | iTracer temporal lineage recording illuminates a window of fate restriction in cerebral organoids associated with brain patterning. a, Lineage plot
shows full lineage reconstructions from a single organoid scarred at day 15 and sequenced at day 63 (left) as well as the subset of cells in which scars were
detected (right). First- and second-order deviation nodes represent barcode and scar families, respectively, with terminal branches indicating individual
cells. Each cell is colored based on the cell type designation. b, t-distributed stochastic neighbor embeddings (t-SNE) show cells for this organoid colored
by both cell type annotation and scar families (≥5 members). c, Force-directed graph embedding of cells from a single barcode family within organoid 1
(Org1), with cells colored by scar family or cell type (inset). Scar families in orange show enrichment in cortical brain regions. d, Frequency distribution of
z scores of scarring pattern distances between cell clusters after subtraction of background distribution estimated by random sampling of scars. Different
scarring times are shown separately. Dashed shadow backgrounds show 90% confidence intervals, accordingly colored by scarring time. This plot
highlights that scarring at later time points separates lineages with different cell fates. e, UMAP embedding of developing cerebral organoids scarred at
day 7 and sequenced at day 15, with cells colored by cell types and estimated brain regional identity or samples (inset). RG, radial glia; NE, neuroepithelial.
f, Expression of regional marker genes and selected morphogen genes. g, Heatmap of relative similarity of organoid clusters to organizing centers
identified in developing mouse brains. T, telencephalon; D, diencephalon; M, mesencephalon; R, rhombencephalon; Hb., hindbrain; Mb., midbrain; Fb.,
forebrain; PCC, Pearson’s correlation coefficient. h, Lineage plot shows full lineage reconstructions from one day 15 organoid (sample 1). The zoomed-in
view highlights a barcode family with diverse patterning states. i, Bar plot showing region composition of scar families, revealing that cells are not yet
restricted at the time point of scarring at day 7. P values show results of two-sided Fisher’s exact tests to compare regional proportions in different scar
families, with or without consideration of unscarred cells.


scar family restricted to a cortical fate, while other scar families were among different scar families (Fig. 4i). Our results imply that brain
found distributed across different cell types (Fig. 4c). We globally regional heterogeneity starts to emerge after the neuroectoderm
analyzed scar families and found that fate restriction increased over stage and before the neuroepithelium stage. Altogether, these data
the scarring time course, starting at day 15 (Fig. 4d). This analy- provide molecular profiles of nascently regionalized human neurosis revealed a coarse patterning window for brain regionalization; epithelium and lineage information at the onset of brain patterning
however, sparse sampling of cells in whole organoids limits the in human cerebral organoids.
depth of these analyses.
 Guided by the observation of a patterning window, we inves- Variability of lineage dynamics in individual organoid
tigated gene expression heterogeneity at the neuroepithelial stage regions. Next, we wished to use iTracer to assess variability in
(day 15) using iTracer organoids scarred at the neuroectoderm progenitor-to-neuron lineages in distinct brain organoid regions at
stage (day 7) (Fig. 4e and Extended Data Fig. 8a,b). To interpret high resolution. To achieve deep lineage sampling, we performed
expression patterns at this early time point, organoid cells were lineage-coupled single-cell transcriptomics on two microdissected
projected to an atlas of radial glia in the primary prenatal mouse peripheral regions of a 200-µm iTracer organoid section (2 months,
brain38 (Extended Data Fig. 8c–h) based on a k-nearest-neighbor scarred at day 15) (Fig. 5a and Supplementary Tables 1 and 3).
classifier trained on the mouse atlas CSS representation31 (Extended Analysis of single-cell transcriptomes revealed region 1 (R1) as the
Data Fig. 8i). The projection revealed regionality in the neuroepi- diencephalon–mesencephalon and R2 as the rhombencephalon
thelium at day 15 and strong correspondence between human and (Fig. 5b,c and Extended Data Fig. 9a–c). We reconstructed barcode
mouse patterning profiles (Fig. 4f,g). Consistent with our previous and scar families and found that lineages in R1 and R2 were entirely
observation of regional clonality, barcode families showed distinct diverged (Fig. 5d,e). We grouped transcriptionally distinct clusters
brain region compositions (Fig. 4h). However, in the largest bar- based on barcode families (Extended Data Fig. 9d) and applied
code family containing the highest regional diversity (BF1), we hierarchical clustering within these cluster groups (CGs) based
found no significant difference in regional identity composition on their scar family composition. This analysis revealed that CGs

Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 95

Articles NaTuRE METHODS

contain distinct scar family compositions and transcriptomic sig- underlie certain focal cortical dysplasias in humans25–27. We crenatures (CG2-1, CG2-2, CG3-1–CG3-3; Extended Data Fig. 9e–j), ated four targeting guide vectors, each containing a gRNA targetindicating cell fate restriction before neuroepithelium formation ing a different exon in the TSC2 gene (Extended Data Fig. 10a,b).
at day 15. Notably, trajectory inference and RNA velocity analysis We generated mosaic cerebral organoids composed of 10%
were not able to resolve distinct lineage relationships that could be iTracer-perturb control cells (BFP+GFP+), 10% iTracer-perturb
distinguished using iTracer (for example, cluster 6, BF3; Fig. 5b and TSC2-targeting cells (RFP+GFP+) and 80% wild-type cells
Extended Data Fig. 9g) (Extended Data Fig. 10c). We induced Cas9 expression during
 To compare neurogenic lineages within the same brain region, the EB stage (day 5), thereby creating TSC2 perturbations and
we ordered cells of all hindbrain scar families (R2) along a differ- GFP scars simultaneously. At 1 month, we dissociated the mosaic
entiation pseudotime using the transcriptome portion of the data organoids and used flow cytometry to sort reporter-positive cells,
(Fig. 5f,g). We found that sister lineages, for example, scar families followed by scRNA-seq (Fig. 6a and Extended Data Fig. 10d–g).
belonging to the same barcode family and hence derived from the Focusing on scarred cell populations (Fig. 6b,c and Extended
same barcoded cell in the EB, showed similar NPC-to-neuron distri- Data Fig. 10h,i), we performed differential expression analysis
butions along pseudotime, indicating synchrony in differentiation between cells with targeting (RFP+) and nontargeting (BFP+) vecdynamics (Fig. 5h). By contrast, non-sister lineages showed larger tors and between nontargeting cell clones as background (Fig. 6d
variability in the distribution of cells along pseudotime and hence and Extended Data Fig. 10j–l). We identified 197 differentially
less synchronized differentiation of NPCs to neurons. We next com- expressed genes (DEGs) that were unique to TSC2-targeting
pared neurogenic lineages on a transcriptional level and identified cells. Functional enrichment analysis of these genes using the
a limited set of genes differentially expressed between different lin- database for annotation, visualization and integrated discovery
eages (Fig. 5i). However, sister lineages did not show greater tran- (DAVID) revealed oxidative phosphorylation, the mitochondrial
scriptional similarity than non-sister lineages (two-sided Wilcoxon’s inner membrane and the respiratory chain as enriched categories
rank-sum test, P = 0.25). (Fig. 6e, Extended Data Fig. 10m,n and Supplementary Table 8),
 consistent with previous reports of TSC2 ablation affecting mito-
Tracing perturbed lineages with iTracer-perturb. The ability to chondria via mTOR activation39. We combined lineage informarecord lineages and measure molecular states simultaneously in high tion with pseudotemporal ordering to compare the distribution of
throughput is particularly interesting when studying the effect of cells over pseudotime in different lineages (Fig. 6f,g). Importantly,
disease-associated genetic mutations on development. We therefore TSC2-targeted lineages (RFP+) were enriched for early neuroepiextended the iTracer system to enable simultaneous targeted gene thelial cells (NECs) relative to control cells (BFP+) (odds ratio = 1.5;
perturbation, lineage recording and molecular state phenotyping in Fisher’s exact test, P = 0.03), suggesting a role of TSC2 during
mosaic organoids. We introduced a second gRNA under the control early differentiation into NPCs. This is consistent with previous
of a bovine U6 promoter into the iTracer vector, which can target reports of delayed neuronal differentiation in patient-derived
any gene of interest. In addition, we incorporated a second fluores- TSC2-heterozygous NPCs40. Together, incorporating gene perturcent reporter linked through a 2A self-cleaving peptide sequence bation into the iTracer lineage-recording system provides a flexible
to the barcoded GFP, which is not targeted by a scarring guide and method to explore mosaic loss-of-function mutations in human
therefore enables selection of lineage-recorded cells. iTracer-perturb organoids to understand mechanisms of developmental disorders.
targeting vectors contain gRNA species targeting the gene of interest (bU6) and GFP (hU6) as well as RFP and barcoded GFP report- Discussion
ers linked through the 2A peptide. iTracer-perturb nontargeting Here we established three new approaches to trace lineages in
vectors contain a control dummy gRNA (bU6) and a gRNA target- human iPSC-derived organoids. First, we present iTracer, a dynamic
ing GFP (hU6) as well as BFP and barcoded GFP reporters linked dual-channel cell lineage recorder for human iPSC-derived organthrough the 2A peptide (Fig. 6a). We designed an experiment in oids designed to trace clones from an initializing iPSC pool as well
which cells within the same mosaic organoid would either be wild as to dynamically trace lineages using inducible scarring. Second,
type or would carry targeting or nontargeting recording vectors. we present Spatial iTracer, which links molecular state, lineage and
GFP scarring and target gene knockout could then be induced location information in organoids. Third, we accomplished direct
simultaneously at a time point of choice by doxycycline-mediated lineage tracking using long-term light-sheet microscopy with mosaic
induction of Cas9 expression in the developing organoid. fluorescent organoids. Importantly, all of these lineage-recording
 We targeted the gene TSC2, which encodes a negative regula- approaches, along with computational and data-visualization methtor of mTOR; somatic mutations in this gene have been shown to ods that we developed, can be applied to any human iPSC-derived


Fig. 5 | iTracer identifies distinct neurogenic lineage families in individual cerebral organoid regions. a, Schematic of tissue section selection for deep
sampling. One 200-µm section was cut before selecting two spatially distant regions for microdissection. Single cells were isolated from microdissected
regions and processed for scRNA-seq separately. b, UMAP embedding of scRNA-seq data from 26,894 cells from two microdissected regions in a single
cerebral organoid scarred at day 15 and sequenced at day 60; cells are colored by cluster or originating region and annotated with brain regional or cell
type identity. c, Expression heatmap showing brain region and cell type markers across clusters and regions shown in b. d, Lineage plot shows lineage
reconstruction combining both microdissected regions from the single organoid. First- and second-order deviation nodes represent barcode and scar
families (SF), respectively, with terminal branches indicating individual cells. The originating region is annotated in the outer circle, with example barcode
and scar families annotated. e, UMAP embedding of single cells from the two microdissected regions colored by example barcode families indicated in
d. f, Pseudotime (Pt) analysis was applied to cells from dissected region R2 (left) and colored by the nine scar families with at least 50 cells (right).
g, Pseudotime distribution of cells in different scar families. SOX2 (red) and DCX (green) expression patterns along the reconstructed pseudotime are
shown (top). The dendrogram shows lineage reconstruction from barcode and scar families. Cells in each scar family are ordered by pseudotimes.
h, Hierarchical clustering of scar families based on their pairwise distances (dist) on the pseudotime distribution. The box plot shows the distribution of
distances between scar families from the same barcode family (left) or different barcode families (right). The P value indicates the significance score from
two-sided Wilcoxon’s rank-sum test (n1 = 29, n2 = 81 scar families). Boxes in box plots represent upper and lower quartiles. The center line represents the
median. Whiskers show the minimum and maximum of the data if there is no outlier. Outliers are defined as data points outside 1.5 times the interquartile
range above the upper quartile and below the lower quartile. i, Examples of genes with differential expression among NPCs from different scar families.

96 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods

NaTuRE METHODS Articles
cell differentiation or organoid system. We use these approaches to that brain regionalization initiates early in development, and, as
provide an extensive examination of lineage dynamics in developing NECs do not migrate very far from where they are born, cells related
cerebral organoids. We observed accumulation of cell lineages in to each other by lineage tend to contribute to the same part of the
distinct molecularly and spatially defined regions, which we could brain. Importantly, our findings corroborate results from the analytrace back to spatial restriction of lineages in the neuroepithelium sis of somatic mutation landscapes in different regions of the adult
before patterning. This brain regional clonality is consistent with human brain, which also revealed clonal relationships linked to
fate maps in Drosophila41, zebrafish42–44 and mice45, which revealed brain regions46. Cerebral organoids therefore represent a powerful


 a b R1
 Bc. Scar scRNA-seq 6
 t Rhomben. R2
 0 15 60 NPC
 5
 7 17
 15 Rhomben.
 12 neuron
 x 13 16 1
 Dien.Ð 8
 z 9
 mesen. 14 RNA
 y 4 velocity
 NPC 10
 200-µm 11
 section 18
 R1 Mesenchyme 3
 2
 scRNA-seq
 UMAP 2


 0
 Dien.Ðmesen.
 R2 neuron
 UMAP 1

 c d Scarred
 BF2 BF1
 Regions Unscarred
 BF3
 14 6 3 2 11 0 1316 7 5 151217 9 10 1 8 4 18 Clusters
 Regions
 GNG5
 VIM
 NES SF6-1
 DCX
 MAP2
 STMN2 BF4
 RSPO3
 OTX2
 LHX9
 NR2F1
 NR2F2
 PCDH9
 TFAP2A
 TFAP2B
 HOXB5
 HOXB2
 HOXA2
 HOXA3 Expr
 SF6-2
 DCN High
 DDIT4
 BF5 BF6
 MKI67 Low

 e g P = 0.07
 Barcode families h
 Dist (Pt)


 NPC Neuron Distance (Pt)
 2.0 DCX
 Expression


 Scar
 family
 D e


 1.0
 .
 m
 iff


 SOX2
 Sa


 5
 0 i DBI HOPX BNIP3

 BF4

 2
 4
 SF6-1
 BF6
 UMAP 2


 SF6-2
 3 1
 UMAP 1

 f
 BF5

 Pt
 1 Pt

 0 Scar family 0 5 0 50 4
 Expression at NPCs


Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 97

Articles NaTuRE METHODS

 a b
 scRNA-seq BFP+
 hU6 bU6 RPBSA Barcode G2M
 RFP+
 gRNA gRNA BFP 2A GFP Telen. 3
 GFP+
 RG
 Nontargeting
 TSC2 Barcode 5
 hU6 bU6 RPBSA


 UMAP 2
 gRNA gRNA RFP 2A GFP

 TCS2 targeting UMAP 1

 4 1
 AAA 31 d
 gRNA 0
 Inducible iTracer 6
 EB (5 d) Early 2
 Cas9 iPSCs iPSCs
 Dox-induced NE Telen.
 scarring RG

 d 20 e c
 DAVID enrichment SLC31A1 Expr
 19 Oxidative phosphorylation Max
 −log10 (P (RFP+/BFP+))


 15
 20 Mitochondrial inner membrane
 12 Respiratory chain
 10 Unique to 15 Parkinson's disease SOX2
 RFP+/BFP+ Alzheimer's disease 0
 15
 Shared with
 10 NADH dehydrogenase activity
 5 BFP+ clonal DE
 Expr (RFP+) Expr (RFP+) 15 Huntington's disease
 DCX MKI67
 26 Metabolic pathways
 0
 15 10 5 0
 −0.8 −0.4 0 0.4
 Ðlog10 (P)
 log (FC (RFP+/BFP+))

 f g All SFs with ≥ 20 cells
 Pt SF B1-1
 1 30 SF B1-2 BF1
 SF B1-3 BFP+
 25
 0 SF B2-1 BF2
 Number of cells


 20
 SF B3-1 BF3 RFP+
 15

 10

 5

 0
 Pt


Fig. 6 | iTracer-perturb allows for simultaneous genetic perturbation and lineage tracing in mosaic organoids. a, Schematic for TSC2-targeting or
control iTracer-perturb vectors. This system was applied to TSC2 in mosaic cerebral organoids. b, UMAP embedding of scRNA-seq data from 1,673 RFP+,
4,766 BFP+ and 7,992 GFP+ cells sorted from one mosaic iTracer-perturb organoid at 1 month. Cells are colored by cell clusters (bottom) or fluorescent
signals (top). c, Feature plot shows marker gene expression. d, Volcano plot shows overall differential expression analysis between RFP+ (TSC2-targeting)
and BFP+ (control) cells, resulting in 385 DEGs (red), 197 of which are unique to the RFP+ versus BFP+ comparison (dark red). FC, fold change; DE,
differentially expressed. e, DAVID functional enrichment analysis of DEGs with significantly increased expression that was uniquely observed in RFP+
cells. Bars show −log10 (P) values from tests, and numbers show the number of DEGs annotated with each term. f, UMAP with cells colored by their
scar families (≥20 members) and fluorescent signals or by pseudotime (inset). g, Distribution of cells from different scar families (≥20 members)
across the constructed pseudotime course.


system to systematically study the relationship between regionaliza- give unreliable state flows, and methods that directly measure lintion and clonal dynamics during human brain development. eage are important to confirm trajectory inferences.
 Transgene silencing, single-cell dropout and limited cell sam- The iTracer-perturb system enables inducible or temporally conpling are hurdles in collecting complete lineage information using trolled gene perturbations while also recording lineage. As a proof
the iTracer system. Nonetheless, we were able to successfully of principle, we targeted TSC2 immediately before neuroectoderm
reconstruct sparse lineages in whole organoids at various stages of formation, as mutations in this gene have been shown to underlie
development and observe a coarse timing for cell fate restriction. certain focal cortical dysplasias in humans25–27. Our results indi-
Microdissection enabled deeper lineage sampling, identifying dif- cated that clones carrying the TSC2 gRNA have differential gene
ferent differentiation states that were derived from the same lineage expression profiles associated with metabolic changes as compared
for many different lineages. This strategy can be used to search for to control counterparts, which is consistent with the role of TSC2 as
differences in gene expression between lineage families as well as negative regulator of mTOR, a master regulator of cellular metabodifferences in the timing of differentiation events. We have observed lism. More generally, iTracer-perturb provides a strategy to simulthat indirect trajectory reconstructions from transcriptomes can taneously perturb, trace and measure states in any mosaic organoid

98 Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods

NaTuRE METHODS Articles
system. In the future, iTracer and iTracer-perturb, together with 24. Fleck, J. S. et al. Resolving organoid brain region identities by mapping
long-term 4D light-sheet imaging, will be powerful methodologi- single-cell genomic data to reference atlases. Cell Stem Cell 28,
 1148–1159 (2021).
cal approaches to understand the effect of mutations that underlie 25. Au, K. S. et al. Genotype/phenotype correlation in 325 individuals referred
developmental disorders in human organoid systems. for a diagnosis of tuberous sclerosis complex in the United States. Genet.
 Med. 9, 88–100 (2007).
Online content 26. Lim, J. S. et al. Brain somatic mutations in MTOR cause focal cortical
 dysplasia type II leading to intractable epilepsy. Nat. Med. 21, 395–400 (2015).
Any methods, additional references, Nature Research report-
 27. Sancak, O. et al. Mutational analysis of the TSC1 and TSC2 genes in a
ing summaries, source data, extended data, supplementary infor- diagnostic setting: genotype–phenotype correlations and comparison of
mation, acknowledgements, peer review information; details of diagnostic DNA techniques in tuberous sclerosis complex. Eur. J. Hum. Genet.
author contributions and competing interests; and statements of 13, 731–741 (2005).
data and code availability are available at https://doi.org/10.1038/ 28. Kowarz, E., Loscher, D. & Marschalek, R. Optimized Sleeping Beauty
 transposons rapidly generate stable transgenic cell lines. Biotechnol. J. 10,
s41592-021-01344-8. 647–653 (2015).
 29. Riesenberg, S. & Maricic, T. Targeting repair pathways with small molecules
Received: 10 June 2021; Accepted: 4 November 2021; increases precise genome editing in pluripotent stem cells. Nat. Commun. 9,
Published online: 30 December 2021 2164 (2018).
 30. Gonzalez, F. et al. An iCRISPR platform for rapid, multiplexable, and
References inducible genome editing in human pluripotent stem cells. Cell Stem Cell 15,
1. Kim, J., Koo, B. K. & Knoblich, J. A. Human organoids: model systems for 215–226 (2014).
 human biology and medicine. Nat. Rev. Mol. Cell Biol. 21, 571–584 (2020). 31. He, Z., Brazovskaja, A., Ebert, S., Camp, J. G. & Treutlein, B. CSS: cluster
2. Bhaduri, A. et al. Cell stress in cortical organoids impairs molecular subtype similarity spectrum integration of single-cell genomics data. Genome Biol. 21,
 specification. Nature 578, 142–148 (2020). 224 (2020).
3. Birey, F. et al. Assembly of functionally integrated human forebrain spheroids. 32. Velasco, S. et al. Individual brain organoids reproducibly form cell diversity of
 Nature 545, 54–59 (2017). the human cerebral cortex. Nature 570, 523–527 (2019).
4. Camp, J. G. et al. Human cerebral organoids recapitulate gene expression 33. Garrison, B. S., Yant, S. R., Mikkelsen, J. G. & Kay, M. A. Postintegrative gene
 programs of fetal neocortex development. Proc. Natl Acad. Sci. USA 112, silencing within the Sleeping Beauty transposition system. Mol. Cell. Biol. 27,
 15672–15677 (2015). 8824–8833 (2007).
5. Kanton, S. et al. Organoid single-cell genomic atlas uncovers human-specific 34. Kharchenko, P. V., Silberstein, L. & Scadden, D. T. Bayesian approach to
 features of brain development. Nature 574, 418–422 (2019). single-cell differential expression analysis. Nat. Methods 11, 740–742 (2014).
6. Pollen, A. A. et al. Establishing cerebral organoids as models of 35. Newman, A. M. et al. Determining cell type abundance and expression from
 human-specific brain evolution. Cell 176, 743–756 (2019). bulk tissues with digital cytometry. Nat. Biotechnol. 37, 773–782 (2019).
7. Quadrato, G. et al. Cell diversity and network dynamics in photosensitive 36. Roberts, B. et al. Systematic gene tagging using CRISPR/Cas9 in human stem
 human brain organoids. Nature 545, 48–53 (2017). cells to illuminate cell organization. Mol. Biol. Cell 28, 2854–2874 (2017).
8. Camp, J. G., Wollny, D. & Treutlein, B. Single-cell genomics to guide human 37. Schindelin, J. et al. Fiji: an open-source platform for biological-image analysis.
 stem cell and tissue engineering. Nat. Methods 15, 661–667 (2018). Nat. Methods 9, 676–682 (2012).
9. Haghverdi, L., Buttner, M., Wolf, F. A., Buettner, F. & Theis, F. J. Diffusion 38. La Manno, G. et al. Molecular architecture of the developing mouse brain.
 pseudotime robustly reconstructs lineage branching. Nat. Methods 13, Nature 596, 92–96 (2021).
 845–848 (2016). 39. Koyanagi, M. et al. Ablation of TSC2 enhances insulin secretion by increasing
10. Trapnell, C. et al. The dynamics and regulators of cell fate decisions are the number of mitochondria through activation of mTORC1. PLoS ONE 6,
 revealed by pseudotemporal ordering of single cells. Nat. Biotechnol. 32, e23238 (2011).
 381–386 (2014). 40. Zucco, A. J. et al. Neural progenitors derived from tuberous sclerosis complex
11. La Manno, G. et al. RNA velocity of single cells. Nature 560, patients exhibit attenuated PI3K/AKT signaling and delayed neuronal
 494–498 (2018). differentiation. Mol. Cell. Neurosci. 92, 149–163 (2018).
12. Weinreb, C., Rodriguez-Fraticelli, A., Camargo, F. D. & Klein, A. M. Lineage 41. Chow, K. K. et al. Imaging cell lineage with a synthetic digital recording
 tracing on transcriptional landscapes links state to fate during differentiation. system. Science 372, eabb3099 (2021).
 Science 367, eaaw3381 (2020). 42. Cavodeassi, F. & Houart, C. Brain regionalization: of signaling centers and
13. McKenna, A. et al. Whole-organism lineage tracing by combinatorial and boundaries. Dev. Neurobiol. 72, 218–233 (2012).
 cumulative genome editing. Science 353, aaf7907 (2016). 43. Warga, R. M., Kane, D. A. & Ho, R. K. Fate mapping embryonic blood in
14. Spanjaard, B. et al. Simultaneous lineage tracing and cell-type identification zebrafish: multi- and unipotential lineages are segregated at gastrulation. Dev.
 using CRISPR–Cas9-induced genetic scars. Nat. Biotechnol. 36, 469–473 (2018). Cell 16, 744–755 (2009).
15. Chan, M. M. et al. Molecular recording of mammalian embryogenesis. Nature 44. Woo, K. & Fraser, S. E. Order and coherence in the fate map of the zebrafish
 570, 77–82 (2019). nervous system. Development 121, 2595–2609 (1995).
16. Biddy, B. A. et al. Single-cell mapping of lineage and identity in direct 45. Inoue, T., Nakamura, S. & Osumi, N. Fate mapping of the mouse
 reprogramming. Nature 564, 219–224 (2018). prosencephalic neural plate. Dev. Biol. 219, 373–383 (2000).
17. Quinn, J. J. et al. Single-cell lineages reveal the rates, routes, 46. Lodato, M. A. et al. Somatic mutation in single human neurons tracks
 and drivers of metastasis in cancer xenografts. Science 371, developmental and transcriptional history. Science 350, 94–98 (2015).
 eabc1944 (2021).
18. Huisken, J., Swoger, J., Del Bene, F., Wittbrodt, J. & Stelzer, E. H. Optical Publisher’s note Springer Nature remains neutral with regard to jurisdictional claims in
 sectioning deep inside live embryos by selective plane illumination published maps and institutional affiliations.
 microscopy. Science 305, 1007–1009 (2004). Open Access This article is licensed under a Creative Commons
19. Jain, A. et al. Regionalized tissue fluidization is required for epithelial gap Attribution 4.0 International License, which permits use, sharing, adap-
 closure during insect gastrulation. Nat. Commun. 11, 5604 (2020). tation, distribution and reproduction in any medium or format, as long
20. Icha, J., Weber, M., Waters, J. C. & Norden, C. Phototoxicity in live as you give appropriate credit to the original author(s) and the source, provide a link to
 fluorescence microscopy, and how to avoid it. Bioessays 39, 1700003 (2017). the Creative Commons license, and indicate if changes were made. The images or other
21. Laissue, P. P., Alghamdi, R. A., Tomancak, P., Reynaud, E. G. & Shroff, H. third party material in this article are included in the article’s Creative Commons license,
 Assessing phototoxicity in live fluorescence imaging. Nat. Methods 14, unless indicated otherwise in a credit line to the material. If material is not included in
 657–661 (2017). the article’s Creative Commons license and your intended use is not permitted by statu-
22. Lancaster, M. A. et al. Cerebral organoids model human brain development tory regulation or exceeds the permitted use, you will need to obtain permission directly
 and microcephaly. Nature 501, 373–379 (2013). from the copyright holder. To view a copy of this license, visit http://creativecommons.
23. Renner, M. et al. Self-organized developmental patterning and differentiation org/licenses/by/4.0/.
 in cerebral organoids. EMBO J. 36, 1316–1329 (2017). © The Author(s) 2021


Nature Methods | VOL 19 | January 2022 | 90–99 | www.nature.com/naturemethods 99

Articles NaTuRE METHODS

Methods Assessment of scarring efficiency. To test scarring efficiency upon doxycycline
Ethics statement. Permission for this work with human iPSC lines was obtained induction, iCRISPR cells were cultivated using standard feeder-free conditions in
through the Sachsisches Staatsministerium fur Umwelt und Landwirtschaft (Az. mTeSR1 (Stemcell Technologies) on Matrigel-coated plates. Cells were nucleofected
55-8811.72/26, Az. 55-8811.72/26/382, Az. 55-8811.72/26/393 and 54-8452/26/7), with 10 μg lineage-recorder DNA and 1 µg Sleeping Beauty transposase following
the Swiss Federal Office for the Environment (A120821-08, A192559-01), the the manufacturer’s protocol and using the B-16 program of the Nucleofector 2b
Ethics Committee of Northwest and Central Switzerland (2019-01016) and the (Lonza) in cuvettes for 100 µl Human Stem Cell nucleofection buffer (Lonza,
Swiss Federal Office of Public Health. VVPH-5022). Nucleofection reactions were plated on Matrigel-coated plates
 and allowed to expand for 5–7 d before flow cytometry. To select for cells with
iCRISPR cell line. We used the iCRISPR iPSC cell line with doxycycline-inducible successful integration of the cell lineage reporter, RFP+ or GFP+ cells were sorted
Cas9, created previously as described29. Briefly, the human iPSC line h409b2 into 1.5-ml tubes (~120,000 cells in total) and plated in 12-cell Matrigel-coated
from the RIKEN BRC cell bank4 was used to create a doxycycline-inducible plates with mTeSR1 and Rock inhibitor (1:250). Following cell recovery, we used
Cas9-expressing cell line30 by introducing two transcription activator-like effector 2 µg doxycycline30 for 0, 1, or 2 d before changing back to mTeSR1 base medium.
nucleases targeting the AAVS1 locus, which has shown to be effective for sustained Optimization of the incubation of 3D cultures with doxycycline was performed
transgene expression, and two constructs encoding transcription activator-like at EB and neuroectoderm stages at concentrations of 0.5, 1, 2, 4 and 8 µg ml−1
effector nucleases with donor plasmids. One of the donor plasmids contained a doxycycline for 24-h incubations before changing back to mTeSR1 and NIM
constitutive reverse tetracycline transactivator (AAVS1-Neo-M2rtTA), and the base media, respectively. iPSCs were collected using Accutase (Sigma-Aldrich)
other one contained a doxycycline-inducible expression cassette (Puro-Cas9). for 5–7 min before quenching with KnockOut Media (Thermo Fisher Scientific)
A mutation corresponding to D10A was introduced by site-directed mutagenesis of and centrifuging at 200g for 5 min. In total, 100,000 iPSCs were taken for DNA
the original Puro-Cas9 donor with the Q5 mutagenesis kit (New England Biolabs, extraction using QuickExtract (Lucigen), whereas organoid samples were directly
E0554S) to generate Cas9n. The cell line was tested for the proper expression added to QuickExtract (Lucigen) and vortexed. All samples were vortexed shortly
of pluripotency markers SOX2, OCT-4, TRA1-60 and SSEA. Quantitative PCR before heating to 65 °C for 6 min before vortexing again and heating to 98 °C for
confirmed the doxycycline-inducible Cas9n, and digital PCR was used to exclude 2 min. We used 50 ng input DNA for scar region amplification (primer sequences
off-target integration29. DNA from iCRISPR cells was sent to the Cell Guidance are provided in Supplementary Table 5). Quality of the amplified product was
Systems Genetics Service Cytogenetics Laboratory and tested for copy number checked with a 2% E-Gel (Thermo Fisher Scientific) before Illumina sequencing
changes using the Agilent ISCA 8x60K version 2 array. Array analysis revealed adaptors were added in a subsequent PCR reaction. Bulk scar libraries were
three apparently clonal changes in DNA copy number. Gain of the entire long arm cleaned with magnetic beads (Beckman Coulter) before checking quality with a 2%
of chromosome 1 was detected and estimated to be present in about 70% of cells. E-Gel. Libraries were sequenced on the Illumina MiSeq Nano. Scar detection was
A DNA copy number loss of approximately 3.7 Mb from the proximal short arm performed using CRISPResso48.
of chromosome 19, band p12, was detected and present in about 30% of cells.
A commonly found mutational gain of approximately 1 Mb was detected within the Preparation of organoids and scarring. iTracer+ iCRISPR cells were prepared
proximal long arm of chromosome 20, band q11.21. Finally, applying inferCNV as previously described above. Following cell recovery after flow cytometry,
(https://github.com/broadinstitute/inferCNV) to the scRNA-seq data of iCRISPR 2,000 cells per well in a 96-well plate were seeded and differentiated into cerebral
suggested the gain of a large portion of chromosome 12 in a subset of cells. organoids using a whole-organoid differentiation protocol5,22. Throughout
iCRISPR cells were regularly tested for mycoplasma using PCR validation (Venor development, organoids were scarred by activation of inducible Cas9 (Fig. 1b and
GeM Classic, Minerva Biolabs) and found to be negative. Supplementary Table 1). Scarring was achieved by first selecting the organoid to be
 scarred and transferring it to a six- to 24-well plate (depending on organoid size)
Establishment of dynamic cell lineage-reporter vector. iTracer plasmids filled with scarring medium with 8 µg ml−1 doxycycline (base medium depending
were constructed by modifying Sleeping Beauty reporter plasmids pSBbi-GH on the age of the organoid, Supplementary Table 1). Organoids were incubated in
and pSBbi-RH28. pSBbi plasmids were a gift from E. Kowarz (Institute of scarring medium for 24 h before returning to base medium without doxycycline.
Pharmaceutical Biology, Goethe University, Frankfurt am Main, Germany)
(Addgene plasmids 60514 and 60516; http://n2t.net/addgene:60514, http:// Bulk barcode detection. IPSCs and 19 organoids ranging in stage from EB
n2t.net/addgene:60516; RRID, Addgene_60514; RRID, Addgene_60516). to day 30 were used for bulk analysis to assess the capture and diversity of
Plasmid generation consisted of two steps: initially removing the hygromycin iTracer barcodes. We propagated and collected samples in a manner similar
cassette and inserting an 11-bp barcode tag in the 3′ untranslated region to that described above. Briefly, iCRISPR cells were cultivated using standard
of the fluorescent reporter gene; second, the gene-of-interest site including feeder-free conditions in mTeSR1 (Stemcell Technologies) on Matrigel-coated
its promoter region was replaced by the human U6 promoter driving the plates. Cells were nucleofected with 10 µg lineage-recorder DNA and 1 µg
expression of a gRNA that targets the fluorescence gene. In detail, a long-range Sleeping Beauty transposase following the manufacturer’s protocol and using
PCR was performed to amplify and extract the plasmid backbone excluding the H9 program of the 4D-Nucleofector (Lonza) in cuvettes for 100 µl Human
the hygromycin cassette from pSBbi plasmids following the manufacturer’s Stem Cell nucleofection buffer (Lonza, VVPH-5022). Nucleofection reactions
recommendations (1× Phusion HiFi Ready Mix, 50 ng pSBbi, 0.2 µM of each were plated on Matrigel-coated plates and allowed to expand for 5–7 d before
primer (primer sequences are provided in Supplementary Table 5), 3% DMSO, flow cytometry. To select for cells with successful integration of the cell lineage
50 µl in total, 25 cycles). To remove original plasmid from the backbone, the reporter, RFP+GFP+ cells were sorted into 1.5-ml tubes (~120,000 cells in
PCR reaction was digested with a combination of restriction enzymes directly total) and plated in 12-cell Matrigel-coated plates with mTeSR1, Rock inhibitor
added to the PCR reaction (37 µl H2O; 10 µl Thermo Fisher FastDigest (FD) (1:250) and Primocin (1:250). DNA isolation and bulk barcode libraries were
Buffer; 1 µl each FD enzyme DpnI, CpoI and Esp3I; 37 °C; 1 h). Reactions prepared as described for bulk scar libraries (primer sequences are provided in
were purified using the Qiagen PCR Purification kit. The purified backbone Supplementary Table 5). Libraries were sequenced on the Illumina MiSeq Nano.
was then used to perform Gibson assembly following the instructions in Analysis was performed using a custom Perl script to count the frequency of each
the CROP-seq manual47 to introduce barcodes by using an oligonucleotide uniquely detected barcode.
containing random nucleotides (Supplementary Table 5). Instructions from
the manual were only adapted such that bacteria were not plated after recovery Preparation of single-cell transcriptomes from whole lineage-traced organoids.
but were instead completely transferred to an overnight culture with 1× Whole organoids were dissociated to generate single-cell gene expression libraries.
ampicillin to maintain barcode heterogeneity. Plasmid DNA was isolated using In brief, organoids were transferred to HBSS (without Ca2+ or Mg2+, −/−) and
the Qiagen Miniprep kit. CROP-seq plasmids containing a gRNA targeting cut into two pieces to clear away debris from the center of the organoid (two to
either sequences for dTomato (GGTGTCCACGTAGTAGTAGC) or GFP three washes in total). Organoid pieces were then dissociated using the Neural
(TGTTCTGCTGGTAGTGGT) were generated following protocol instructions Dissociation kit (P) and papain-based dissociation (Miltenyi Biotec). Organoid
(oligonucleotide sequences are provided in Supplementary Table 5). These pieces were incubated in papain at 37 °C (enzyme mix 1) for an initial 15 min,
plasmids acted as templates to amplify and extract the human U6 promoter, followed by addition of enzyme A (enzyme mix 2) to the papain mix. Organoid
gRNA and the gRNA scaffold region using the PCR conditions described above. pieces were then triturated using wide-bore 1,000-ml tips and incubated for
Primers (Supplementary Table 5) compatible with subsequent cloning were additional intervals of 5–10 min with triturations between incubation steps,
used, and the purified PCR product was digested with Thermo Fisher FD BshTI amounting to a total papain incubation time of approximately 45 min. Cells were
and FD PaeI before ligation. The backbone for cloning was obtained by digesting filtered through a 30-μm strainer and washed, centrifuged for 5 min at 300g
plasmids containing barcodes with Thermo Fisher FD BshTI and FD PaeI. To and washed three times with HBSS (−/−). Cells were filtered through a 20-μm
guarantee that there was no ligation of the cut region back to the plasmid, the strainer and washed, centrifuged for 5 min at 300g and washed three times with
backbone digest was run on an agarose gel, and the backbone region was excised HBSS (−/−). The resulting cells were then assessed (count and viability) using
and purified. Backbone and insert were ligated using NEB QuickLigase, and the Trypan blue assay and counted using the automated cell counter Countess
Escherichia coli was subsequently electroporated with the ligation product by (Thermo Fisher). Finally, cells were diluted to an appropriate concentration
following instructions in the CROP-seq manual. Recovered cells were again to obtain approximately 5,000–7,000 cells per lane in a 10x microfluidic chip
directly transferred to an overnight culture, and plasmid DNA was extracted and device. Single-cell cDNA was synthesized according to the manufacturer’s
purified using Qiagen MediPrep. recommendations before continuing to library preparation with 25% of the total


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles
cDNA volume. Libraries were sequenced on the Illumina NovaSeq S1 and on the resolution of 0.6), implemented in Seurat, was applied based on the precalculated
Illumina HiSeq 2500. top 20 PCs. Average expression of the predefined highly variable genes was
 calculated for each cluster in each organoid. Afterward, Spearman correlation
Barcode and scar detection from single-cell cDNA. Barcode and scar regions coefficients were calculated between every cell and every cluster in all organoids.
were amplified from 60–70 ng of cDNA remaining from the scRNA-seq For each cell, its correlations with different clusters of each organoid were z
preparation with three separate PCR reactions. First, cDNA was amplified via PCR transformed. Its z-transformed similarities with clusters of different organoids were
broadly targeting a region containing both the scar and the barcode. Subsequently, then concatenated as the final CSS representation. UMAP and Louvain clustering
the reaction was split equally, and we performed a nested PCR separately targeting (with a resolution of 1) were applied to the CSS representation. Cluster annotation
the barcode and scar regions (primer sequences are provided in Supplementary was carried out by combining expression patterns of canonical cell type markers, for
Table 5). Lastly, we added Illumina sequencing adaptors. Following every PCR example, NES, DCX, SIX6, AIF1, DCN and EPCAM, and VoxHunt5,24 to compare
reaction, samples were cleaned up using magnetic beads (0.9×) (Beckman the average transcriptome of clusters to that of different mouse brain regions.
Coulter), and libraries were sequenced on the Illumina NovaSeq S1. For each organoid, a four-layer lineage tree was reconstructed. The pseudo-root
 node, representing the organoid, was considered as the first layer. Barcode families,
Alignment of single-cell transcriptomes and iTracer readouts. We used Cell that is, cells with the same barcode combination detected, were considered as
Ranger (10x Genomics) to demultiplex base-call files to FASTQ files and align the second layer. Cells in the same barcode family were likely expanded from
reads. Default alignment parameters were used to align reads to a modified human the same iPSC. In each barcode family, scar families, that is, cells with the same
reference including the fluorescent reporter (GFP or RFP) from the cell lineage scar combination, were considered as the third layer, which represents cells in
recorder (hg38). Barcode and scar libraries generated from 10x cDNA were also the organoid expanded from the same cell when Cas9 was induced. At the end,
aligned using default parameters, with the exception that the force-cells argument cells were considered as the fourth layer. Lineage trees were visualized with the
was set to 200,000, and data were aligned to a custom reference of the region of ‘radialNetwork’ function in the ‘networkD3’ R package.
interest. This reference was constructed following 10x recommendations.
 Quantification of barcode family-composition similarity between clusters.
iTracer readout filtering. iTracer barcode transcripts were first filtered at the Barcode family-composition similarity between two cell clusters was quantified as
UMI level, at which transcripts are only retained if they have more than three the number of cell pairs, with each cell in one cluster, that are of the same barcode
reads. We then plotted the distribution of reads per UMI against the frequency family (denoted as ni,j; Fig. 3a). To control for confounding factors including
of read depth per UMI and fit a line with loess through that distribution cell numbers in clusters and organoid composition, 100 random shufflings of
(loess (nreads ≈ log (freq_nreads))), where values smaller than one were set to barcode family information for cells in each organoid were applied, and random
one. We then calculated the first minimum and removed everything that had composition similarity between two clusters was estimated in the same manner
smaller coverage than this point. iTracer barcodes began and ended with A or T (denoted as n′i,j). The observed barcode(family-composition
 ( )) similarity
 ( )was
nucleotides; barcodes that did not match this pattern were removed. We filtered then normalized into the z score zi,j = ni,j − mean n′i,j (s.d. n′i,j )−1.
barcode transcripts such that, when we detected the same UMI for different z transformation was further applied to scale the resulting z scores between
barcodes in the same cell, the one with the highest read coverage was retained. different cluster pairs (denoted as zi,j ), and two cutoffs (0.01 and 0.99 quantiles
Furthermore, when transcripts with the same UMI and barcode were found in
 of the standard normal distribution, that is, zcutoff− = −2.33 and zcutoff+ = 2.33) were
multiple cells, transcripts were removed from these cells. Barcodes were further
 applied to obtain cluster pairs with significantly similar ( zi,j > zcutoff+) or different
filtered such that, when any barcodes with a Hamming distance of one within any ( )
single cell were found, the barcode with the highest coverage was retained. Lastly, zi,j < zcutoff− barcode family composition. To identify groups of cell clusters with
if more than ten barcodes were detected in the same cell, the cell was ignored for
 similar barcode family composition, hierarchical clustering was applied, with the
lineage reconstructions.
 input distance matrix defined as di,j = max(zi,j ) − zi,j.
 iTracer scar transcripts were filtered in a similar manner, in which transcripts
 Alternatively, hierarchical clustering was applied to the binomial-based
were first filtered at the UMI level; again, we only retained transcripts that had
 normalized barcode family-composition similarity distance matrix, which only
more than three reads. As we did for barcodes, we plotted the distribution of
 takes into account the sizes of cell clusters. In brief, assuming the total number
reads per UMI against the frequency of read depth per UMI and fit a line with
 of cell pairs from the same barcode family is N and two clusters i and j represent
loess through that distribution where values smaller than one were set to one. We
 proportions pi and pj of the whole dataset, the expected number of cell pairs in
calculated the first minimum and removed everything that had smaller coverage
 these two different clusters from the same barcode family is ni,j = N × 2pi pj with
than this point. We also filtered transcripts such that, when we detected the same
UMI for different scars in the same cell, the one with the highest read coverage was
 √
 the expected standard deviation of σ i,j = N × 2pi pj 1 − 2pi pj , based on
 ( )
retained. Transcripts were further filtered out if they had the same UMI and scar
but were found in multiple cells. Lastly, we only kept scar transcripts for which the binomial distribution. The observed barcode family-composition ) −1similarity was
 then normalized into the alternative z score zi,j = ni,j − ni,j σ i,j . Hierarchical
 (
same UMI was found in barcode and scar libraries. Similarly, barcode transcripts
without corresponding scar transcripts were also excluded. clustering was then applied to identify groups of cell clusters with similar barcode
 family composition, with the input distance matrix defined as di,j = max(zi,j ) − zi,j
Estimation of barcode complexity in the iTracer+ iCRISPR iPSC line. Single-cell with the alternative z scores.
iTracer barcode transcript readouts of three batches of the iTracer+ iCRISPR
iPSC line were generated. There were 6,966, 5,316 and 4,253 cells detected in the Spatial transcriptomics. Org14 was embedded in prechilled optimal cutting
three libraries, respectively, with, on average, 13,308 (13,218, 12,351 and 14,354) temperature compound. The sample was then set into a dry ice bath with
barcodes detected. For each library, on average, 62% ± 1% of detected barcodes isopentane until frozen and stored at −80 °C. Cryosections were cut at a thickness
were unique. As detected barcode numbers of the three batches were comparable, of 10 µm, adhered to ST slides (10x) and stored at −80 °C until the following day.
we simplified the scenario to three random samplings with the same sampling Tissue slices were fixed in cold methanol before being stained with hematoxylin
ratio (p) from the total population of N barcodes, where the likelihoods of and eosin. ST slides were imaged as recommended on a Nikon T2i at 20× using
different barcodes being selected are assumed to be equal. Therefore, the expected a tile scan over all slice sections. Following image capture, tissue slices were
proportion of unique barcodes in one batch is (1 − p)2. The sampling ratio was permeabilized. Optimal permeabilization conditions were determined by using
therefore estimated to be ~21%, which suggests that the total number of barcodes the Tissue Optimization kit (10x), and the optimal time was found to be 24 min.
available in the iTracer+ iCRISPR iPSC pool is roughly 60,000 or, more precisely, Spot-captured RNA was reverse transcribed before second-strand synthesis
62,597 based on the above calculation. and cDNA denaturation. qPCR was used to determine the optimal number of
 cDNA-amplification cycles as recommended by the manufacturer. cDNA was
Analysis of whole-organoid single-cell RNA-seq data. Seurat (version 3.1)49 amplified using 17–18 cycles before continuing to Visium spatial gene expression
was applied to scRNA-seq data for preprocessing. Ribosomal protein genes and library construction. Visium libraries were sequenced on the Illumina NovaSeq
pseudogenes were excluded from analysis. Generally, cells with more than 6,000 SP following sequencing recommendations. Barcode and scar libraries were
or less than 600 detected genes as well as those with a mitochondrial transcript sequenced on the NextSeq (mid-output).
proportion greater than 20% were excluded (Supplementary Table 1). After log The resulting sequencing reads were aligned using Space Ranger for the regular
normalization, 5,000 highly variable genes were identified using the default vst Visium libraries (10x Genomics). S1 and S3 were automatically tissue aligned,
method, in which cell cycle-related genes were excluded (Supplementary Table whereas we manually annotated tissue-covering spots with Loupe Browser (10x
6). Cell cycle scores were then calculated and regressed out from highly variable Genomics) for S3. Spots not covering tissue were discarded manually in Loupe
gene expression to reduce its confounding effect. Regressed-out expression levels Browser (10x Genomics). Barcodes and scars were called using the methods
were then z transformed, followed by principal-component analysis (PCA) for described above with one exception. To use Cell Ranger to map barcode and scar
dimension reduction. UMAP was applied to the top 20 principal components sequencing reads to the custom reference, the Cell Ranger barcode whitelist was
(PCs) for visualization. replaced with the whitelist from the Space Ranger barcode set.
 To integrate data from different organoids, CSS31 was calculated as described. Two methods were used to annotate spots. First, an elastic net-based machine
In brief, cells from each organoid were subset, and Louvain clustering (with a learning classifier (implemented as glmnet in R) was trained by a random subset


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS
of whole-organoid scRNA-seq data with 2,626 cells in total, with each of the eight that more cluster pairs show significantly different scar family composition than
regional identities (telencephalic, dien–mesencephalic, rhombencephalic, retinal, expected by random chance, therefore implying that significant cell fate restriction
neural crest derivatives, microglia, mesenchymal, epithelial) having no more than occurred when scars were induced.
400 cells, given highly variable gene expression as the input to predict cluster labels. To identify cell clusters sharing similar scar family composition, hierarchical
The trained model was applied to transcriptomic profiles of spots to estimate the clustering was applied to the cell clusters of interest. The input distance matrix was
likelihood of each spot being different clusters. Likelihoods of clusters assigned to defined as Di,j = zi,j − min(zi,j ).
the same regional (or NPC–neuron state) identity were summed up, and spots were
annotated to be the region or state with maximal likelihood, if it was at least 5% Regional heterogeneity in early cerebral organoid development. Four early
higher than the second largest estimated likelihood; otherwise, it was annotated cerebral organoids, which were cultured for 15 d with scars introduced at day 7,
as ‘unassigned’. were dissociated to generate single-cell gene expression libraries. Dissociated cell
 Spots were also annotated using CIBERSORTx35, with which we digitally suspensions were pooled into two samples, each representing two early organoids.
sorted each spatial spot into fractions of cell types present. To this end, we first Single-cell transcriptomes and iTracer readouts were preprocessed and filtered as
constructed a signature matrix for deconvolution using the highly variable genes described above.
and a subset of cells across all cell annotations from the whole-organoid analysis Seurat (version 3.1) was applied to the transcriptome data for log normalization
(Supplementary Table 7). We then input each detected spot across all tissue and highly variable gene identification (vst method, 3,000 genes). PCA was applied
sections (S1–S3) for sorting, which resulted in a matrix of spots versus each cell to the z-transformed expression levels of the highly variable genes, with the top
annotation in which each row summed to 1. We plotted the distribution of the 20 PCs used for UMAP embedding construction and Louvain clustering (with a
highest proportion (score) for each spot and set a threshold such that all spots resolution of 0.6). Cell clusters were annotated as pluripotent stem cells (PSCs),
with the highest contributing proportion less than the first quartile (0.405 or NECs, neural crest cells, mesodermal cells, endodermal cells and others based on
40.5%) were called ‘unassigned’. The remaining spots were then assigned the expression of canonical markers (Extended Data Fig. 8). Cells annotated as PSCs
corresponding cell annotation of their highest contributing proportion. and NECs were subset for the following analysis.
 To quantify the relationship between barcode-composition differences and Focusing on the subset cells, highly variable genes were re-identified (vst, 3,000
spatial proximity between spots, we first defined barcode-composition similarity genes). Genes related to the cell cycle were excluded from the identified genes. Cell
between any two detected spots i and j as the Jaccard index (Ji,j) of detected cycle scores were calculated for cells following the vignette in Seurat and regressed
barcodes in the two spots, that is, the ratio of shared barcode number to unique out from the expression levels before applying z transformation of highly variable
barcode number. Barcode-composition distance was then defined as di,j = 1 − Ji,j. gene expression levels. PCA was then applied to the z-transformed expression
The correlation between barcode-composition distances and spatial distances levels, with the top 20 PCs used for UMAP embedding construction and Louvain
was next calculated. Alternatively, spot pairs were grouped into two groups: (1) clustering (with a resolution of 0.6). Cells were annotated as either PSCs or NECs.
spot pairs with at least one barcode shared and (2) spot pairs with no overlapping To further annotate regional identities of cells in early cerebral organoids,
detected barcode. Spatial distances between spot pairs in the two groups were scRNA-seq data of early neural tube cells and radial glia in the murine early
compared using two-sided Wilcoxon’s rank-sum test. fetal brain were retrieved by subsetting cells in the developing mouse brain
 scRNA-seq atlas38, requiring cells from samples no older than E11.0, annotated
Light-sheet imaging and tracking of cerebral organoids. We generated organoids as neural tube cells and radial glia and with at least 3,000 genes detected. Seurat
using iPSCs expressing the FUS protein tagged with EGFP, which uniformly (version 3.1) was applied to identify highly variable genes (vst, 3,000 genes), and
labels nuclei, and mTagRFP–T–CAAX, which labels membrane, and unlabeled PCA of their z-transformed expression levels was performed. CSS31 was used to
iPSCs. FUS-mEGFP (cell line ID AICS-0080 cl.69), mTagRFP-T-CAAX (cell line integrate and represent cells from different samples (default parameters). The
ID AICS-0054-091) and WTC lines (cell line ID GM25256) used for imaging CSS representation was used for UMAP embedding construction and Louvain
were procured from the Coriell Institute. Organoids were imaged with the LS1 clustering (with a resolution of 2). Cell clusters were annotated by combining
Live light-sheet microscope developed by Viventis Microscopy, using a ×25 sample meta-information of dissected tissues and regional markers. Regional
objective demagnified to ×18.5, with a field of view that was ~700 µm. Successive identities of clusters (combinations of forebrain, midbrain and hindbrain) were
z steps were acquired every 2 µm for 150 steps. The frame rate for acquisition was determined by combining cluster annotation and proportions of cells from
30 min, and, in total, 100 h of development (200 frames) were used for tracking. different dissected brain regions. High-resolution Louvain clustering (with a
For imaging, EBs were embedded in neural-induction medium together with resolution of 20) was also applied to identify cell niches, with regional identities
Matrigel. Light-sheet data were converted into HDF5 format and visualized using of niches summarized as the majority.
the BigDataViewer50 in Fiji37. In total, four nuclei were tracked, the first one for To project early cerebral organoid NECs to the atlas of mouse early neural
100 h and the next three for 65 h. Three neighboring nuclei were tracked in the tube cells and radial glia, we calculated the projected CSS for organoid cells
same developing lumen area and one in another diametrically opposite location by calculating normalized similarities between the cell transcriptome and the
surrounding another lumen in Org15. Nuclei were continually tracked in 3D using transcriptome of clusters in mouse reference samples31 across the one-to-one
a new large-scale tracking and track-editing framework, Mastodon (preview), a orthologous highly variable genes between human and mouse (Ensembl version
next-generation software of the successful tools51,52 developed by the Tomancak 93) in the reference dataset. k-nearest neighbors (k = 50) of each organoid cell
laboratory at the MPI-CBG (https://sites.imagej.net/Mastodonpreview/) as a in the mouse reference were identified, and the major reference cell niche label
plugin in Fiji. It allows semi-automated tracking and manual curation of nuclei was transferred to the organoid cell. The regional label of an NEC in the early
tracks. During lumen expansion and growth, some nuclei tracks are prematurely cerebral organoid was then decided in a hierarchical manner. In brief, an NEC
terminated when they move out of focus. was defined as a hindbrain cell if the projected niche had hindbrain identity.
 Otherwise, it was defined as a midbrain cell if the projected niche had midbrain
Quantification of scar family-composition differences between clusters. To identity. Only if the projected niche only had forebrain identity, the NEC was
quantify scar family-composition differences between clusters, proportions of defined as a forebrain cell.
cells in different scar families of each barcode family were calculated. To increase Focusing on the 13 barcode families (six and seven barcode families in each of
the robustness of the estimate, one pseudocount was added to each scar family the two samples) with at least 20 PSCs and NECs, a two-sided χ2 test was applied
before calculating proportions. Here, only barcode families satisfying the following to compare proportions of NECs with different estimated regional identities in
criteria were considered: (1) families that contain at least five scarred cells and (2) different barcode families. On the other hand, a two-sided Fisher’s exact test was
the second most frequent scar contains at least 10% of scarred cells in the barcode applied to cells in one barcode family (BF1 in sample 1) to compare proportions of
family. For each cell cluster, its scar family proportions of different barcode families NECs with different estimated regional identities in different scar families.
in different organoids were concatenated to represent its scar family composition
(denoted as si). Scar family-composition differences between two clusters i and j Microdissection of single organoid regions. A 200-µm slice of a single organoid
(denoted as di,j) were then defined as the Euclidean distance between si and sj. (Org13) was cut with a vibratome. Regions that were spatially distinct were selected
 To estimate the statistical significance of the scar family distance between two and microdissected away from the slice. Each microdissected area was dissociated
clusters, 1,000 random shufflings of scars were performed. During each shuffling, (as described above), adjusting times and volumes to account for smaller tissue
the scar information of cells in the same barcode family was randomly shuffled. input. Following single-cell isolation, cells were captured using 10x Chromium
Afterward, the shuffled scar family distance di,j was calculated in the same manner targeting 17,000 cells per region across four separate reactions such that each
as described above. The observed scar family distance was then normalized into region was split into two capture reactions. Transcriptome, barcode and scar
the z score zi,j = di,j − mean(d′i,j ) (s.d. d′i,j )−1. A z score that is significantly libraries were prepared as described above. All libraries were pooled and sequenced
 ( ) ( )
larger than zero indicates a significantly large scar family-composition difference on the Illumina NovaSeq S1.
between two clusters, implying that fate restriction occurred when scarring The resulting sequencing reads were aligned and preprocessed as described
was induced. above. Seurat (version 3.1) was applied for log normalization and highly variable
 To capture the global restriction signal, the distribution of observed z scores gene identification (vst method, 5,000 genes; Supplementary Table 6). PCA was
across all cluster pairs was subtracted by the average distribution of the 1,000 applied to z-transformed expression levels of the highly variable genes, with the top
shuffling-based results, resulting in the excess of frequency at different z scores. 20 PCs used for UMAP embedding construction and Louvain clustering (with a
If significant excess of frequency is observed for positive z scores, it indicates resolution of 0.6). Cell cluster annotation was performed by combining canonical

 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles
marker gene expression and CSS projection of cells to the whole-organoid 05888). Additionally, 2 µg ml−1 doxycycline was added to the doxycycline-exposed
scRNA-seq data described above. In brief, whole-organoid CSS representations of cell suspension. In total, 100 µl of the cell solution and 50 µl of the lipofection
cells in the scRNA-seq data from microdissected samples were calculated as the solution were combined for each condition in a well of a 96-well plate coated with
normalized Spearman correlation between the cell transcriptome and the average Matrigel (Corning, 35248). After 24 h, wells were washed with 150 µl DPBS (Gibco,
transcriptome of cell clusters in whole-organoid scRNA-seq data. The k-nearest 14190250), and medium was exchanged with 150 µl fresh StemFlex medium. After
neighbors (k = 50) of each cell in the whole-organoid scRNA-seq data were lipofection (48 h), cells reached ∼80% confluency. Wells were washed with 150 µl
identified as those with the shortest Euclidean distances at CSS representations. DPBS, and the gDNA content of cells was extracted by adding 50 µl QuickExtract
The major cell cluster label of the identified neighbors was assigned to the query solution (Epicentre, QE0905T) according to the manufacturer’s protocol.
cell in the scRNA-seq data from microdissected samples as the transferred label to Amplification of each guide target site was performed by PCR using specific
assist annotation of scRNA-seq data from microdissected samples. primers containing Illumina sequencing adaptors (Supplementary Table 5).
 Barcode family-composition similarities between cell clusters were quantified gDNA treated with QuickExtract (1 µl) from each condition was combined with
as described above. Hierarchical clustering was applied to the random barcode 1 µl of the corresponding forward and reverse primers, 10 µl Phusion HF MasterMix
shuffling-based quantification (ward.D2 method) to group cell clusters into three (Thermo Scientific, F-531L) and 7 µl nuclease-free water before the reaction was run
groups. Scar family-composition differences between cell clusters in each of the in a thermocycler with the following program: 98 °C, 30 s; 30 × (98 °C, 8 s; 62 °C, 20 s;
three groups were then quantified as described above. 72 °C, 22 s); 72 °C, 7 min 30 s. Indexing PCR was then performed by combining 1 µl
 To study the neurogenic synchrony of different stem cells, pseudotime analysis of the previous PCR product with 12.5 µl Phusion HF MasterMix, 9 µl nuclease-free
was applied to cells from the microdissected R2, which were in CG3-1. Pseudotime water and 1.25 µl unique P5 and P7 Illumina indices from the Nextera XT Index kit
analysis was performed with a diffusion map (implemented in the destiny R version 2, set A (Illumina, FC-131-2001) before running the following thermocycler
package) on the top 20 PCs of selected cells. The ranked first diffusion component program: 98 °C, 30 s; 25 × (98 °C, 10 s; 58 °C, 10 s; 72 °C, 20 s); 72 °C, 5 min.
was used as the pseudotime value of each cell. The constructed pseudotime course Double-indexed libraries were pooled and purified twice with SPRI beads (0.9×).
was split evenly into ten bins. The number of cells in each scar family and each Purified libraries were sequenced on the MiSeq (Illumina), resulting in paired-end
barcode family was counted for each pseudotime bin. Distributions of cells in sequences of 2 × 150 bp. Finally, guide cutting efficiency was determined from the
different pseudotime bins of different barcode or scar families were compared sequencing results using CRISPResso2 (ref. 54) with default settings.
using a χ2 test.
 Preparation of iTracer-perturb organoids. iCRISPR cells were cultivated
Establishment of iTracer-perturb. iTracer-perturb plasmids were constructed in six-well plates using standard feeder-free conditions in mTeSR1 (Stemcell
by modifiying the iTracer plasmids in four main steps. All steps were carried Technologies) on Matrigel-coated plates. Cells were infected with 65 µl lentivirus
out using Gibson assembly unless otherwise specified. (1) Replacement of the per well. Transfected cells were allowed to expand for 4 d before flow cytometry. To
sequence for GFP on iTracer with that for RFP–2A–GFP or BFP–2A–GFP. (2) select for cells with successful integration of both TSC2-targeted and nontargeted
Cloning and incorporation of TSC2-targeting or nontargeting gRNA species driven iTracer-perturb, RFP+GFP+ and BFP+GFP+ cells were sorted into separate flow
by the bovine U6 promoter. (3) Construction of the pLenti vector containing cytometry tubes and plated in 12-cell Matrigel-coated plates with mTeSR1.
a hygromycin resistance gene driven by the PGK promoter. (4) Movement of Following cell recovery after flow cytometry, 2,000 cells per well in a 96-well
iTracer-perturb from the pSBbi backbone to the pLenti backbone. In detail, the plate (10% RFP+GFP+, 10% BFP+GFP+ and 80% wild-type cells) were seeded
sequence for the 2A peptide was included as an overhang on oligonucleotides used and differentiated into cerebral organoids using a whole-organoid differentiation
to amplify sequences for GFP, RFP and BFP. The overhand was turned into an protocol5,22. Organoids were scarred by activation of inducible Cas9 at day 5.
overlap region that enabled assembly onto the long-range PCR-amplified iTracer Scarring was achieved using 8 µg ml−1 doxycycline in NIM for 24 h. Organoids
backbone. Sequences for either TSC2-targeting or nontargeting gRNA were cloned were incubated in scarring medium for 24 h before returning to base medium
into the PMJ114 vector (Addgene, 85995) downstream of the bovine U6 promoter without doxycycline.
following instructions in the Perturb-seq manual. Sequences for corresponding Organoids were dissociated as previously described, and RFP+, GFP+ and BFP+
bovine U6 promoter-driven gRNA species were amplified by PCR and cloned cells were sorted into separate pools by flow cytometry. Cell pools were directly
upstream of sequences for human U6 promoter-driven gRNA species targeting loaded onto the 10x microfluidic chip device. Single-cell cDNA was synthesized
GFP in the iTracer plasmid. In parallel, the PGK promoter and hygromycin according to the manufacturer’s recommendations before continuing to library
resistance gene were respectively amplified from AAVS1-mEGFP (Addgene, preparation with 25% of the total cDNA volume. Libraries were sequenced on the
114404) and the Hygro-Cas9 donor (Addgene, 86883) and assembled onto the Illumina NovaSeq S1. Barcode and scar regions were amplified from 30–50 ng
pLenti backbone from PMJ114. iTracer-perturb was then moved from the pSBbi of cDNA remaining from the scRNA-seq preparation with three separate PCR
backbone to the pLenti vector between the 5′-LTR and PKG-hygroR. Barcodes reactions. First, cDNA was amplified, broadly targeting a region containing both
generated by PCR using oligonucleotides containing random nucleotides as a the scar and barcode; this was performed by monitoring qPCR amplification and
template were introduced at the last step into the pLenti-PLT vector. stopping amplification before the plateau. Subsequently, the reaction was split
 Lentiviruses were packaged by first culturing HEK293T cells in DMEM with equally, and we performed PCR, separately targeting the barcode and scar regions
10% FBS and antibiotics at 37 °C in an atmosphere with 5% CO2. To prepare (primer sequences are provided in Supplementary Table 5). Lastly, we added
lentiviruses, HEK293T cells were passaged 1:2 every day for at least 2 d for optimal Illumina sequencing adaptors. Following every PCR reaction, samples were cleaned
cell conditions. Cells at 90% confluency were transfected with pLenti plasmids, up using magnetic beads (0.9×) (Beckman Coulter), and libraries were sequenced
pGag/pol, pVSVG, pRev and pTat using the TransIT-293 transfection reagent on the Illumina NovaSeq S1.
(Mirus Bio). Medium containing transfection reagents was replaced 16 h after
transfection with rich medium containing 30% FBS. Lentiviruses were collected Analysis of iTracer-perturb. scRNA-seq and iTracer readouts were aligned
48 h after transfection and concentrated 50× using the Lenti-X concentrator as previously described. Seurat (version 4) was applied to scRNA-seq data for
(Takara Bio) following the manufacturer’s instructions. Concentrated lentiviruses preprocessing. Generally, cells with less than 1,000 detected genes as well as those
were preserved in a −80 °C freezer until use. with mitochondrial transcript proportion greater than 10% were excluded. After
 log normalization, 3,000 highly variable genes were identified using the default
Validation of TSC2 guide cutting. Guides were designed using vst method, in which cell cycle-related genes, mitochondrial genes and ribosomal
CRISPRdirect targeting exons 11, 13, 22 and 28 of TSC2 (ref. 53): protein-encoding genes were excluded. Cell cycle scores were then calculated
GGCCATGGCATGTCCGAACG, GTGGATGGACTGCGCTCTAT, and regressed out from highly variable gene expression to reduce its confounding
TGGACAAGGCCACGACGCAC and ACCGGGACCCGGTCGTTACT, effect. Regressed-out expression levels were then z transformed, followed by PCA
respectively. iCRISPR iPSCs were cultured in StemFlex medium (Gibco, A3349401) for dimension reduction (the top 20 PCs were used). CSS was then calculated in a
supplemented with 1:200 penicillin–streptomycin (Gibco, 15140-122) unless manner similar to that described above (clustering resolution of 1) to integrate cells
otherwise mentioned. Before lipofection (24 h), cells were treated either without or sorted by different fluorescence signals. PCA was then applied to further summarize
with 2 µg ml−1 doxycycline (Clontech, 631311) in StemFlex medium to induce Cas9 the calculated CSS into ten PCs. UMAP and Louvain clustering (with a resolution
expression. The Alt-R CRISPR–Cas9 System (IDT) was used for guide delivery of 0.5) was applied to the PCA-on-CSS representation. Cluster annotation was
with lipofection according to the manufacturer’s protocol. To form the crRNA– performed by combining expression patterns of canonical cell type markers. We
tracrRNA complex at a final concentration of 3 µM for each guide complex, 1.5 µl detected at least one barcoded transcript for GFP in 221 RFP+ and 3,808 BFP+
of each guide crRNA was combined with 3 µl tracrRNA and 44 µl Nuclease-Free cells, with 19.7% of these cells containing at least one GFP scar. For each cluster,
Duplex Buffer (IDT, 11-01-03-01) and heated at 95 °C for 5 min. For reverse the number of RFP+ or BFP+ cells with at least one GFP scar detected (that is, fully
transfection, 1.5 µl of the crRNA–tracrRNA complex mix and 0.75 µl RNAiMAX informative cells) was calculated. Cell clusters with at least 100 fully informative
(Invitrogen, 13778075) were diluted in 47.75 µl Opti-MEM (Gibco, 1985-062) and cells were defined as sufficiently scarred clusters and used for the following analysis.
incubated for 20 min at room temperature. During incubation, ∼70% confluent Mixscape analysis, adapted from the online tutorial (https://satijalab.org/seurat/
iCRISPR cells from both the no-doxycycline control and doxycycline-exposed articles/mixscape_vignette.html), was applied to cells in these clusters to obtain the
cells were detached separately with TrypLE (Gibco, 12605010), centrifuged and posterior perturbation probability, using BFP+ cells as nontargeting cells and RFP+
resuspended at a concentration of 400,000 cells per ml in StemFlex medium cells as targeting cells. Next, a five-layer lineage tree was reconstructed for cells in
without penicillin–streptomycin supplemented with 1:10 CloneR (Stemcell, the sufficiently scarred clusters using a method similar to the one described above.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS
One extra layer (RFP+ or BFP+) was added between the organoid layer and the 48. Pinello, L. et al. Analyzing CRISPR genome-editing experiments with
barcode family layer. UMAP and Louvain clustering (with a resolution of 1) was CRISPResso. Nat. Biotechnol. 34, 695–697 (2016).
further applied to dissect cell state heterogeneity. 49. Butler, A., Hoffman, P., Smibert, P., Papalexi, E. & Satija, R. Integrating
 To compare transcriptomic profiles of RFP+ and BFP+ cells as well as different single-cell transcriptomic data across different conditions, technologies, and
scar families of BFP+ cells, we applied analysis of covariance to genes detected in species. Nat. Biotechnol. 36, 411–420 (2018).
at least 1% of cells. For each gene, we applied an F-test to compare the full model 50. Pietzsch, T., Saalfeld, S., Preibisch, S. & Tomancak, P. BigDataViewer:
with both covariates (cell clusters and log-transformed UMI numbers) and the visualization and processing for large image data sets. Nat. Methods 12,
condition variable (for example, RFP+ or BFP+) and the reduced model with only 481–483 (2015).
the covariates. DEGs were defined as genes with Bonferroni-corrected P < 0.01, 51. Wolff, C. et al. Multi-view light-sheet imaging and tracking with the MaMuT
with the coefficient of the condition variable greater than 0.1 or less than −0.1. software reveals the cell lineage of a direct developing arthropod limb. eLife 7,
 To compare the cell state trajectory of different cell lineages, pseudotime was e34410 (2018).
constructed to represent the cell state transition from NECs to NPCs. In brief, cell 52. Tinevez, J. Y. et al. TrackMate: an open and extensible platform for
cycle scores were first regressed out from PCA-on-CSS representations, followed by single-particle tracking. Methods 115, 80–90 (2017).
diffusion map analysis of the resulting representations. The resulting first diffusion 53. Naito, Y., Hino, K., Bono, H. & Ui-Tei, K. CRISPRdirect: software for
component was ranked across cells and considered as the pseudotime. designing CRISPR/Cas guide RNA with reduced off-target sites.
 Bioinformatics 31, 1120–1123 (2015).
Flow cytometry. To select iTracer+ iPSCs, cells were detached from 54. Clement, K. et al. CRISPResso2 provides accurate and rapid genome editing
Matrigel-coated plates to create a single-cell suspension. Briefly, cells were washed sequence analysis. Nat. Biotechnol. 37, 224–226 (2019).
with DPBS before being lifted from the Matrigel plate with Accutase for 5–7 min
before quenching with KnockOut Media and centrifuging at 200g for 5 min. Cells Acknowledgements
were resuspended and filtered through a 30-µm cell strainer in 500 µl mTeSR1 We thank J.P. Junker, B. Spanjaard and B. Hu for inspiring discussions and protocols.
supplemented with Rock inhibitor (1:200) and Primocin (1:500). Cells were We also thank the Camp and Treutlein laboratories for their support and particularly
sorted on the BD Aria Fusion or the BD Aria III using a 100-µm nozzle, selecting acknowledge B. Kashanian and R. Okamoto for their assistance with stem cell
for single cells and excluding doublets, based on their florescent reporter. For and organoid culture. We also thank A. Boni and P. Strnad for helping us acquire
iTracer experiments, selection was based on GFP or RFP positivity, whereas movies of developing organoids with their light-sheet system. Additionally, we
iTracer-perturb cells were identified based on dual expression (RFP and GFP; BFP thank P. Tomancak, V. Ulman and T. Pietzsch for their support in implementing
and GFP). All cells were sorted into mTeSR1 medium supplemented with PenStrep the Mastodon plugin for tracking light-sheet data. Illumina sequencing was
(1:200), Rock inhibitor (1:200) and Primocin (1:500). Flow cytometry data were performed in the Genomics Facility at D-BSSE, ETH Zurich and by B. Schellbach
visualized with BD FACSDiva 9.0.1. and A. Weihmann at the Max Planck Institute for Evolutionary Anthropology.
 To select iTracer-perturb cells from organoids, organoids were first dissociated Flow cytometry sorting support was provided by the single-cell facility at D-BSSE,
as previously described. After dissociation, cells were resuspended in DPBS ETH Zurich. This project has been made possible in part by the Chan Zuckerberg
supplemented with BSA (0.04%, Miltenyi, 130-091-376). Cells were sorted on the Initiative DAF (grant CZF2017-173814, J.G.C. and B.T.), an advised fund from the
BD Aria Fusion or the BD Aria III using a 100-µm nozzle, selecting for single cells Silicon Valley Community Foundation, by Human Frontier in Science Program
and excluding doublets, based on their florescent reporter (dual BFP- and GFP-, and EMBO Postdoctoral Fellowships (H.-C.L.), the European Research Council
dual RFP- and GFP- or GFP-positivity alone). All cells were sorted into DPBS (Anthropoid-803441, J.G.C.; Organomics-758877, B.T.; Braintime-874606, B.T.), the
supplemented with BSA (0.04%), and flow cytometry data were visualized with Swiss National Science Foundation (project grant 310030_184795, J.G.C.; project
BD FACSDiva 8.1. grant 310030_192604, B.T.) and the National Center of Competence in Research,
 Molecular Systems Engineering (B.T.). H.-C.L. is supported by the Human Frontier
Statistics and reproducibility. No statistical method was used to predetermine Science Program (LT000399/2020-L).
sample size. No data were excluded from analysis. Experiments were not
randomized. Investigators were not blinded to allocation during experiments
and outcome assessment. Boxes in all the box plots represent upper and lower Author contributions
quartiles. The center line represents the median. Whiskers show the minimum T.G., B.T. and J.G.C. designed the iTracer system. R.P., T.G., L.S. and S.R. established
and maximum of the data if there is no outlier. Outliers are defined as data points the iTracer system. H.-C.L. and A.M. established the iTracer-perturb system. J.-S.D.
outside 1.5 times the interquartile range above the upper quartile and below validated iTracer-perturb gRNA species. M.S., R.P. and A.M. performed flow cytometry.
the lower quartile. Only one cerebral organoid was imaged by 4D light-sheet R.P., A.M., A.J., F.S.C. and S.M.J.J. performed organoid culturing. R.P., A.M. and T.G.
microscopy and is shown in Fig. 3b–d and Extended Data Fig. 6a,c. Bright-field performed bulk and single-cell genomic experiments. A.M. and J.G.C. performed
and fluorescence imaging of iTracer reporter (RFP) in organoids shown in organoid microdissection experiments. A.M. performed organoid spatial transcriptomic
Extended Data Fig. 1b is representative of images of multiple organoids (n > 10). experiments. Z.H., T.G. and A.M. analyzed sequencing data. A.J. performed light-sheet
 microscopy. A.J., K.L., M.S. and Z.H. performed nuclei tracking and data analysis. Z.H.,
Reporting Summary. Further information on research design is available in the A.M., T.G., A.J., J.G.C. and B.T. designed the study and wrote the manuscript.
Nature Research Reporting Summary linked to this article.
 Competing interests
Data availability The authors declare no competing interests.
Sequence data that support the findings of this study have been deposited in
ArrayExpress under the accession codes E-MTAB-10973, E-MTAB-10974
(scRNA-seq data based on 10x Genomics), E-MTAB-10972 (spatial transcriptomic
 Additional information
 Extended data is available for this paper at https://doi.org/10.1038/s41592-021-01344-8.
RNA-seq data based on 10x Visium) and E-MTAB-10971 (iTracer-perturb data).
Bulk sequencing of barcode and scar library data as well as processed sequencing Supplementary information The online version contains supplementary material
data have been deposited in Mendeley Data at https://doi.org/10.17632/nj3p3pxv6p. available at https://doi.org/10.1038/s41592-021-01344-8.
 Correspondence and requests for materials should be addressed to
Code availability J. Gray Camp or Barbara Treutlein.
The computational code used in this study is available at GitHub (https://github. Peer review information Nature Methods thanks Samantha A. Morris and the other,
com/quadbiolab/iTracer) or upon request. anonymous, reviewer(s) for their contribution to the peer review of this work.
 Editor recognition statement: Madhura Mukhopadhyay was the primary editor on this
References article and managed its editorial process and peer review in collaboration with the rest of
47. Datlinger, P. et al. Pooled CRISPR screening with single-cell transcriptome the editorial team.
 readout. Nat. Methods 14, 297–301 (2017). Reprints and permissions information is available at www.nature.com/reprints.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles


Extended Data Fig. 1 | Assessment of iTracer readouts iPSC and iPSC-derived cerebral organoids. (a) FACs plots of sorting scheme used to isolate
iTracer positive cells. Cells were gated first based on the main population to avoid debris, followed by gating for single cells excluding doublets, and lastly
sorted for RFP or GFP positive cells as compared to non-fluorescent negative controls. (b) Brightfield and fluorescence imaging of iTracer reporter (RFP)
in representative organoids during cerebral organoid development. Scale bar is 500 µm in all images (c) Stacked bar plots showing frequency of unique
barcodes detected in bulk targeted amplicon sequencing libraries throughout cerebral organoid development. (d) Barplots of the number of iTracer
barcodes detected from single-cell transcriptomes. The left panel shows frequencies of cells with different numbers of detected barcodes. The dashed
line shows the average number of detected barcodes per cell (2.85). The middle panel shows numbers of barcodes in relation to fluorescent reporter
detection. Each dot represents one cell. The right panel shows frequencies of barcodes detected in different numbers of cells. The dashed line indicates
that on average one barcode is detected in 1.54 cells. (e) Scar detection in iPSCs treated with no doxycycline, 2 µg of doxycycline for one day, and 2 µg of
doxycycline for two days. (f) Bar plots showing percentage of scarred GFP transcripts detected in 3D cultures treated with 0-8 µg of doxycycline at EB and
neuroectoderm stages (mean values +/− SEM). Dots show the values of individual samples.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS


Extended Data Fig. 2 | See next page for caption.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles
Extended Data Fig. 2 | Integration and cell type annotation of iTracer cerebral organoid single-cell transcriptomes. (a) UMAP embedding of single-cells
from two batches of iTracer whole-organoids without integration, colored by organoid. (b) UMAP embedding of single-cells from two batches of iTracer
whole-organoids colored by cell type annotation (telen. - telencephalon; dien./mesen. - diencephalon/mesencephalon; rhomben. - rhombencephalon;
neural crest deriv. - neural crest derivatives). (c) UMAP colored by expression of selected marker genes. (d) Schematic of cluster annotation of CSS
integrated whole-organoid data using VoxHunt. Similarity scores are calculated between average gene expressions of identified clusters in the wholeorganoid data and in situ hybridization signals in the E13.5 mouse brain in Allen Brain Atlas. (e) Sagittal projections colored by scaled similarity scores of
each cluster from integrated whole-organoid data to voxel maps of the E13.5 mouse brain. (f) Heatmap of cell type and cell state marker genes across all
CSS integrated whole-organoid clusters (mesen. - mesenchyme).


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS


Extended Data Fig. 3 | iTracer readouts across 12 organoids. (a) Stacked barplot showing the number of cells measured across all 12 organoids (lightest
grey), where only iTracer reporter was captured (light grey), with reporter and barcodes (dark grey) or reporter, barcodes and scars (black). (b) Histograms
of the cell numbers with different numbers of barcodes detected across all 12 organoids. (c) Stacked barplot showing the proportion of cells with barcode
detected under different iTracer reporter transcript cutoffs. (d) Barplot of the number of barcode families and sizes of families detected. (e) UMAP embedding
of scRNA-seq data of 44,275 cells from 12 cerebral organoids, cells are colored by cluster and boxplot of iTracer reporter expression (eGFP or Tomato) for
each cluster in the corresponding UMAP projection. (f) Stacked bar plots showing frequency of unique scars among all 12 organoids. (g) Barplot of number of
scars and scar lengths detected.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles


Extended Data Fig. 4 | iTracer barcode families accumulate in distinct brain regions. (a) Heatmap of cell number normalized barcode family similarity,
with hierarchical clustering (ward.D2 method) applied to cell-number-normalized barcode family composition distances. (b) Heatmap of similarity of
organoid composition, defined as the Pearson’s correlation coefficient between cell frequencies of each cluster across different organoids, with hierarchical
clustering (ward.D2 method) applied to the correlation distances between cell frequencies of clusters across different organoids.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS


Extended Data Fig. 5 | See next page for caption.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles
Extended Data Fig. 5 | Regionalization of cell types across cerebral organoids. (a) Schematic of spot annotation by digital cytometry using CIBERSORTx.
(b-g) 3D spatial feature plots of expression of genes marking different cell types and brain regions. (h) 3D spatial feature plots of expression of iTracer
RFP reporter. (i) 3D spatial plot of spots with (red) and without (grey) iTracer barcodes detected. Barplot of detected iTracer barcodes across all sections.
Scatterplot of detected barcodes and iTracer RFP reporter. (j) Spot plot for section 1 colored by deconvolved cell type assignment by CIBERSORTx. (k)
Spot plot for each section (S1-S3), colored by deconvolved cell type assignment by CIBERSORTx (l) spot comparison between ML-based (Fig. 2b-d) and
CIBERSORTx spot annotations (m) NPC and neuron scores plotted for section 1 (n) UMAP embedding of spots from sections 1-3 colored by regional
identity, NPC/neuron scores, and expression of selected genes. (o) Boxplots of the iTracer barcode composition of each spot pair vs the spatial distance of
each spot pair across all sections (S1-S3) in any regions (left), same cell type regions (middle) and different cell type regions (right). Two-sided Wilcoxon
rank sum tests were performed comparing shared to same and exclusive groups, *** indicates p-values<0.0001 (n > 2898 spot pairs). (p) Scatter plots of
barcode distance between each spot pair at the same section vs their spatial distance, in all the three sections, in any regions (left), same cell type regions
(top-right) and different cell type regions (bottom-right). (q-r) 3D plot of spots across the three tissue sections where different scars on two example
barcodes: barcode 5 (q) and barcode 6 (r) are highlighted. Boxplots show the distributions of spatial distances between spots with the same scar or with
different scars. P values represent unadjusted two-sided Wilcoxon test significance (nShared = 298 (c), 4200 (d); nDiff = 1206 (c), 24268 (d) spot pairs from
three slices). (s) Stacked bar plots showing the proportion of spots with different annotated brain regional identities, with each bar representing spots with
one barcode and one scar detected. P values show the χ2 test significance without adjustment.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS


Extended Data Fig. 6 | Tracking spatial distribution of nuclei lineages using Light sheet microscopy. (a) Example images show a nucleus dividing into
two daughter nuclei in the developing organoid. White circles represent manual detection and tracking over time. (b) Scatter plot shows increase in the
number of nuclei over 100 hours of tracking in lineage one (L1). The curve shows the exponential model estimated by the data, with the estimated doubling
time being 17.3 hours. (c) Nuclei tracking of three lineages (L1-L3) in the same lumen area (top) and of a fourth lineage (L4) surrounding a diametrically
opposite lumen (bottom). Scale bar is 100 µm in all images. (d) Lineage trees for the four tracked nuclei lineages. (e) Spatial distribution in the x-y plane
of the four tracked lineages. Nuclei are shown at 0 hours and 65 hours, colored by lineage. (f) Dotplot shows the increase in the number of daughter nuclei
for all four lineages over 65 hours.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles


Extended Data Fig. 7 | iTracer readouts enable construction of cell lineage trees from cerebral organoids. (a-i) Lineage plots show full lineage
reconstructions, as well as the subset of cells where scars were detected from 9 organoids. The first and second order deviation nodes represent barcode
and scar families respectively, with the terminal branches indicating individual cells. Each cell is colored based on the cell type designation.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS


Extended Data Fig. 8 | Early patterning in cerebral organoids. (a) UMAP embedding of all cells in the early cerebral organoids at day 15, with cells colored
by annotated cell types or samples. (b) Expression of genes marking different cell types. (c) Overview of the developing mouse brain scRNA-seq atlas [La
Manno preprint]. Cells are colored by annotated cell classes or sample ages. (d) A subset of cells, representing the early neural tube cells (ENTCs) and
radial glia (RG) in different regions of the developing mouse brain, were selected and integrated using CSS. (e-f) UMAP embedding of mouse ENTCs and
RG with cells colored by (e) sample ages and (f) dissected tissues. (g) Expression of genes marking different brain regions and genes encoding selected
morphogens. (h) UMAP embedding of mouse ENTCs and RG with cells colored by cell clusters (left) or cluster regional identities (right). Labels show the
organizer cells. (i) Schematic showing the computational workflow of projecting human early cerebral organoid cells to the developing mouse brain ENTCs
and RG references to estimate their regional identities.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles


Extended Data Fig. 9 | See next page for caption.


Nature Methods | www.nature.com/naturemethods

Articles NaTuRE METHODS
Extended Data Fig. 9 | Deep cell and lineage sampling of micro-dissected regions from cerebral organoids. (a) Schematic of data projection procedure
for single-cells from two regions of a micro-dissected organoid to the whole-organoid scRNA-seq data to assist cell annotation. UMAP embedding
of single cells colored by projected annotation from the whole-organoid scRNA-seq data. (b) Expression of selected cell type markers in cells in the
two regions of the micro-dissected organoid. (c) Heatmap of cell type and cell state marker genes across all micro-dissected organoid clusters. (d)
Hierarchical clustering of the micro-dissected organoid clusters, based on the barcode family composition distances. UMAP embedding of single-cells
is colored by the resulting three groups of clusters (CG.1-CG.3). Clusters in each group share similar barcode family compositions. (e) Hierarchical
clustering of cluster group 2 (CG.2) based on scar family composition distance, to identify two subgroups of clusters. Clusters in each of the subgroups
share similar scar family compositions. (f) Stacked bar plots showing distributions of cell proportions across subgroups of CG.2 clusters with distinct scar
family compositions. Each stacked bar shows a different scar family in the same example barcode family 3. (g) UMAP embedding of cells in CG.2 clusters,
colored by the two cluster subgroups with distinct scar family compositions, and expression of example genes with differential expression between the
two subgroups. (h) Hierarchical clustering of cluster group 3 (CG.3) based on scar family composition distance, to identify three subgroups of clusters.
Clusters in each of the subgroups share similar scar family compositions. (i) Stacked bar plots showing distributions of cell proportions across subgroups
of CG.3 clusters with distinct scar family compositions. Each stacked bar shows a different scar family in the same example barcode family 4 (left) or
barcode family 5 (right). (j) UMAP embedding of cells in CG.3 clusters, colored by the three cluster subgroups with distinct scar family compositions, and
expression of example genes with differential expression between the two subgroups.


 Nature Methods | www.nature.com/naturemethods

NaTuRE METHODS Articles


Extended Data Fig. 10 | Simultaneous TSC2 perturbation and lineage tracing with iTracer. (a) Schematic of gRNAs designed to target the TSC2 gene.
(b) Bar plots of cut efficiency, represented as fold changes of modified read proportions to negative controls, at the predicted target site when different
gRNAs were lipofected. (c) FACs plots of sorting scheme used to isolate TSC2-targeting and non-targeting perturb-iTracer positive cells. Cells were
gated first based on the main population to avoid debris, followed by gating for single cells excluding doublets, and lastly sorted for GFP + RFP positive
(TSC2-targeting) or GFP + BFP positive (non-targeting) cells as compared to non-fluorescent negative controls. (d) FACs plots of sorting scheme used
to isolate cells in the TSC2-perturb-iTracer organoid. Cells were firstly gated similar to (c), and lastly sorted for GFP-only positive, RFP positive and BFP
positive cells. (e-g) UMAP embeddings show the complete scRNA-seq data in the cerebral organoid, with cells colored by (e) their cell clusters and
annotations, (f) expression of selected marker genes, and (g) fluorescence of all cells or only cells with GFP scars. (h) Numbers of RFP + /BFP + cells with
GFP scars in each cell cluster. The dash line shows 100 cells. Clusters with at least 100 RFP + /BFP + cells with GFP scars are considered as sufficiently
scarred clusters. (i) UMAP embeddings show cells in the sufficiently scarred clusters, colored by their fluorescence, cell clusters and scar families (>=20
members). (j) Mixscape-estimated posterior probability of perturbation, with BFP + cells as non-targeting and RFP+ cells as targeting. The numbers show
the cell number estimated in each category. (k) Lineage plot of cells in the sufficiently scarred clusters. The first order deviation nodes represent BFP+ and
RFP+ cells; second and third order deviation nodes represent barcode and scar families respectively. The terminal branches indicate individual cells. Each
cell is colored based on the cell cluster designation. (l) Numbers of cells in different BFP + scar families, and numbers of DEGs identified between cells in
each BFP+ scar family and other BFP + cells. (m) Frequency of genes identified as DEGs between different BFP+ scar families. Genes detected as DEGs in
at least three BFP+ scar families are defined as reproducible clonal DEGs. (n) DAVID functional enrichment of reproducible clonal DEGs.


Nature Methods | www.nature.com/naturemethods
