Article

An integrated transcriptomic cell atlas of
human neural organoids

https://doi.org/10.1038/s41586-024-08172-8 Zhisong He1,19 ✉, Leander Dony2,3,4,5,19, Jonas Simon Fleck6,19, Artur Szałata2,7, Katelyn X. Li2,3,
 Irena Slišković2,3,4, Hsiu-Chuan Lin1, Malgorzata Santel1, Alexander Atamian8,9,
Received: 2 October 2023
 Giorgia Quadrato8,9, Jieran Sun1, Sergiu P. Pașca10,11, Human Cell Atlas Organoid Biological
Accepted: 8 October 2024 Network*, J. Gray Camp6,12 ✉, Fabian J. Theis2,5,7 ✉ & Barbara Treutlein1 ✉

Published online: 20 November 2024

Open access Human neural organoids, generated from pluripotent stem cells in vitro, are useful
 Check for updates tools to study human brain development, evolution and disease. However, it is unclear
 which parts of the human brain are covered by existing protocols, and it has been
 difficult to quantitatively assess organoid variation and fidelity. Here we integrate
 36 single-cell transcriptomic datasets spanning 26 protocols into one integrated
 human neural organoid cell atlas totalling more than 1.7 million cells1–26. Mapping to
 developing human brain references27–30 shows primary cell types and states that have
 been generated in vitro, and estimates transcriptomic similarity between primary
 and organoid counterparts across protocols. We provide a programmatic interface
 to browse the atlas and query new datasets, and showcase the power of the atlas to
 annotate organoid cell types and evaluate new organoid protocols. Finally, we show
 that the atlas can be used as a diverse control cohort to annotate and compare
 organoid models of neural disease, identifying genes and pathways that may underlie
 pathological mechanisms with the neural models. The human neural organoid cell
 atlas will be useful to assess organoid fidelity, characterize perturbed and diseased
 states and facilitate protocol development.


Human neural organoids, self-organizing three-dimensional human with glycolysis3,10,23,24,38. Nevertheless, analysis of organoid tissues supneural tissues grown in vitro, are becoming powerful tools for stud- ports a useful recapitulation of early brain development, and scRNA-seq
ying the mechanisms of human brain development, evolution and methods have been applied to study the molecular basis of neural cell
disease31–33. They can be generated using external patterning factors type fate determination20, evolutionary differences in primates3,38,40,41
(for example, morphogens) to guide their development towards and pathological changes in neural disorders16,26,42,43. However, it is
certain brain regions or to drive the emergence of specific cell types unclear which portions of the developing central nervous system can
(guided protocols)7,11,18,34,35. Conversely, unguided protocols rely on be generated with existing protocols and which ones are still lacking.
the self-patterning capacity of organoids to generate diverse cell types It has also remained challenging to systematically quantify the tranand states36,37. scriptomic fidelity of neural organoid cells compared to their primary
 Single-cell RNA sequencing (scRNA-seq) is a powerful technology counterparts.
to characterize cell type heterogeneity in complex tissues, and has In this study, we address these challenges by combining 36 scRNA-seq
illuminated a remarkable heterogeneity of diverse progenitor, neuronal datasets covering numerous human neural organoid protocols into an
and glial cell types that can develop within neural organoids2–4,37,38, as integrated transcriptomic cell atlas. We establish an analytical pipewell as differentiation trajectories of certain neural lineages. The data line that allows for the comprehensive and quantitative comparison
also enable the comparison of human neural organoid cells to those of the organoid atlas to reference atlases of the developing human
in the primary human brain, and most analyses have revealed strong brain27. We harmonize annotations of cell populations in the primary
similarity in molecular signatures6,18,25,39. Substantial differences have and organoid systems, estimate the capacity and precision of differalso been reported, including differential gene expression linked to ent neural organoid protocols to generate different brain regions, and
media components39 and perturbed metabolic signatures associated identify primary cell populations that are under-represented in neural

1
 Department of Biosystems Science and Engineering, ETH Zürich, Basel, Switzerland. 2Institute of Computational Biology, Computational Health Center, Helmholtz Munich, Neuherberg, Germany.
3
 Department Genes and Environment, Max Planck Institute of Psychiatry, Munich, Germany. 4International Max Planck Research School for Translational Psychiatry (IMPRS-TP), Munich, Germany.
5
 TUM School of Life Sciences Weihenstephan, Technical University of Munich, Freising, Germany. 6Institute of Human Biology (IHB), Roche Pharma Research and Early Development, Roche
Innovation Center Basel, Basel, Switzerland. 7School of Computation, Information, and Technology, Technical University of Munich, Munich, Germany. 8Department of Stem Cell Biology and
Regenerative Medicine, Keck School of Medicine, University of Southern California, Los Angeles, CA, USA. 9Eli and Edythe Broad CIRM Center for Regenerative Medicine and Stem Cell
Research at USC, Keck School of Medicine, University of Southern California, Los Angeles, CA, USA. 10Department of Psychiatry and Behavioral Sciences, Stanford University, Stanford, CA,
USA. 11Stanford Brain Organogenesis Program, Wu Tsai Neurosciences Institute and Bio-X, Stanford, CA, USA. 12Biozentrum, University of Basel, Basel, Switzerland. 19These authors contributed
equally: Zhisong He, Leander Dony, Jonas Simon Fleck. *A list of authors and their affiliations appears at the end of the paper. ✉e-mail: zhisong.he@bsse.ethz.ch; jarrettgrayson.camp@unibas.ch;
fabian.theis@helmholtz-munich.de; barbara.treutlein@bsse.ethz.ch


690 | Nature | Vol 635 | 21 November 2024

a 1.8 million cells Curation Integration UMAP
 c Non-telen. Endothelial Non-telen. d FOXG1 EMX1 BCL11B SATB2
 NPC cells neuron
 Consistent Auto- Multi-level Neuro-
 preprocessing annotation annotation CP
 epithelium vTelen
 Pseudotime
 26 publications Metadata Label-aware analysis inhibitory
 36 datasets harmonization integration PSC neuron
 (2 unpublished) DLX2 ISL1 GABRA2 LHX5

 b Mesen-
 chymal Dorsal telen.
 cells excitatory
 neuron
 Datasets


 Dorsal LHX9 OTX2 TFAP2A HOXB2
 telen.
 NPC
 Glioblast
 Neural vTelen
 crest NPC SLC32A1 SLC17A6 TH CA8
 Max.


 Expression
 Age (days) 10 30 100 300 derivatives
 OPC/
 Cell number scRNA-seq method Differentiation Astrocyte oligodendrocyte
 100 10x 3' v.1 BD Rhapsody Guided Unguided
 10x 3' v.2 Drop-seq + morphogens 0
 1,000 Quartz-seq
 10x 3' v.3
 10,000 10x multi-ome SPLiT-seq
 Hashtag 10x 3' v.2 Smart-seq2

 g e f


 Hy len


 go
 P
 e


 MH
 Cb

 Ch
 Oli
 Guided to dorsal telencephalon MB


 Th
 Unguided


 vT
 Type
 Protocol
 Dataset
 1.0

 0.8
Proportion


 0.6

 0.4

 0.2
 Age (days) Protocol type
 Guided
 0 7 56 450
 Age Unguided

 h i Dorsal telen. j k
 NPC and neurons 15 SOX2 STMN2
 ExN (HOXB2/NEUROD6+) InN (TFAP2A+)
 SLC17A6 Max.–Min.
 Early neuron normalized
 Ranked InN (HOXB2+) SLC32A1
 (HOXB2+) SLC18A3
 DC1 (0,1] 0
 SLC18A3+ neuron
 expression
 ExN (HOXB2+) HOXB2
 1 (HOXB2+) TFAP2A 1
 0 1.0
 ExN (ISL1+) InN (ISL1+) ISL1
 BCL11B SATB2
 6 6 LHX9
 InN (LHX9+)
 LHX5
 ExN (LHX9/TCF7L2+) TCF7L2
 InN (TTR+) TTR 0
 0 0 0
 ExN (LHX9/LHX5+)
 0 1.0 0 1.0
 Pseudotime (ranked DC1)

Fig. 1 | Integrated HNOCA. a, Overview of HNOCA construction pipeline. between cells. The stream arrows visualize the inferred flow of cell states
b, Metadata of biological samples included in HNOCA. c–f, UMAP of the toward more mature cells. i, Marker gene expression profiles along cortical
integrated HNOCA, coloured by level 2 cell type annotations (c), gene pseudotime. j, UMAP of non-telencephalic neurons, coloured and labelled by
expression profiles of selected markers (d), sample ages (e) and differentiation clusters. k, Heatmap showing relative expression of selected genes across
protocol types (f). g, Proportions of cells assigned to different cell types in different non-telencephalic neuron clusters. Coloured dots show cluster
the HNOCA. Every stacked bar represents one biological sample, grouped by identities as shown in j. Cb, cerebellum; ChP, choroid plexus; CP, choroid
datasets and ordered by increasing sample ages. Top bars show 36 datasets, plexus; Hy, hypothalamus; max., maximum; MB, midbrain; MH, medulla; min.,
organoid differentiation protocols, protocol types. Bottom bars show the minimum; Oligo, oligodendrocyte; OPC, oligodendrocyte progenitor cell; PSC,
sample age. h, UMAP of the integrated HNOCA coloured by top-ranked pluripotent stem cell; telen., telencephalon; Th, thalamus; vTelen, ventral
diffusion component (DC1) on the real-time-informed transition matrix telencephalon.


organoids. We estimate transcriptomic fidelity of neurons in neural biological metadata from 36 datasets, including 34 published1–26 and
organoids, and identify previously described cell stress3,10,23,24 as a uni- two as yet unpublished ones (Supplementary Table 1), accounting for
versal factor distinguishing metabolic states of in vitro neurons from 1.77 million cells after consistent preprocessing and quality control
primary neurons without strongly affecting core identities of neuronal (Fig. 1a). The HNOCA represents cell types and states generated with
cell types. We map the data of a neural organoid morphogen screen44 26 distinct neural organoid differentiation protocols, including three
to the integrated atlas to assess regional specificity and generation of unguided and 23 guided ones, at time points ranging from 7 to 450 days
new states. We also collect 11 scRNA-seq datasets modelling 10 different (Fig. 1b). To remove batch effects, we implemented a three-step inteneural diseases, and map the integrated data to the neural organoid gration pipeline. First, we projected the HNOCA to a single-cell atlas
atlas for cell type annotation and differential expression (DE) analysis. of the developing human brain27 using reference similarity spectrum
Finally, we show that the atlas can be expanded by projecting new data (RSS)3. Then, we developed snapseed (Methods) to perform prelimito the current atlas. Together, our work provides a rich resource and a nary marker-based hierarchical cell type annotation. Last, we used
new framework to assess the fidelity of neural organoids, characterize scPoli45 for label-aware data integration based on the snapseed annoperturbed and diseased states and streamline protocol development. tations. Evaluation of different integration approaches using a previ-
 ously established benchmarking pipeline46 showed that scPoli had
 the best performance for these datasets (Extended Data Fig. 1). We
Data curation, harmonization and integration performed clustering on the basis of the scPoli representation and
To build a transcriptomic human neural organoid cell atlas (HNOCA), annotated clusters on the basis of canonical marker gene expression,
we collected scRNA-seq data and detailed, harmonized technical and organoid sample age and the auto-generated cell type labels. A uniform


 Nature | Vol 635 | 21 November 2024 | 691

Article
a d hOligoO hStrO
 hMidOrg Organoid datasets
 80 Dorsal telen. [ Unguided ]


 Percentage of
 40


 Percentage of
 telen cells
 Ventral telen.


 MB cells
 27
 Braun et al. 40 Dorsal midbrain
 20
 Ventral midbrain
 0 0
 Cell class hHyThaOrg hCerebOrg hSpO
 Radial glia Hypothalamus 80 hMidOrg


 Percentage of
 hChPO


 Percentage of
 Neuronal IPC 80 Cerebellum
 60


 HB cells
 Thalamus


 dien cells
 Neuroblast hThaOrg
 Region Neuron hSO 40 Pons
 40
 Forebrain Thalamus Glioblast Medulla
 NTT neuronal 20
 Telencephalon Midbrain Oligo
 subtype Cortex Placodes 0 0
 Midbrain dorsal
 Glutamatergic Subcortex Midbrain ventral Immune
 GABAergic Striatum Hindbrain Vascular
 Glycinergic Hippocampus Cerebellum Erythrocyte e Max.-presence f
 Cholinergic Neural crest 1.0
 Diencephalon Pons score
 Serotonergic Hypothalamus Medulla Fibroblast Enriched
 (in ≥1 dataset) 0.2
 1 0
 Brain regions


 Max.-presence score
b


 Im .
 Va .
 G s.
 F- ast

 O st
 o
 C

 .
 yt
 m


 ac
 Region


 lig
 N
 a
 (RG, IPC, N-blast, N)


 Er
 g


 l
 bl


 Pl
 -b
 (NPC, IP, Neuron) 1.0
 0
 Depleted 0.8
 (in all datasets)

 h 0.6
 NTT subtype Under-represented
 (neuron) 0.4
 Other cells from the same region
 0.2
 Thalamus Midbrain Hindbrain
c Primary dev. stages Prop. 0 1 (dMB, vMB) (CB, pons, medulla)
 Pons 0
 First trimester 1 0.995 0.95 0.575 0.627 0.507 0.533 0.553 TRN m1 GABA-N Clusters
 GABA-N
Wang et al.30 Second trimester 0 0.003 0.042 0.41 0.352 0.4 0.428 0.414 GABA-N Neuronal
 Third trimester 0 0.001 0.004 0.014 0.015 0.078 0.032 0.032 dA2 Cell class
 Infant 0 0.001 0.004 0.002 0.005 0.014 0.007 0 ExN Region
 Adolescence 0 0 0 0 0 0.001 0 0 GLUT-TCN dTel. vTel. Th dMB CB Pons
 RG/IPC m1/m2 Purkinje (cortex)
 0 1 2 3 4 5 6 7 10 Hipp HyTh vMB Medulla
 GLUT-N cell
 Organoid age (months)

Fig. 2 | Projection of HNOCA to primary developing human brain cell types. e, UMAP of the human developing brain cell atlas27 coloured by cell
atlases assists organoid neural cell type annotation and estimation of population presence within HNOCA datasets (max presence score). A low score
primary cell type representation. a, UMAP of a human developing brain cell denotes under-representation of cell state in HNOCA datasets. f, Distribution
atlas27, coloured by NTT subtypes (left), region (middle) and annotated cell of max presence scores of different cell classes in the human reference atlas27.
classes (right). b, UMAP of HNOCA, coloured by the mapped neuron NTT Eryt., erythrocyte; Imm., immune; Vas., vascular; G-blast, glioblast; F-blast,
subtypes (left) and regional labels of NPCs, intermediate progenitor cells (IP) fibroblast; NC, neural crest; Plac., placodes; RG, radial glia; IPC, intermediate
and neurons. c, Heatmap showing proportions of cells from organoids of progenitor cell; N-blast, neuroblast; N, neuron. g, Box plots showing distribution
different ages matched to cells from different primary developmental (dev.) of max presence scores in different primary reference cell clusters. Bottom
stages. d, Percentages of neural cells representing different regions side bars show neuronal versus non-neuronal, cell class, region information of
(telencephalon, diencephalon, midbrain and hindbrain) in different datasets. primary reference. h, UMAP of human developing brain atlas showing primary
The x axes show datasets, descendingly ordered by the total proportions (bar neural cell types or states under-represented in HNOCA (in red). Hippo,
height). Datasets based on unguided differentiation protocols are marked by hippocampus; HyTh, hypothalamus; d, dorsal; v, ventral; CB, cerebellum.
dots underneath. The bars at the bottom of each panel show organoid protocol


manifold approximation and projection (UMAP) embedding high- the HNOCA to the same latent space. The shared latent space allowed
lighted three neuronal differentiation trajectories corresponding to us to reconstruct a bipartite weighted k-nearest-neighbour (wkNN)
dorsal telencephalic, ventral telencephalic and non-telencephalic graph between cells in the HNOCA and the primary reference atlas,
populations as well as trajectories leading from progenitors to glial cell which was used to transfer the ‘CellClass’ and ‘Subregion’ labels, as well
types such as astrocytes and oligodendrocytes precursors (Fig. 1c–e and as the neurotransmitter transporter (NTT) information of neuroblasts
Extended Data Fig. 2). Cells from both unguided and guided protocols and neurons to the HNOCA. The transferred labels are strongly conwere distributed across all trajectories (Fig. 1f). sistent with our assigned labels (Extended Data Fig. 3) and allowed us
 To elucidate the dynamics and transitions of cell states and types, we to refine the regional annotation of HNOCA non-telencephalic NPCs
reconstructed a real-age-informed pseudotime of HNOCA cells on the and neurons, as well as the NTT annotation of the non-telencephalic
basis of neural optimal transport47 using moscot48 (Fig. 1h). Focusing neurons (Fig. 2b), resulting in the final hierarchical HNOCA cell type
on the dorsal telencephalic neural trajectory, we observed consistent annotation (Extended Data Fig. 3).
pseudotemporal expression profiles of marker genes such as SOX2 We also sought to compare organoid cells to stages of human brain
(neural progenitor cells (NPCs)), BCL11B (deeper layer cortical neurons) development beyond the first trimester. Focusing on dorsal telenand SATB2 (upper layer cortical neurons) (Fig. 1i). To further resolve cephalon, we compared the transcriptomic profile of HNOCA NPCs
heterogeneity among non-telencephalic neurons, we performed sub- and neurons with cells in a primary atlas of human cortex development
clustering of this population, which revealed numerous neuronal popu- spanning the first trimester to adolescence30. We observed a transition
lations characterized by distinct marker gene expression (Fig. 1j,k). from cell states observed in the first trimester to more mature states
 observed in the second-trimester cortex (Fig. 2c), and did not detect
 substantial matching to later stages. We extended the comparison to
HNOCA projection to a human developing brain atlas other brain regions using two primary atlases27,29 representing the first
To assess our cell type annotation, and more precisely annotate the and second trimester, respectively. We confirmed increased similarheterogeneous non-telencephalic neuronal populations, we com- ity to second-trimester cell states in older organoids for other brain
pared the HNOCA to a recently published single-cell transcriptomic regions (Extended Data Fig. 3).
atlas of the developing human brain27 (Fig. 2a). We applied scVI49 and We evaluated the capacity of each neural organoid protocol to generscANVI50 to the primary reference atlas, and used scArches51 to project ate neural cells of different brain regions (Fig. 2d, Extended Data Figs. 3


692 | Nature | Vol 635 | 21 November 2024

a b c e f
 HNOCA Primary Fraction of protocols (f)


 Common DEGs
 Ubiquitous Inconsistent


 number (×10 )
 2 Axongenesis Regulation of dendrite Protein


 3
 0 0.2 0.4 0.6 0.8 1.0 DEGs across change (59) adj –5 development phosphorylation
 (P = 3.4 × 10 )
 0 1 neuron subtypes adj
 = 4.5 × 10–5)
 (Padj = 1.2 × 10–4)
 (P
 Neuron cell–cell adhesion


 (DE in  f of protocols)
 (n = 920)


 Fraction of DEGs
 N-VGLUT (Padj = 3.4 × 10–5)
 Regulation of neuron Regulation
 Neuron region/NTT separated 0.2 Down- projection dev. (P = 1.5 × 10–4) of cation
 adj
 0 channel
 1 8 16 regulated Synapse organization activity
 1.0 Nervous system development
 Pseudo-bulk Pseudo-bulk 0.4 in organoid adj
 (P = 3.4 × 10 )
 –5 adj –4 adj –3
 (P = 3 × 10 ) (P = 10 )


 (DE in  f of protocols)
 Number of neuron subtypes


 Fraction of DEGs
 (673)
 0.8 d with common DE
 Protocols


 P1 0.6 Mitochondrial ATP Negative regulation of
  DEG 8 synthesis coupled release of sequestered


 Number of pairs
 P2 0.8 0.6
 6
 electron transport
 (Padj = 2.6 × 10–5)
 calcium ion into cytosol
 adj
 (P = 7.4 × 10 )
 –3
 g Primary P = 0.001
 Upregulated
 Regions 0.4


 (×10 )
 1.0 Neutrophil


 3
 4 in organoid Canonical glycolysis Organoid
 degranulation
 Dorsal telen. Dorsal MB (363) (Padj = 3.7 × 10–4) adj
 0.2 2 (P = 8.0 × 10–3)
 Ventral telen. Ventral MB –1 0 1 2 3
 N-GABA 0 Glycolysis scores
 Hypothalamus Cerebellum 0 Electron transport score (s1)
 Thalamus Pons
 1.0 0.8 0.6 0.4 0.2 0
 −1.0 −0.5 0 0.5 1.0
 h Primary
 P = 5.5 × 10 –7
 i s1 s2 s3
 Medulla Correlation between subtype*protocol
 Fraction of protocols (f) (across logFC of ubiquitous DEGs) P = 2.5 × 10–8 Organoid s1 Corr.
 s2 1
 0 1 2 0 0.5
 s3 0
 Canonical
j glycolysis (s2)
 Hallmark glycolysis (s3)
 k
 (dorsal telen. VGLUT-N)


 Guided
Glycolysis score


 1.0 Unguided


 d
 To cortex Telencephalon


 de
 0.5 To others


 ui
 Dorsal


 ng
 Transcriptomic


 U
 0 Matrigel Ventral
 similarity
 No use Diencephalon


 Organoid datasets
 −0.5 Embedded Hypothalamus
 Desolved Thalamus


 Guided
 Primary Organoid datasets Mat. media Midbrain
 No use Spearman correlation Midbrain dorsal
 Guided Used (366 variable TFs) Midbrain ventral
 Matrigel Sliced/cut 0.93 Hindbrain
 Mat. media No Cerebellum
 Sliced/cut Yes Pons
 Medulla Neural
 Shaken/spun Shaken/spun 0.32 cell type
 No Choroid plexus
 Protocol 4 10 16 2419 8 7 6 15 7 5 9 3 12 6 1 9 6 6 11 1 7 13 1 5 14 17 <20 cells in
 Yes Oligodendrocyte Regions
 Publication 2516 8 1 5 22 3 2 18 1110 27 23 2 14 9 4 23 24 2 6 20 3 7 15 13 26 the dataset NTT
 Targeting
 region Glutamatergic GABAergic


Fig. 3 | Transcriptomic comparison between organoid neurons and their electron transport module scores (g), canonical glycolysis module scores
primary counterpart reveals universal cell stress in organoids. a, Schematic (h, left) and the Molecular Signatures Database hallmark glycolysis module
of DE analysis comparing neural cell types in different protocols in HNOCA scores (h, right), in primary neural cell types (upper, dark) and organoid
to their primary counterparts27. b, Proportions of expressed genes in different counterparts (lower, light). P values, significance of a two-sided Wilcoxon test.
neural cell types that show DE in certain fractions of protocols that generate i, Heatmap shows pairwise correlation (corr.) of the three module scores.
the corresponding subtypes. Top left, glutamatergic neurons; bottom j, Hallmark glycolysis score of dorsal telencephalic excitatory neurons (dTelen
right, GABAergic neurons. Colour shows the brain region. c, Numbers of VGLUT-N), split by the three primary developing human brains and 27 organoid
protocol-common DEGs (DE in at least half of protocols), grouped by the datasets with at least 20 dTelen VGLUT-N. The lower panel shows selected
number of neural cell types in which a gene is DE. d, Distribution of expression features of differentiation protocols that may be relevant to cell stress. The
log-fold-change (logFC) correlation of ubiquitous DEGs among different neuron protocol and publication indices are shown in Extended Data Fig. 1. Mat. media,
subtype*protocol (that is, each of the neural cell types generated by each of maturation media. k, Spearman correlations between gene expression profiles
the different protocols). e, Numbers of DEGs per category. f, Gene ontology of neural cell types in HNOCA and those in the human developing brain atlas27,
enrichment analysis of downregulated (upper, blue) and upregulated (lower, across the variable transcription factors (TFs). Datasets are in the same order as
red) ubiquitous DEGs. Sizes of the squares correlate with −log-transformed in Supplementary Table 1.
adjusted P values. g,h, Distribution of the mitochondrial ATP synthesis-coupled


and 4 and Supplementary Table 2). Datasets of unguided neural orga- dorsal midbrain m1-derived GABAergic neurons and m1/m2-derived
noids contain cells across all brain regions with proportions varying glutamatergic neurons, and cerebellar Purkinje cells (Fig. 2f,g). It is
across datasets, indicating the capacity of unguided protocols to gener- worth noting that, even though these cell types are less abundant in
ate many brain regions but with high variability. By contrast, datasets HNOCA datasets than in the primary atlas, certain organoid protocols
derived from guided organoid protocols are strongly enriched for cells can generate some of these under-represented cell types (for example,
of the targeted brain region, but often show an increased proportion Purkinje cells in posterior brain organoid protocols).
of cells of the brain regions neighbouring the targeted regions. For
example, several datasets derived from midbrain organoid protocols
also show high proportions of hindbrain neurons, indicating an impre- Transcriptomic fidelity organoid cell types
cision of morphogen guidance. We next aimed to understand the transcriptomic similarities and dif-
 To comprehensively evaluate how well organoid protocols repre- ferences between organoids generated by distinct differentiation
sented by the HNOCA generate primary brain cell types, we estimated protocols as well as between organoids and primary brain tissue. We
presence scores for every primary cell type in each HNOCA dataset identified differentially expressed genes (DEGs), comparing neural
(Methods). A large presence score indicates high frequency and likeli- cell types in the HNOCA with their primary counterparts27 (Fig. 3a and
hood that cells of a similar type are observed in the HNOCA dataset. By Supplementary Table 4). We found that for most neural cell types,
normalizing the scores per organoid dataset (Extended Data Fig. 5 and more than one-third (mean 34.4%, standard deviation 12.1%) of DEGs
Supplementary Table 3), we obtained a metric to describe how well each were shared across at least half of the protocols (protocol-common
primary cell type is represented in at least one HNOCA dataset (Fig. 2d). DEGs), suggesting that many transcriptomic differences between
This analysis confirmed the absence of erythrocytes, immune cells organoid and primary cells were independent of organoid protocol
and vascular endothelial cells in the HNOCA, all of which are derived (Fig. 3b). We verified our results using an extra primary human cortex
from non-neuroectodermal germ layers (Fig. 2e). As expected, tel- scRNA-seq dataset28 (Extended Data Fig. 6 and Supplementary Table 5).
encephalic cell types are most strongly represented in HNOCA. By We next assessed differential transcriptomic programmes that were
contrast, cell types of the thalamus, midbrain and cerebellum are least shared across regional neural cell types, and identified a total of 920
represented, including thalamic reticular nucleus GABAergic neurons, ubiquitous, protocol-common DEGs (uDEGs) that were differentially


 Nature | Vol 635 | 21 November 2024 | 693

Article
a b c
 Neural organoid Project to primary/HNOCA


 Annotated region
 CHIR, SAG SAG CHIR BMP FGF Other
 morphogen screen Forebrain
 44
 (Amin et al. ) Midbrain


 Fraction
 Hindbrain
 Non-specific
 Un-annotated
 scRNA-seq Annotated Compare with


 yp ub at s


 er Prain
 Th ph us


 M ellu s
 H S Stri pux
 Di ot co um


 la
 M lamon
 ce lamex


 b s


 ed m
 (50 conditions) region organoid atlas


 n
 me


 id u


 ul
 ca rt


 eb o
 en ha rt

 a al
 Condition


 po Co
 Forebrain • Annotation
 Condition groups Midbrain Brain region
 Fraction


 C
 ip
 SAG BMP Hindbrain • Protocol matching Cortex Diencephalon Cerebellum


 H
 CHIR, SAG FGF Non-specific • Novelty assessment of predicted Hippocampus Hypothalamus Pons
 CHIR Other Un-annotated Predicted region Subcortex Thalamus Medulla
 Striatum Midbrain
 0 1

d Cell class e Brain region
 Radial glia
 Neuronal IPC
 Neuroblast
Protocol/condition


 Neuron
 Glioblast
 Oligo
 Placodes
 Immune
 Vascular
 Erythrocyte
 Neural crest
 Fibroblast
 Presence score
 Max.-presence
 esence
 Depleted Enriched sscore (Amin et al.44)
 Non-neural Subregion
Origin Cell class Depleted
 Dep Enriched
 27
 HNOCA Protocol: Guided Unguided Clusters (primary (Braun et al. )) (in all conditions)
 c (in 1 condition)
 Amin et al.44 Condition group

f g h Subpallial Midbrain
 364 GABAergic DA neuron
 neuron LHX6 TH
 in NOMS over HNOCA


 Cluster 364 Cluster 443 Cluster 385 Cluster 448
 Gained coverage


 1.00 ACKR3 EN1


 Primary
 Inhib. neuron Inhib. neuron DA neuron Inhib. neuron MPPED1
 0.75 (LHX6, ACKR3, (LHX8, CA10) (TH1, EN1) (GATA3, CDH8) Co-expression
 MPPED1) (min. gene expression)
 0.50

 0.25 0 Max.
 Conditions Conditions


 44
 Amin et al.
 0
 385
 Telencephalon Diencephalon Midbrain Pons Cereb. Medulla
 Gained clusters
 Clusters (primary (Braun et al.27))

Fig. 4 | Projection of neural organoid morphogen screen scRNA-seq data to The heatmap shows average presence scores per cluster in the primary
HNOCA and human developing brain atlas allows cell type annotation and reference (columns). e, UMAP of primary reference coloured by the dissected
organoid protocol evaluation. a, Schematic of projecting neural organoid regions (right) and the maximum presence scores across the screen conditions
morphogen screen44 scRNA-seq data to the HNOCA, and a human developing (left). f, Gain of cell cluster coverage of screen conditions relative to HNOCA
brain reference atlas27. UMAPs show screen condition groups (left, using datasets, with negative values trimmed to zero. The grey horizontal line shows
morphogens SAG (sonic hedgehog signaling agonist), CHIR, BMP and FGF) the threshold (0.3) to define gained clusters in screen data. g, UMAP of the
and regional annotation of screen data (right). b, Comparison of regional primary reference, with gained clusters highlighted in shades of blue. Dashed
annotation of screen data (rows) and scArches-transferred regional labels from circles highlight two clusters with highest gain of coverage in telencephalon
the primary reference. c, Proportions of cells assigned to different regions on and midbrain, respectively. h, Coexpression scores of cluster marker genes of
the basis of reference projection. Every stacked bar represents one screen the two clusters highlighted in g, in the primary reference (upper) and screen
condition. d, Clustering of HNOCA datasets with conditions in the screen data dataset (lower). DA, dopaminergic.
on the basis of average presence scores of clusters in the primary reference.


expressed in at least 14 out of the 16 neural cell types (Fig. 3c). These cells (Fig. 3g,h). Using the datasets from refs. 3 and 27 as representauDEGs showed consistent fold changes (r > 0.8) across neuron types tive examples, we identified a similar distribution of glycolysis scores
and protocols (Fig. 3d), and represent consistent molecular differences across all neural cell types with an overall increased score in organoid
between neurons in organoids and those in primary tissues regardless cells (Extended Data Fig. 7). Focusing on dorsal telencephalic neurons,
of protocol or neuronal cell type. Out of all 920 uDEGs, 363 genes were we compared the distribution of glycolysis scores across organoid difconsistently upregulated and 673 genes were consistently downregu- ferentiation protocols and identified several protocol features that corlated, with only 59 genes (6%) inconsistently differentially expressed related with metabolic cell stress. For instance, the usage of maturation
across subtypes or protocols (Fig. 3e). media, slicing or cutting of organoids and, to a lesser extent, shaking
 Using gene ontology enrichment analysis52,53 on the uDEGs, we found or spinning of organoids led to overall lower glycolysis scores (Fig. 3h).
downregulated uDEGs enriched in neurodevelopmental processes Mean glycolysis score and transcriptomic similarity of organoid and
including neuron cell–cell adhesion and synapse organization (Fig. 3f). primary reference cell types27 across differentiation protocols were
Upregulated uDEGs were enriched in many metabolism-associated negatively correlated10,24. The correlation was significantly reduced
terms including mitochondrial ATP synthesis-coupled electron trans- when considering only variable transcription factors, indicating that
port (electron transport in short) and canonical glycolysis (Fig. 3f). the metabolic changes in organoids have limited impact on the core
An enrichment of energy-associated pathways has previously been molecular identity of neuronal cell types (Extended Data Fig. 7). This
associated with metabolic changes caused by the limitations of cur- observation is consistent with previous studies23,24 of distinct metabolic
rent culture conditions10,24. Also, the Molecular Signatures Database states of cells in neural organoids relative to the primary tissue, which
gene set hallmark glycolysis54,55 has previously been used to define were shown to not affect neuron fate specification and maturation.
metabolic states in neural organoids23. Scoring mitochondrial elec- Next, we focused on the expression of 366 variable transcription
tron transport, canonical glycolysis and hallmark glycolysis gene sets factors to calculate the correlation between corresponding neuronal
across the HNOCA and the primary reference atlas27, we found that all cell types in the HNOCA datasets and the primary reference atlas27.
three terms showed significant separation of organoid and primary We found that both guided and unguided organoid differentiation


694 | Nature | Vol 635 | 21 November 2024

a UMAP manifold b c Region
 409,000 cells Astrocyte Ventral
 Cell type and regional Dorsal telencephalon
 OPC telen. Dorsal telen.
 annotation Ventral telencephalon
 NPC glutamatergic
 Matched HNOCA Hypothalamus
 metacell neuron Thalamus
 Primary
 11 publications 27
 (Braun et al. ) Differential Glioblast Dorsal midbrain
 10 diseases HNOCA expression Ventral midbrain
 Dorsal Cerebellum
 Microglia telen. Pons
 Mapping NPC Medulla
 g Ventral telen.
 NE NPC IP Neuron Glioblast Astrocyte OPC CP GABAergic
 1.0 Microglia
 MC neuron d e Control
 Disease
 Cell type prop.


 0.8 NC-D
 0.6 EC Neuro-
 MC epithelium Non-telen.
 0.4 Non-telen. neuron
 0.2 NPC
 Control
 0 Status Disease-modelling
 h 1.0
 publication Publications Status
 NH-2022 SZ-2022
Region prop.


 0.8
 f
 of neurons


 GBM-2019 PTHS-2022
 SOX2 MAP2 GFAP OLIG1 EMX1
 0.6 FXS-2021 ALS-2021


 Expression
 0.4 NH-2019 AD-2023 Max.
 ASD-2023 MC-2020
 0.2
 DM1-2022
 0
 Telencephalon Diencephalon Midbrain Hindbrain 0
 Dorsal Hypothalamus Dorsal Cerebellum
 Ventral Thalamus Ventral Pons
 Medulla SFARI enrichment
 (log2(OR))
 i j k l Pseudobulk samples m −1 0 1
 Control Disease-
 modelling Expr P = 0.004
 Transcriptomic similarity


 Publications Max. P = 0.996
 Query
 to HNOCA metacells


 1.0 XRCC6 FMR1 MEIS2
 Celli 0.94
 Comparison ACTB RBM27 SFARI


 Top DEGs
 0.8 No
 Min.
 10 Yes


 −log10(Adjusted P)
 CHD2
 0.6 GNAS
 kNNs Wi RBM25 GTF2I
 Average CALD1
 FABP5 KMT2A
 0.4 HNRNPU PABPC1 DYNC1H1 DE
 Metacelli 5 KMT2E Non-DE
 0.2 SPARC Up
 0 Down
 0
 Reference 0
 GBM FXS GBM Matched Control HNOCA −1.0 −0.5 0 0.5 1.0
 HNOCA astrocytes astrocytes
 metacells in diseases logFC(FXS − HNOCA)

Fig. 5 | The HNOCA as a control cohort to facilitate cell type annotation and publication. Left, distribution in control cells and right, distribution in disease
transcriptomic comparison for neural organoid disease-modelling data. cells. l, Heatmap showing expression of top DEGs between the AQP4+ population
a, Overview of disease-modelling neural organoid atlas construction, and in the GBM-2019 dataset and their matched HNOCA metacells. Rows show
projection to primary atlas27 and HNOCA for downstream analysis. b–f, UMAP DEGs with the ten strongest decreased and increased expressions. Columns
of integrated disease-modelling neural organoid atlas coloured by predicted show average expression in the AQP4+ population of disease-modelling samples
cell type annotation (b), predicted regional identities of NPCs, intermediate (first panel), the matched HNOCA metacells per sample (second panel), all
progenitor cells and neurons (c), publications (d), disease status (e) and marker predicted control astrocytes and all astrocytes in HNOCA. m, Volcano plot
gene expression (f). g,h, Proportions (prop.) of cells assigned to different cell shows DE analysis between dorsal telencephalic cells in the FXS-2021 dataset
classes (g) and regions (h). Every stacked bar represents one biological sample. and their matched HNOCA metacells. DEGs coloured in red (increased in
Side bars show disease status and publication. i, Schematic of reconstructing FXS) and blue (decreased in FXS). Encircled dots show DEGs annotated in
matched HNOCA metacell for each cell in the disease-modelling neural SFARI database. Top bars show the log-transformed odds ratio of SFARI gene
organoid atlas. j, UMAP of disease-modelling neural organoid atlas, coloured enrichment in the increased (red) and decreased (blue) DEGs. GBM,
by transcriptomic similarity with the matched HNOCA metacells. k, Violin plot glioblastoma.
indicates distribution of estimated transcriptomic similarities, split by


protocols generated neuronal cell types with comparable similarity to are deficient in these processes. Of note, these differences are observed
the corresponding primary reference cell types. However, we observed across organoid protocols, and highlight areas of consistent transcripbrain region-dependent differences in transcriptomic similarity. For tomic divergence between in vitro and primary counterparts.
example, organoid neurons from the dorsal parts of most brain regions
showed higher similarity to their primary counterparts across organoid
datasets than cell types derived from the ventral parts of most brain HNOCA facilitates organoid protocol evaluation
regions (Fig. 3i). The HNOCA, as well as the analytical pipeline we established, provides
 To identify molecular features other than metabolic state that a framework to query new neural organoid scRNA-seq datasets not
decreased organoid fidelity, we incorporated dorsal telencephalic gluta- included in the HNOCA. To showcase this application, we retrieved
matergic neurons from four different primary developing human brain scRNA-seq data from a recently published multiplexed neural organoid
atlases27–30 as an integrated primary reference, and identified neuron morphogen screen44 and projected them to the HNOCA and primary refsubtype and maturation state heterogeneity (Extended Data Fig. 8). erence27 latent spaces (Fig. 4a, Extended Data Fig. 9 and Supplementary
Projection of dorsal telencephalic neurons in the HNOCA to the pri- Table 7). We transferred regional labels and found high consistency with
mary atlases revealed the corresponding heterogeneity in neural orga- the provided regional annotation, but with higher resolution within
noids. Considering metabolic state, maturation state and cell subtype each of the broad brain sections of forebrain, midbrain and hindbrain
as covariates during DE analysis3 significantly reduced the number of (Fig. 4b). Our transferred annotation therefore allowed a more compre-
DEGs, supporting the idea that these are the major factors differentiating hensive assessment of the effects of different morphogen conditions
organoid and primary brain cells (Extended Data Fig. 8 and Supplemen- on generating neurons of different brain regions (Fig. 4c). We further
tary Table 6). We observed enriched biological processes that included calculated presence scores for reference cells in each screen condition
synaptic vesicle cycle and negative regulation of high voltage-gated cal- and compared the data of the different screen conditions with the 36
cium channel activity (Extended Data Fig. 8), suggesting that organoids HNOCA datasets. Using hierarchical clustering on average presence


 Nature | Vol 635 | 21 November 2024 | 695

Article
a b 72 73
 Bertucci et al. Caporale et al. Dony et al.
 75 c
 Predicted cell type
 HNOCA
 core PSC NPC
 NE Dorsal telen.
 Community NC-D Ventral telen.
 MC Non-telen.
 edition EC
 Giandomenico Lopez-Tobon Wang et al.71 Neuron
 et al.
 70
 et al.
 74 CP Dorsal telen.
 Glioblast Ventral telen.
 Astrocyte Non-telen.
 OPC
 HNOCA core
 Extension


d e Transcriptomic similarity
 f
 Scaled Percentage
 expression expressed 20 40 60 80100 to HNOCA core metacells HNOCA Browsing Cell type
 0 1 0.4 0.8
 core data transfer
 Neuroepithelium Neuroepithelium
 Dorsal telen. NPC Dorsal telen. NPC Community
 Dorsal telen. IP Dorsal telen. IP edition DE General label Matched DE
Dorsal telen. neuron Dorsal telen. neuron analysis transfer analysis
 Ventral telen. NPC Ventral telen. NPC
Ventral telen. neuron Ventral telen. neuron
 Non-telen. NPC Primary
 Non-telen. NPC Non-telen. neuron reference Reference Presence
 Non-telen. neuron CP mapping scores
 CP Glioblast
 Glioblast OPC
 Astrocyte Astrocyte Query Marker-based Cell Transcriptomic
 OPC NC derivatives dataset annotation matching similarity
 NC derivatives MC
 MC Interface
 i le y o n g
 Percentage of cc ra on nic bo an CELLxGENE
 cells rtu apo D me -To W Web Python HNOCA tools
 Be
 SOX2
 NES
 MAPT
 TTR
 HOPX
 AQP4
 OLIG1
 SOX10
 DCN
 FOXG1
 EMX1
 EOMES
 SLC17A7
 DLX2
 GAD1
 LHX5


 C d o ez interface ArchMap API
 20 40 60 an Lop
 Gi


Fig. 6 | Extending the HNOCA by means of projection of extra datasets. a, selected cell type and regional markers across projected cell types in the
Schematic of projecting further scRNA-seq data by the community to extend extended HNOCA datasets. e, Dot plot shows cell type composition and
the HNOCA. b, UMAP shows the dataset composition of the current extended average similarity to the matched HNOCA metacells of the extended datasets.
HNOCA. c, UMAP shows the projected cell type annotation of cells in the five f, Schematic shows the analytical pipelines and varied interfaces to facilitate
extended datasets. NE, neuroepithelium; NC-D, neural crest derivatives; analysing scRNA-seq data of neural organoids for the community.
MC, mesenchymal cell; EC, endothelial cell. d, Dot plot shows the expression of


scores revealed distinct presence score profiles for many screen condi- We developed a wkNN-based strategy to generate matched HNOCA
tions (Fig. 4d), suggesting regional cell type composition distinct from metacells for every cell in each disease model organoid scRNA-seq
the HNOCA datasets. Next, we summarized the max presence scores dataset (Fig. 5i), and quantified their transcriptomic similarity (Fig. 5j).
for the whole morphogen screen data (Fig. 4e), and compared them The dataset of glioblastoma organoids64 showed substantially lower
to those for the HNOCA data to identify primary reference cell types similarity to their primary counterpart than the other disease models
with increased presence in the screen (Fig. 4f). This analysis highlighted (Fig. 5k). To assess these transcriptomic differences, we performed
several reference cell clusters with significant abundance increase DE analysis between glioblastoma and matched control metacells.
under certain screen conditions (Fig. 4g) such as LHX6/ACKR3/MPPED1 Focusing on the AQP4+ population (Extended Data Fig. 10), we identitriple-positive GABAergic neurons in the ventral telencephalon and fied 1,951 DEGs in glioblastoma cells compared to matched HNOCA
dopaminergic neurons in ventral midbrain. In summary, the projection metacells (Supplementary Table 9) and found increased expression of
of the morphogen screen query data to HNOCA and primary reference genes such as RBM25 (ref. 65) CALD1 (ref. 66), HNRNPU67 and SPARC68
allowed a refined annotation of the morphogen screen data, as well (Fig. 5l), all of which have been reported to be relevant to glioblastoma.
as a comprehensive and quantitative evaluation of the value of new Next, we focused on the organoid model of FXS58, in which NPCs
differentiation protocols to generate neuronal cell types previously and neurons in the control organoids were of non-telencephalic
under-represented or lacking in neural organoids. identities whereas the disease model organoids mainly contained
 telencephalic cells (Fig. 5h and Extended Data Fig. 10). The integrated
 HNOCA provides the opportunity to perform DE analysis for FXS neo-
HNOCA facilitates disease model interpretation cortical neurons with matched HNOCA metacells, which identified 444
We next tested whether the integrated HNOCA can serve as a control DEGs. DEGs higher expressed in FXS cells (122 genes) were enriched
cohort for assessing organoid models of neural disease. We collected for autism-associated genes annotated in the Simons Foundation
11 scRNA-seq datasets from 10 neural organoid disease models and Autism Research Initiative (SFARI) database. One such gene, CHD2,
their respective controls (microcephaly56, amyotrophic lateral scle- was reported in the original publication58 as a key regulator of FXS
rosis43, Alzheimer’s disease57, autism42, fragile-X syndrome (FXS)58, with increased protein level, but its expression change on messenger
schizophrenia59, neuronal heterotopia60,61, Pitt–Hopkins syndrome62, RNA (mRNA) level change could not be detected in a bulk RNA-seq
myotonic dystrophy63 and glioblastoma64) (Fig. 5a, Extended Data Fig. 10 experiment. We also detected decreased expression of FMR1, whose
and Supplementary Table 8). We projected the data to the HNOCA and loss-of-function mutation causes FXS69.
the primary reference atlas to transfer annotations (Fig. 5b–f). We
found differences in cell type and brain regional composition between
disease model organoids and their respective, study-specific control Extending the HNOCA through data projection
organoids for most studies (Fig. 5g,h). These differences might repre- New scRNA-seq datasets of human neural organoids continue to be
sent disease phenotypes, but could also be the consequence of cell line generated, and it will be important to continuously extend and update
variability. It is therefore important to properly annotate the cell type the HNOCA with this extra data. We therefore established a computaand regional composition of disease and control organoids to identify tional toolkit to project new scRNA-seq data to the HNOCA (Fig. 6a).
disease phenotypes, particularly when analysing disease-associated We demonstrate the use of the toolkit by incorporating scRNA-seq data
transcriptomic alterations in a given cell type. from six more studies70–75 into the HNOCA (HNOCA-extended; Fig. 6b


696 | Nature | Vol 635 | 21 November 2024

and Supplementary Table 10), using query-to-reference mapping. We annotation and provides a large control cohort of single-cell transcripharmonized cell type annotations using wkNN-based label transfer, tomes for comparison. For example, we observed discrepancy of cell
and placed the cells in the context of the existing organoid single-cell type and regional composition between control and disease model
transcriptomic landscape as represented by the HNOCA (Fig. 6c–e). samples in many studies. At the same time, the HNOCA provides the
Mapping further datasets to the HNOCA using our approach enhances opportunity to identify disease-specific molecular features against a
the atlas by increasing its coverage over existing neural organoid pro- multi-line multi-protocol large-scale control cohort.
tocols and neural cell types generated in organoids. We demonstrate how the HNOCA can be extended and updated by
 To enable researchers to use the HNOCA in their own analysis, we projecting extra single-cell transcriptomic data of neural organoids
provide various options for exploration and interaction with the atlas to the atlas. Further, we have developed a computational toolkit,
(Fig. 6f). The HNOCA can be browsed through an online portal76, ena- HNOCA-tools, which will enable other researchers to recapitulate the
bling visualization of gene expression and discovery of marker genes. analytic framework applied in our study. Together, we imagine that the
We also provide the HNOCA through an online interface (http://www. HNOCA will be kept up to date and continue to reflect the landscape
archmap.bio/) for the interactive mapping of new datasets, enabling of human neural cell states generated in organoids in vitro, serving as
label transfer, presence score computation and metabolic scoring of a living resource for the neural organoid community that enables the
cell states. Finally, we have developed HNOCA-tools, a Python pack- assessment of organoid fidelity, the characterization of perturbed and
age implementing all central analysis approaches presented in this diseased states and the development of new protocols.
paper, such as annotation, reference mapping, label transfer and DE
testing methods.
 Online content
 Any methods, additional references, Nature Portfolio reporting summa-
Discussion ries, source data, extended data, supplementary information, acknowl-
In this study, we built a large-scale integrated cell atlas of human neural edgements, peer review information; details of author contributions
organoids, the HNOCA, by integrating 1.8 million cells spanning 36 and competing interests; and statements of data and code availability
scRNA-seq datasets generated by 15 different laboratories worldwide are available at https://doi.org/10.1038/s41586-024-08172-8.
using 26 different differentiation protocols as well as diverse scRNAseq technologies. The resulting atlas revealed the high complexity 1. Birey, F. et al. Assembly of functionally integrated human forebrain spheroids. Nature
of neuronal, glial and non-neural cell types that can develop in neu- 545, 54–59 (2017).
ral organoids grown under existing protocol conditions. Mapping 2. Sloan, S. A. et al. Human astrocyte maturation captured in 3D cerebral cortical spheroids
 derived from pluripotent stem cells. Neuron 95, 779–790.e6 (2017).
the HNOCA data to various human developing brain cell reference 3. Kanton, S. et al. Organoid single-cell genomic atlas uncovers human-specific features of
atlases27–30 allowed comprehensive evaluation of neural organoid pro- brain development. Nature 574, 418–422 (2019).
 4. Marton, R. M. et al. Differentiation and maturation of oligodendrocytes in human threetocols to generate cell types of different brain regions. We found that
 dimensional neural cultures. Nat. Neurosci. 22, 484–491 (2019).
organoids in the first 3 months of culture best match to first-trimester 5. Trujillo, C. A. et al. Complex oscillatory waves emerging from cortical organoids model
primary data, whereas organoids around 3 months of culture and older early human brain network development. Cell Stem Cell 25, 558–569.e7 (2019).
 6. Velasco, S. et al. Individual brain organoids reproducibly form cell diversity of the human
best match second-trimester primary cell states. We did not observe
 cerebral cortex. Nature 570, 523–527 (2019).
significant neuronal maturation and diversification signatures match- 7. Xiang, Y. et al. hESC-derived thalamic organoids form reciprocal projections when fused
ing older developmental stages, suggesting a limitation of neuronal with cortical organoids. Cell Stem Cell 24, 487–497.e7 (2019).
 8. Yoon, S.-J. et al. Reliability of human cortical organoid generation. Nat. Methods 16, 75–78
maturation in current neural organoid protocols.
 (2019).
 We performed DE analysis between organoid neuron types and their 9. Andersen, J. et al. Generation of functional human 3D cortico-motor assembloids. Cell
primary counterparts to evaluate transcriptomic fidelity, and identi- 183, 1913–1929.e26 (2020).
 10. Bhaduri, A. et al. Cell stress in cortical organoids impairs molecular subtype specification.
fied metabolic changes related to the glycolysis pathway as a main
 Nature 578, 142–148 (2020).
factor that distinguishes organoid and primary cell states, consistent 11. Miura, Y. et al. Generation of human striatal organoids and cortico-striatal assembloids
with previous reports. Despite the negative effects of metabolic stress from human pluripotent stem cells. Nat. Biotechnol. 38, 1421–1430 (2020).
 12. Pellegrini, L. et al. Human CNS barrier-forming organoids with cerebrospinal fluid
on overall transcriptomic fidelity, the molecular identity of regional
 production. Science 369, eaaz5626 (2020).
cell types is maintained as evidenced by transcription factor coexpres- 13. Qian, X. et al. Sliced human cortical organoids for modeling distinct cortical layer
sion patterns that are highly consistent with primary counterparts. formation. Cell Stem Cell 26, 766–781.e9 (2020).
 14. Sawada, T. et al. Developmental excitation-inhibition imbalance underlying psychoses
 We showcased the mapping of query data, a recently published revealed by single-cell analyses of discordant twins-derived cerebral organoids. Mol.
single-cell transcriptomic neural organoid morphogen screen, to the Psychiatry 25, 2695–2711 (2020).
HNOCA and the primary reference, which enabled a refined cell type 15. Khan, T. A. et al. Neuronal defects in a human cellular model of 22q11.2 deletion syndrome.
 Nat. Med. 26, 1888–1898 (2020).
annotation, as well as a compositional comparison with existing neural 16. Bowles, K. R. et al. ELAVL4, splicing, and glutamatergic dysfunction precede neuron loss
organoid datasets. Our powerful framework will facilitate quantitative in MAPT mutation cerebral organoids. Cell 184, 4547–4563.e17 (2021).
and comparative analysis of scRNA-seq data of human neural organoids, 17. Fiorenzano, A. et al. Single-cell transcriptomics captures features of human midbrain
 development and dopamine neuron diversity in brain organoids. Nat. Commun. 12, 7302
and for the benchmarking of new neural organoid protocols. (2021).
 Consistent with earlier reports3,77, we find that unguided protocols 18. Huang, W.-K. et al. Generation of hypothalamic arcuate organoids from human induced
generate neural cells with high brain regional variability, which is useful pluripotent stem cells. Cell Stem Cell 28, 1657–1670.e10 (2021).
 19. Samarasinghe, R. A. et al. Identification of neural oscillations and epileptiform changes in
when studying broader fate determination during neurodevelopment. human brain organoids. Nat. Neurosci. 24, 1488–1500 (2021).
Guided protocols resulted in a strong enrichment of the targeted 20. Fleck, J. S. et al. Inferring and perturbing cell fate regulomes in human brain organoids.
brain regions. We also note that some guided protocols, particularly Nature https://doi.org/10.1038/s41586-022-05279-8 (2022).
 21. He, Z. et al. Lineage recording in human cerebral organoids. Nat. Methods 19, 90–99 (2022).
those targeting midbrain, show relatively low specificity and generate 22. Kelava, I., Chiaradia, I., Pellegrini, L., Kalinka, A. T. & Lancaster, M. A. Androgens increase
neural cells from the nearby brain regions. This issue may be due to a excitatory neurogenic potential in human brain organoids. Nature 602, 112–116 (2022).
differential response of neural stem cells in the organoid to the same 23. Uzquiano, A. et al. Proper acquisition of cell class identity in organoids allows definition of
 fate specification programs of the human cerebral cortex. Cell 185, 3770–3788.e27 (2022).
morphogen cue, or to the lack of a full understanding of the timing, 24. Vértesy, Á. et al. Gruffi: an algorithm for computational removal of stressed cells from
concentration and combinations of morphogens required to precisely brain organoid transcriptomic datasets. EMBO J. 41, e111118 (2022).
define cells of the deeper regions in the central nervous system. 25. Atamian, A. et al. Human cerebellar organoids with functional Purkinje cells. Cell Stem
 Cell 31, 39–51.e6 (2024).
 The integrated HNOCA is also an excellent resource for analysis 26. Paulsen, B. et al. Autism genes converge on asynchronous development of shared
of disease-modelling neural organoid data. It facilitates cell type neuron classes. Nature 602, 268–273 (2022).


 Nature | Vol 635 | 21 November 2024 | 697

Article
27. Braun, E. et al. Comprehensive cell atlas of the first-trimester developing human brain. 61. Klaus, J. et al. Altered neuronal migratory trajectories in human cerebral organoids
 Science 382, eadf1226 (2023). derived from individuals with neuronal heterotopia. Nat. Med. 25, 561–568 (2019).
28. Eze, U. C., Bhaduri, A., Haeussler, M., Nowakowski, T. J. & Kriegstein, A. R. Single-cell atlas 62. Papes, F. et al. Transcription Factor 4 loss-of-function is associated with deficits in
 of early human brain development highlights heterogeneity of human neuroepithelial progenitor proliferation and cortical neuron content. Nat. Commun. 13, 2387
 cells and early radial glia. Nat. Neurosci. 24, 584–594 (2021). (2022).
29. Bhaduri, A. et al. An atlas of cortical arealization identifies dynamic molecular signatures. 63. Morelli, K. H. et al. MECP2-related pathways are dysregulated in a cortical organoid
 Nature 598, 200–204 (2021). model of myotonic dystrophy. Sci. Transl. Med. 14, eabn2375 (2022).
30. Wang, L. et al. Molecular and cellular dynamics of the developing human neocortex at 64. Jacob, F. et al. A patient-derived glioblastoma organoid model and biobank recapitulates
 single-cell resolution. Preprint at bioRxiv https://doi.org/10.1101/2024.01.16.575956 (2024). inter- and intra-tumoral heterogeneity. Cell 180, 188–204.e22 (2020).
31. Velasco, S., Paulsen, B. & Arlotta, P. 3D Brain organoids: studying brain development and 65. Brennan, C. W. et al. The somatic genomic landscape of glioblastoma. Cell 155, 462–477
 disease outside the embryo. Annu. Rev. Neurosci. 43, 375–389 (2020). (2013).
32. Sidhaye, J. & Knoblich, J. A. Brain organoids: an ensemble of bioassays to investigate 66. Cheng, Q. et al. CALD1 modulates gliomas progression via facilitating tumor angiogenesis.
 human neurodevelopment and disease. Cell Death Differ. 28, 52–67 (2020). Cancers 13, 2705 (2021).
33. Pașca, S. P. et al. A nomenclature consensus for nervous system organoids and 67. Pavlyukov, M. S. et al. Apoptotic cell-derived extracellular vesicles promote malignancy
 assembloids. Nature 609, 907–910 (2022). of glioblastoma via intercellular transfer of splicing factors. Cancer Cell 34, 119–135.e10
34. Paşca, A. M. et al. Functional cortical neurons and astrocytes from human pluripotent (2018).
 stem cells in 3D culture. Nat. Methods 12, 671–678 (2015). 68. Rich, J. N. et al. Gene expression profiling and genetic markers in glioblastoma survival.
35. Jo, J. et al. Midbrain-like organoids from human pluripotent stem cells contain functional Cancer Res. 65, 4051–4058 (2005).
 dopaminergic and neuromelanin-producing neurons. Cell Stem Cell 19, 248–257 (2016). 69. Mila, M., Alvarez-Mora, M. I., Madrigal, I. & Rodriguez-Revenga, L. Fragile X syndrome: an
36. Lancaster, M. A. et al. Cerebral organoids model human brain development and overview and update of the FMR1 gene. Clin. Genet. 93, 197–205 (2018).
 microcephaly. Nature 501, 373–379 (2013). 70. Giandomenico, S. L. et al. Cerebral organoids at the air-liquid interface generate diverse
37. Quadrato, G. et al. Cell diversity and network dynamics in photosensitive human brain nerve tracts with functional output. Nat. Neurosci. 22, 669–679 (2019).
 organoids. Nature 545, 48–53 (2017). 71. Wang, M. et al. Morphological diversification and functional maturation of human
38. Pollen, A. A. et al. Establishing cerebral organoids as models of human-specific brain astrocytes in glia-enriched cortical organoid transplanted in mouse brain. Nat. Biotechnol.
 evolution. Cell 176, 743–756.e17 (2019). https://doi.org/10.1038/s41587-024-02157-8 (2024).
39. Camp, J. G. et al. Human cerebral organoids recapitulate gene expression programs of 72. Bertucci, T. et al. Improved protocol for reproducible human cortical organoids reveals
 fetal neocortex development. Proc. Natl Acad. Sci. USA 112, 15672–15677 (2015). early alterations in metabolism with mutations. Preprint at bioRxiv https://doi.org/10.1101/
40. Mora-Bermúdez, F. et al. Differences and similarities between human and chimpanzee 2023.07.11.548571 (2023).
 neural progenitors during cerebral cortex development. eLife 5, e18683 (2016). 73. Caporale, N. et al. Multiplexing cortical brain organoids for the longitudinal dissection of
41. Benito-Kwiecinski, S. et al. An early cell shape transition drives evolutionary expansion of developmental traits at single cell resolution. Preprint at bioRxiv https://doi.org/10.1101/
 the human forebrain. Cell 184, 2084–2102.e19 (2021). 2023.08.21.553507 (2023).
42. Li, C. et al. Single-cell brain organoid screening identifies developmental defects in 74. López-Tobón, A. et al. dosage regulates neuronal differentiation and social behavior in
 autism. Nature 621, 373–380 (2023). 7q11.23 neurodevelopmental disorders. Sci. Adv. 9, eadh2726 (2023).
43. Szebényi, K. et al. Human ALS/FTD brain organoid slice cultures display distinct early 75. Dony, L. et al. Chronic exposure to glucocorticoids amplifies inhibitory neuron cell fate
 astrocyte and targetable neuronal pathology. Nat. Neurosci. 24, 1542–1554 (2021). during human neurodevelopment in organoids. Preprint at bioRxiv https://doi.org/10.1101/
44. Amin, N. D. et al. Generating human neural diversity with a multiplexed morphogen 2024.01.21.576532 (2024).
 screen in organoids. Preprint at bioRxiv https://doi.org/10.1101/2023.05.31.541819 (2023). 76. CZI Single-Cell Biology Program et al. CZ CELL×GENE Discover: a single-cell data
45. De Donno, C. et al. Population-level integration of single-cell datasets enables multi-scale platform for scalable exploration, analysis and modeling of aggregated data. Preprint at
 analysis across samples. Nat. Methods 20, 1683–1692 (2023). bioRxiv https://doi.org/10.1101/2023.10.30.563174 (2023).
46. Luecken, M. D. et al. Benchmarking atlas-level data integration in single-cell genomics. 77. Qian, X., Song, H. & Ming, G.-L. Brain organoids: advances, applications and challenges.
 Nat. Methods 19, 41–50 (2022). Development 146, dev166074 (2019).
47. Eyring, L. et al. Unbalancedness in neural monge maps improves unpaired domain
 translation. In Proc. Twelfth International Conference on Learning Representations Publisher’s note Springer Nature remains neutral with regard to jurisdictional claims in
 https://iclr.cc/virtual/2024/poster/19548 (2024). published maps and institutional affiliations.
48. Klein, D. et al. Mapping cells through time and space with moscot. Preprint at bioRxiv
 https://doi.org/10.1101/2023.05.11.540374 (2023). Open Access This article is licensed under a Creative Commons Attribution-
49. Lopez, R., Regier, J., Cole, M. B., Jordan, M. I. & Yosef, N. Deep generative modeling for NonCommercial-NoDerivatives 4.0 International License, which permits any
 single-cell transcriptomics. Nat. Methods 15, 1053–1058 (2018). non-commercial use, sharing, distribution and reproduction in any medium or
50. Xu, C. et al. Probabilistic harmonization and annotation of single-cell transcriptomics format, as long as you give appropriate credit to the original author(s) and the source, provide
 data with deep generative models. Mol. Syst. Biol. 17, e9620 (2021). a link to the Creative Commons licence, and indicate if you modified the licensed material.
51. Lotfollahi, M. et al. Mapping single-cell data to reference atlases by transfer learning. You do not have permission under this licence to share adapted material derived from this
 Nat. Biotechnol. 40, 121–130 (2022). article or parts of it. The images or other third party material in this article are included in the
52. Ashburner, M. et al. Gene Ontology: tool for the unification of biology. Nat. Genet. 25, article’s Creative Commons licence, unless indicated otherwise in a credit line to the material.
 25–29 (2000). If material is not included in the article’s Creative Commons licence and your intended use is
53. Aleksander, S. A. et al. The Gene Ontology knowledgebase in 2023. Genetics 224, not permitted by statutory regulation or exceeds the permitted use, you will need to obtain
 iyad031 (2023). permission directly from the copyright holder. To view a copy of this licence, visit http://
54. Subramanian, A. et al. Gene set enrichment analysis: a knowledge-based approach creativecommons.org/licenses/by-nc-nd/4.0/.
 for interpreting genome-wide expression profiles. Proc. Natl Acad. Sci. USA 102,
 15545–15550 (2005). © The Author(s) 2024, corrected publication 2024
55. Liberzon, A. et al. The Molecular Signatures Database (MSigDB) hallmark gene set
 collection. Cell Syst. 1, 417–425 (2015). Human Cell Atlas Organoid Biological Network
56. Wang, L. et al. Loss of NARS1 impairs progenitor proliferation in cortical brain organoids
 and leads to microcephaly. Nat. Commun. 11, 4038 (2020).
57. Vanova, T. et al. Cerebral organoids derived from patients with Alzheimer’s disease with Neal D. Amin10,11, Kevin W. Kelley10,11, Taylor Bertucci13, Sally Temple13, Kathryn R. Bowles14,15,
 PSEN1/2 mutations have defective tissue patterning and altered development. Cell Rep. Nicolò Caporale16,17, Emanuele Villa16, Giuseppe Testa16,17, Cristiana Cruceanu3,18 &
 42, 113310 (2023). Elisabeth B. Binder3
58. Kang, Y. et al. A human forebrain organoid model of fragile X syndrome exhibits altered
 neurogenesis and highlights new treatment strategies. Nat. Neurosci. 24, 1377–1391 (2021). 13
 Neural Stem Cell Institute, Albany, NY, USA. 14UK Dementia Research Institute at the
59. Notaras, M. et al. Schizophrenia is defined by cell-specific neuropathology and multiple University of Edinburgh, Edinburgh Bioquarter, Edinburgh, UK. 15Centre for Discovery Brain
 neurodevelopmental mechanisms in patient-derived cerebral organoids. Mol. Psychiatry Sciences, School of Biomedical Sciences, College of Medicine and Veterinary Medicine,
 27, 1416–1434 (2022). The University of Edinburgh, Edinburgh, UK. 16Human Technopole, Milan, Italy. 17Department of
60. Jabali, A. et al. Human cerebral organoids reveal progenitor pathology in EML1-linked Oncology and Hemato-Oncology, University of Milan, Milan, Italy. 18Department of Physiology
 cortical malformation. EMBO Rep. 23, e54027 (2022). and Pharmacology, Karolinska Institutet, Stockholm, Sweden.


698 | Nature | Vol 635 | 21 November 2024

Methods
 Hierarchical auto-annotation with snapseed
Metadata curation and harmonization of human neural Snapseed is a scalable auto-annotation strategy, which annotates cells
organoid scRNA-seq datasets on the basis of a provided hierarchy of cell types and the corresponding
We included 33 human neural organoid data from a total of 25 publica- cell type markers. It is based on enrichment of marker gene exprestions1–24,26 plus three unpublished datasets in our atlas (Supplementary sion in cell clusters (high-resolution clustering is preferred), and data
Table 1). We curated all neural organoid datasets used in this study integration is not necessarily required.
through the sfaira78 framework (GitHub dev branch, 18 April 2023). For In this study, we used snapseed to obtain initial annotations for
this, we obtained scRNA-seq count matrices and associated metadata label-aware integration. First, we constructed a hierarchy of cell types
from the location provided in the data availability section for every including progenitor, neuron and non-neural types, each defined by
included publication or directly from the authors in case of unpub- a set of marker genes (Supplementary Data 1). Next, we represented
lished data. We harmonized metadata according to the sfaira stand- the data by the RSS3 to average expression profiles of cell clusters in
ards (https://sfaira.readthedocs.io/en/latest/adding_datasets.html) the recently published human developing brain cell atlas27. We then
and manually curated an extra metadata column organoid_age_days, constructed a kNN graph (k = 30) in the RSS space and clustered the
which described the number of days the organoid had been in culture dataset using the Leiden algorithm83 (resolution 80). For both steps, we
before collection. used the graphical processing unit (GPU)-accelerated RAPIDS imple-
 We next removed any non-applicable subsets of the published data- mentation that is provided through scanpy81,84.
sets: diseased samples or samples expressing disease-associated muta- For all cell type marker genes on a given level in the hierarchy, we
tions (refs. 14–16,18,19,26), fused organoids (ref. 1), primary fetal data computed the area under the receiver operating characteristic curve
(refs. 10,23), hormone-treated samples (ref. 22), data collected before (AUROC) as well as the detection rate across clusters. For each cell type,
neural induction (refs. 3,20) and share-seq data (ref. 23). We harmonized a score was computed by multiplying the maximum AUROC with the
all remaining datasets to a common feature space using any genes of maximum detection rate among its marker genes. Each cluster was
the biotype ‘protein_coding’ or ‘lncRNA’ from ensembl79 release 104 then assigned to the cell type with the highest score. This procedure
while filling any genes missing in a dataset with zero counts. On aver- was performed recursively for all levels of the hierarchy. The same
age, 50% of the full gene space (36,842 genes) was reported in each of procedure was carried out using the fine (resolution 80) clustering of
the constituent datasets. We then concatenated all remaining datasets the unintegrated data to obtain cell type labels for the unintegrated
to create a single AnnData80 object. dataset that were used downstream as a ground-truth input for bench-
 marking integration methods.
Preprocessing of the HNOCA scRNA-seq data This auto-annotation strategy was implemented in the snapseed
All processing and analyses were carried out using scanpy81 (v.1.9.3) Python package and is available on GitHub (https://github.com/dev­
unless indicated otherwise. For quality control and filtering of HNOCA, systemslab/snapseed). Snapseed is a light-weight package to enable
we removed any cells with fewer than 200 genes expressed. We next scalable marker-based annotation for atlas-level datasets in which
removed outlier cells in terms of two quality control metrics: the manual annotation is not readily feasible. The package implements
number of expressed genes and percentage mitochondrial counts. three main functions: annotate() for non-hierarchical annotation of
To define outlier cells on the basis of each quality control metric, a list of cell types with defined marker genes, annotate_hierarchy()
z-transformation is first applied to values across all cells. Cells with for annotating more complex, manually defined cell type hierarchies
any z-transformed metric less than −1.96 or greater than 1.96 are defined and find_markers() for fast discovery of cluster-specific features. All
as outliers. For any dataset collected using the v.3 chemistry by 10X functions are based on a GPU-accelerated implementation of AUROC
Genomics, which contains more than 500 cells after the filtering, we scores using JAX (https://github.com/google/jax).
fitted a Gaussian distribution to the histogram denoting the number
of expressed genes per cell. If a bimodal distribution was detected, Label-aware data integration with scPoli
we removed any cell with fewer genes expressed than defined by the We performed integration of the organoid datasets for HNOCA using
valley between the two maxima of the distribution. We then normal- the scPoli45 model from the scArches51 package. We defined the batch
ized the raw read counts for all Smart-seq2 data by dividing it by the covariate for integration as a concatenation of the dataset identifier
maximum gene length for each gene obtained from BioMart. We next (annotation column ‘id’), the annotation of biological replicates (annomultiplied these normalized read counts by the median gene length tation column ‘bio_sample’) as well as technical replicates (annotation
across all genes in the datasets and treated those length-normalized column ‘tech_sample’). This resulted in 396 individual batches. The
counts equivalently to raw counts from the datasets obtained with batch covariate is represented in the model as a learned vector of size
the help of unique molecular identifiers in our downstream analyses. five. We used the top three levels of the RSS-based snapseed cell type
 As a next step we generated a log-normalized expression matrix by annotation as the cell type label input for the scPoli prototype loss.
first dividing the counts for each cell by the total counts in that cell and We chose the hidden layer size of the one-layer scPoli encoder and
multiplying by a factor of 1,000,000 before taking the natural loga- decoder as 1,024, and the latent embedding dimension as ten. We used
rithm of each count + 1. We computed 3,000 highly variable features a value of 100 for the ‘alpha_epoch_anneal’ parameter. We did not use
in a batch-aware manner using the scanpy highly_variable_genes func- the unlabelled prototype pretraining. We trained the model for a total
tion (flavor = ‘seurat_v3’, batch_key = ‘bio_sample’). Here, bio_sample of seven epochs, five of which were pretraining epochs.
represents biological samples as provided in the original metadata of
the datasets. On average, 72% of the 3,000 highly variable genes were Benchmark of data integration methods
reported in each of the constituent HNOCA datasets. We used these To quantitatively compare the organoid atlas integration results from
3,000 features to compute a 50-dimensional representation of the several tools, we used the GPU-accelerated scib-metrics46,85 Python
data using principal component analysis (PCA), which in turn we used package (v.0.3.3) and used the embedding with the highest overall
to compute a k-nearest-neighbour (kNN) graph (n_neighbors = 30, performance for all downstream analyses. We compared the data intemetric = ‘cosine’). Using the neighbour graph we computed a gration performance across the following latent representations of the
two-dimensional representation of the data using UMAP82 and a coarse data: unintegrated PCA, RSS3 integration, scVI49 (default parameters
(resolution 1) and fine (resolution 80) clustering of the unintegrated except for using two layers, latent space of size 30 and negative binomial
data using Leiden83 clustering. likelihood) integration, scANVI50 (default parameters) integrations

Article
using snapseed level 1, 2 or 3 annotation as cell type label input, scPoli45
(parameters shown above) integrations using either snapseed level 1, 2 Reference mapping of the organoid atlas to the primary atlas
or 3 annotation or all three annotation levels at once as the cell type label To compare our organoid atlas with data from the primary developing
input, scPoli45 integrations of metacells aggregated with the aggrecell human brain, we used scArches51 to project it to the above mentioned
algorithm (first used as ‘pseudocell’3) using either snapseed level 1 or 3 primary human brain scRNA-seq atlas27. We first pretrained a scVI
annotation as the cell type label input to scPoli. We used the following model49 on the primary atlas with ‘Donor’ as the batch key. The model
scores for determining integration quality (each described in ref. 46): was constructed with following parameters: n_latent = 20, n_layers = 2,
Leiden normalized mutual information score, Leiden adjusted rand n_hidden = 256, use_layer_norm = ‘both’, use_batch_norm = ‘none’,
index, average silhouette width per cell type label, isolated label score encode_covariates = True, dropout_rate = 0.2 and trained with a
(average silhouette width-scored) and cell type local inverse Simpson’s batch size of 1,024 for a maximum or 500 epochs with early stopindex to quantify conservation of biological variability. To quantify ping criterion. Next, the model was fine-tuned with scANVI50 using
batch-effect removal, we used average silhouette width per batch label, ‘Subregion’ and ‘CellClass’ as cell type labels with a batch size of
integration local inverse Simpson’s index, kNN batch-effect test score 1,024 for a maximum of 100 epochs with early stopping criterion
and graph connectivity. Integration approaches were then ranked by and n_samples_per_label = 100. To project the organoids atlas to the
an aggregate total score of individually normalized (into the range of primary atlas, we used the scArches51 implementation provided by
[0,1]) metrics. Before we carried out the benchmarking, we iteratively scvi-tools88,89. The query model was fine-tuned with a batch size of
removed any cells from the dataset that had an identical latent repre- 1,024 for a maximum of 100 epochs with early stopping criterion
sentation to another cell in the dataset until no latent representation and weight_decay = 0.0.
contained any more duplicate rows. This procedure removed a total of
3,293 duplicate cells (0.002% of the whole dataset) and was required Bipartite weighted kNN graph reconstruction
for the benchmarking algorithm to complete without errors. We used With the primary reference27 and query (HNOCA) data projected to the
the snapseed level 3 annotation computed on the unintegrated PCA same latent space, an unweighted bipartite kNN graph was constructed
embedding as ground-truth cell type labels in the integration. by identifying 100 nearest neighbours of each query cell in the reference
 data with either PyNNDescent or RAPIDS-cuML (https://github.com/
Pseudotime inference rapidsai/cuml) in Python, depending on availability of GPU accelera-
To infer a global ordering of differentiation state, we sought to infer a tion. Similarly, a reference kNN graph was also built by identifying 100
real-time-informed pseudotime on the basis of neural optimal trans- nearest neighbours of each reference cell in the reference data. For each
port47 in the scPoli latent space. We first grouped organoid age in days edge in the reference-query bipartite graph, the similarity between
into seven bins ((0, 15], (15, 30], (30,60], (60, 90], (90, 120], (120, 150], the reference neighbours of the two linked cells, defined as A and B,
(150, 450]). Next, we used moscot48 to solve a temporal neural problem. respectively, is represented by the Jaccard index:
To score the marginal distributions on the basis of expected proliferation rates, we obtained proliferation and apoptosis scores for each cell A∩B
 J (A, B) = .
with the method score_genes_for_marginals(). Marginal weights were A∪B
then computed with
 The square of Jaccard index was then assigned as the weight of the
 exp(4 × (prolif_score − apoptosis_score)) edge, to get the bipartite weighted kNN graph between the reference
 and query datasets.
 The optimal transport problem was solved using the following
parameters: iterations = 25,000, compute_wasserstein_baseline = False, wkNN-based primary developing brain atlas label transfer to
batch_size = 1,024, patience = 100, pretrain = True, train_size = 1. To HNOCA cells
compute displacement vectors for each cell in age bin i, we used the Given the wkNN estimated between primary reference27 and query
subproblem corresponding to the [i, i + 1] transport map, except for (HNOCA), any categorical metadata label of reference can be transthe last age bin, where we used the subproblem [i − 1,i]. Displacement ferred to query cells by means of majority voting. In brief, for each
vectors were obtained by subtracting the original cell distribution from category, its support was calculated for each query cell as the sum of
the transported distribution. Using the velocity kernel from CellRank86 weights of edges that link to reference cells in this category. The catwe computed a transition matrix from displacement vectors and used egory with the largest support was assigned to the query cell.
it as an input for computing diffusion maps87. Ranks on negative diffu- To get the final regional labels for the non-telencephalic NPCs and
sion component 1 were used as a pseudotemporal ordering. neurons, as well as the NTT labels for non-telencephalic neurons, con-
 straints were added to the transfer procedure. For regional labels, only
Preprocessing of the human developing brain cell atlas scRNA-seq the non-telencephalic regions, namely diencephalon, hypothalamus,
data thalamus, midbrain, midbrain dorsal, midbrain ventral, hindbrain,
The cell ranger-processed scRNA-seq data for the primary atlas27 were cerebellum, pons and medulla, were considered valid categories to
obtained from the link provided on its GitHub page (https://storage. be transferred. The label-transfer procedure was only applied to the
googleapis.com/linnarsson-lab-human/human_dev_GRCh38-3.0.0.h5ad). non-telencephalic NPCs and neurons in HNOCA. Before any major-
For further quality control, cells with fewer than 300 detected genes ity voting was done, the support scores of each valid category across
were filtered out. Transcript counts were normalized by the total all non-telencephalic NPCs and neurons in HNOCA were smoothed
number of counts for that cell, multiplied by a scaling factor of 10,000 with a random-walk-with-restart procedure (restart probability alpha,
and subsequently natural-log transformed. The feature set was inter- 85%). Next, a hierarchical label transfer, which takes into account the
sected with all genes detected in the organoid atlas and the 2,000 structure hierarchy, was applied. First, the considered regions were
most highly variable genes were selected with the scanpy function grouped into diencephalon, midbrain and hindbrain, with a support
highly_variable_genes using ‘Donor’ as the batch key. An extra column score of each structure as its score summed up with scores of its subof ‘neuron_ntt_label’ was created to represent the automatic classified structures. Majority voting was applied to assign each cell to one of the
neural transmitter transporter subtype labels derived from the ‘Auto­ three structures. Next, a second majority voting was applied to only
Annotation’ column of the cell cluster metadata (https://github.com/ consider the substructures under the assigned structure (for example,
linnarsson-lab/developing-human-brain/files/9755350/table_S2.xlsx). hypothalamus and thalamus for diencephalon).

For NTT labels, we first identified valid region-NTT label pairs in st = αs 0 + (1 − α)PT st −1
the reference on the basis of the provided NTT labels in the reference
neuroblast and neuron clusters and their most common regions. Here, This procedure was performed 100 times to get the smooth presence
the most common regions were re-estimated in a hierarchical manner scores that were subsequently log transformed. Scores lower than the
to the finest resolution mentioned above. Next, when transferring 5th percentile or higher than the 95th percentile were trimmed. The
NTT labels, for each non-telencephalic neuron with the regional label trimmed scores were normalized into the range of [0,1] as the final
transferred, only NTT labels that were considered valid for the region presence scores in the HNOCA dataset.
were considered during majority voting. Given the final presence scores in each of the HNOCA datasets, the
 max presence scores in the whole HNOCA data were then easily cal-
Stage-matching analysis culated as the maximum of all the presence scores for each cell in the
To match telencephalic NPCs and neurons in HNOCA to develop- primary atlas. A large (close to one) max presence score indicates a
mental stages, we used the recently published human neocortical high frequency of appearance for the cell type or state in at least one
development atlas30 as the reference. The processed single nucleus HNOCA dataset whereas a small (close to zero) max presence score
RNA-seq data were obtained from its data portal (https://cell.ucsf.edu/ suggests under-representation in all the HNOCA datasets.
snMultiome/). Given the ‘class’, ‘subclass’ and ‘type’ labels in the provided metadata as annotations, and ‘individual’ as the batch label, Cell type composition comparison among morphogen usage
scPoli was applied for label-aware data integration. Next, data rep- using scCODA
resenting different developmental stages were split. For each stage, To test the cell type compositional changes on admission of certain
Louvain clustering based on the scPoli latent representation (resolu- morphogens from different organoid differentiation protocols, we
tion, 5) was applied. Clusters of all stages were pooled, and highly used the pertpy90 implementation of the scCODA algorithm91. scCODA
variable genes were identified on the basis of coefficient of variations is a Bayesian model for detecting compositional changes in scRNA-seq
as described in this page: https://pklab.med.harvard.edu/scw2014/ data. For this, we have extracted the information about the added morsubpop_tutorial.html. Finally, every one of HNOCA telencephalic phogens from each differentiation protocol and grouped them into
NPCs and neurons were correlated to each cluster across the identi- 15 broad molecule groups on the basis of their role in neural differenfied highly variable genes. The stage label of the best-correlated cluster tiation (Supplementary Table 1). These molecule groups were used
was assigned to the query HNOCA cell. as a covariate in the model. The region labels transferred from the
 To extend the analysis to other neuronal cell types, the second- primary atlas were used as labels in the analysis (cell_type_identifier).
trimester multiple-region human brain atlas29 was also introduced. The For cell types without regional identity, the cell type labels presented
processed count matrices and metadata were obtained from the NeMO in Fig. 1c were used. Pluripotent stem cells and neuroepithelium cells
data portal (https://data.nemoarchive.org/biccn/grant/u01_devhu/ were removed from the analysis because they are mainly present in the
kriegstein/transcriptome/scell/10x_v2/human/processed/counts/). early organoid stages. We used bio_sample as the sample_identifier.
Given the ‘cell_type’ label of the provided metadata as the annotation We ran scCODA sequentially with default parameters, using No-U-turn
and ‘individual’ as the batch label, scPoli was run for label-aware data sampling (run_nuts function) and selecting each cell type once as a
integration. Louvain clustering was applied to the scPoli latent rep- reference. We used a majority vote-based system to find the cell types
resentation to identify clusters (resolution, 20). Similarly, Louvain that were credibly changing in more than half of the iterations.
clustering with a resolution of 20 was also applied to the first-trimester
multiple-region human brain atlas27 on the basis of the scANVI latent Cell type composition comparison among morphogen usage
representation we generated earlier. Average expression profiles using regularized linear regression
were calculated for all the clusters, and highly variable genes were To complement the composition analysis conducted with scCODA, we
identified using the same procedure as above for clusters of the two devised an alternative approach to test for differential composition
primary atlases combined. Next, every NPC and neuron in HNOCA using regularized linear regression. We fit a generalized linear model
was correlated to the average expression profiles of those clusters. with the region composition matrix as the response Y and molecule
The best-correlated first- and second-trimester clusters, as well as usage as independent variables X:
the correlations, were identified. The differences between the two
correlations were used as the metrics to indicate the stage-matching Y ~ Xβ
preferences of NPCs and neurons in HNOCA.
 The model was fit with lasso regularization (alpha = 1) using Gaussian
Presence scores and max presence scores of cells in the primary noise and an identity link function. The regularization parameter lambda
developing brain atlas was automatically determined through cross-validation as implemented
Given a reference dataset and a query dataset, the presence score in the function cv.glmnet() from the glmnet92 R package. All non-zero coefis a score assigned to each cell in the reference, which describes the ficients β were considered as indications of enrichment and depletion.
frequency or likelihood of the cell type or state of that reference cell
appearing in the query data. In this study, we calculated the presence DE analysis between HNOCA neural cell types and their primary
scores of primary atlas cells in each HNOCA dataset to quantify how counterparts and functional enrichment analysis
frequently we saw a cell type or state represented by each primary cell To study the transcriptomic differences between organoid and primary
in each of the HNOCA datasets. cells, we subset HNOCA using the final level 1 annotation to cells labelled
 Specifically, for each HNOCA dataset, we first subset the wkNN graph ‘Neuron’. We furthermore subset the human developing brain atlas to
to only HNOCA cells in that dataset. Next, the raw weighted degree cells that had been assigned a valid label in the neuron_ntt_label annotawas calculated for each cell in the primary atlas, as the sum of weights tion column. We added an extra two datasets of fetal cortical cells from
of the remaining edges linked to the cell. A random-walk-with-restart ref. 39 and ref. 28. For the data from ref. 39, we subset the data to cells
procedure was then applied to smooth the raw scores across the kNN labelled ‘fetal’ and estimated transcripts per million reads for each gene
graph of the primary atlas. In brief, we first represented the primary in each cell using RSEM93 given the STAR94 mapping results. We then
atlas kNN graph as its adjacency matrix (A), followed by row normaliza- computed a PCA, a kNN graph, UMAP and Leiden clustering (resolution to convert it into a transition probability matrix (P). With the raw tion 0.2) using scanpy. We then selected the cluster with the highest
scores represented as a vector s0, in each iteration t, we generated st as STMN2 and NEUROD6 expression as the cortical neuron cluster and

Article
used only those cells. For the data from ref. 28 we subset the datasets average expression of each neural cell type in the primary reference, as
to cells annotated as ‘Neuronal’ in Supplementary Table 5 (‘Cortex well as in each dataset of HNOCA. For each HNOCA dataset, only neural
annotations’) of their publication and computed a PCA, neighbourhood cell types with at least 20 cells were considered. Highly variable genes
graph and UMAP to visualize the dataset. We found that only samples were identified across the neural cell types in the primary reference
from the individuals CS14_3, CS20, CS22 and CS20 contained detectable using a Chi-squared test-based variance ratio test on the generalized
expression of STMN2 and NEUROD6 so we subset the dataset further linear model with Gamma distribution (identity link), given coefficient
to only cells from those individuals. of variance of transcript counts across neural cell types as the response
 To compute DE between HNOCA cells and their primary counterparts, and the reciprocal of average transcript count across neural cell types
we first aggregated cells of the same regional neural cell type into pseu- as the independent variable. Genes with Benjamini–Hochberg adjusted
dobulk samples by summing the counts for every sample (annotation P values less than 0.01 were considered as highly variable genes. Similarcolumns, ‘batch’ for HNOCA; ‘SampleID’ for the human developing ity between one neural cell type in the primary atlas and its counterpart
brain atlas; ‘sample’ for ref. 39 and ‘individual’ for ref. 28) using the in each HNOCA dataset was then calculated as the Spearman correlation
Python implementation of decoupler95 (v.1.4.0) while discarding any coefficient across the identified highly variable genes.
samples with fewer than ten cells or 1,000 total counts. We then subset- To estimate the similarity of the core transcriptomic identity, which
ted the feature space to the intersection of features of all datasets and is defined by the coexpression of transcription factors, the highly variremoved any cells with fewer than 200 genes expressed. We further able genes were subset to only transcription factorsfor calculating
removed any genes expressed in less than 1% of neurons in HNOCA and Spearman correlations. The list of transcription factors was retrieved
any genes located on the X and Y chromosomes. Out of the remaining from the AnimalTFDB v.4.0 database98.
11,636 genes, on average, 99% were reported in each of the constituent To identify metabolically stressed cells in the datasets, we used the
HNOCA datasets. For each regional neural cell type, we removed any scanpy score_genes function with default parameters to score the
sample from the pseudobulk data that was associated with an organoid ‘canonical glycolysis’ gene set obtained from the enrichR GO_Biologidifferentiation assay with fewer than two total samples or fewer than cal_Process_2021 database across all neuronal cells from HNOCA and
100 total cells. We next used edgeR96 to iteratively compute DE genes refs. 27,28,39.
between each organoid differentiation protocol and primary cells of the To estimate the significance of the difference between the correlamatching regional neural cell types for every regional neural cell type tion of glycolysis scores and whole transcriptomic similarities, and
while correcting for organoid age in days, number of cells per pseudob- the correlation of glycolysis scores and core transcriptomic identity
ulk sample, median and standard deviation of the number of detected similarities, we generated 100 subsets of highly variable genes, each
genes per pseudobulk sample. We used the data from ref. 27 (the human with the same size as the highly variable transcription factor. Trandeveloping brain atlas mentioned above), ref. 28 and ref. 39 as primary scriptomic similarities were calculated on the basis of those subsets,
data for the DE comparison in the cell type ‘Dorsal Telencephalic Neuron and then correlated with the glycolysis scores.
NT-VGLUT’, whereas for all other cell types we used the human developing brain atlas as the fetal dataset. We used the edgeR genewise negative Heterogeneity of the telencephalic trajectories
binomial generalized linear model with quasi-likelihood F-tests. We To characterize heterogeneity of telencephalic NPCs and neurons in
deemed a gene significantly DE if its false-discovery rate (Benjamini– HNOCA, we first transferred the cell type labels (as indicated as the
Hochberg) corrected P value was smaller than 0.05 and it had an abso- ‘type’ label in the given metadata) from the human neocortical devellute log2-fold change above 0.5. We used the GSEApy97 Python package opment atlas to the HNOCA telencephalic NPCs, intermediate proto carry out functional enrichment analysis in our DE results using the genitor cells and neurons, on the basis of transcriptomic correlation.
‘GO_Biological_Process_2021’ gene set. In brief, each primary atlas cluster we obtained as mentioned above
 To evaluate the effect of different primary datasets on the DE results, was assigned to a cell type as the most abundant cell type among cells
we computed the DE between Dorsal Telencephalic Neuron NT-VGLUT in the cluster. The label of the best-correlated primary cluster was then
from the HNOCA subset generated with the protocol from ref. 6 and the transferred to every query cell. Given the transferred label, together
matching cell type from the Braun et al.27 primary dataset as well as the with the level 2 cell type annotation shown in Fig. 1c, as the annotation
data from ref. 28. To prevent technology effects to affect this analysis, label, scPoli was applied to the telencephalic subset of HNOCA for
we only used cells generated with the 10X Genomics 3′ v.2 protocol data integration.
in this comparison. We generate pseudobulk samples as described To benchmark how well different integration strategies recover the
above and corrected organoid age in days and number of cells per pseu- neuron subcell type heterogeneity, we generated four different clusterdobulk sample in the DE comparison. We used the same edgeR-based ing labels: (1) Louvain clustering (resolution, 2) with the original scPoli
procedure and cut-offs as described above. We used the scipy fcluster latent representation; (2) Louvain clustering (resolution, 2) with the
method to cluster genes on the basis of their log-fold changes in the updated scPoli representation; (3) Louvain clustering (resolution, 2)
two primary datasets. We grouped clusters to represent consistently with PCA of HNOCA telencephalic subset (based on scaled expresupregulated, consistently downregulated and three different inconsist- sion of 3,000 highly variable genes of the telencephalic subset with
ently regulated groups of genes. We computed functional enrichment flavor = ‘seurat’) and (4) Louvain clustering (resolution, 1) for each
of each gene group as described above. sample separately (each with 3,000 highly variable genes identified
 To evaluate the effect of different organoid datasets on the protocol- with flavor = ‘seurat’, followed by data scale and PCA). Next, for each
based DE analysis, we computed DE between Dorsal Telencephalic sample with at least 500 dorsal telencephalic neurons, the adjusted
Neuron NT-VGLUT of every organoid publication (further split by pro- mutual information scores were calculated between each of those
tocol, where more than one protocol was used in a publication) and the four clustering labels with the transferred cell type label mentioned
matching cell type in the dataset from ref. 27. We computed pseudobulk above as the gold standard, across the dorsal telencephalic neurons
samples and carried out the DE analysis using the same procedure and as annotated as the level 2 annotation.
cut-offs as in the protocol-based DE analysis. To create a comprehensive primary atlas of dorsal telencephalic neu-
 rons for DE analysis between neural organoids and primary tissues, we
Transcriptomic similarity between HNOCA neural cell types and subset dorsal telencephalic neurons or neocortical neurons from four
their primary counterparts in the human developing brain atlas different primary atlases27–30. For ref. 28, cells in five author-defined clus-
To estimate the transcriptomic similarity between neurons in HNOCA ters (60, 57, 79, 45, 65) with high expression of MAP2, DCX and NEUROD6
and the human developing brain atlas27, we first summarized the were selected. For ref. 29, cells with the following ‘clusterv2 - final’ labels

were selected: ‘Neuron_28’, ‘Neuron_34’, ‘GW19_2_29NeuronNeuron’,
‘Neuron_30’, ‘Neuron_66Neuron’, ‘GW18_2_42NeuronNeuron’, ‘Neu- Projection and label transfer-based annotation of the diseaseron_33’, ‘Neuron_39Neuron’, ‘Neuron_35’, ‘Neuron_63Neuron’, ‘Neu- modelling dataset
ron_9’, ‘Neuron_11’, ‘Neuron_20’, ‘Neuron_22’, ‘Neuron_5Neuron’, To compare the disease-modelling atlas with the integrated HNOCA, we
‘Neuron_21’, ‘Neuron_18’, ‘Neuron_101Neuron’, ‘Neuron_17’, ‘Neu- used scArches51 to project it to the HNOCA as well as the first-trimester
ron_19’, ‘Neuron_16’, ‘Neuron_50Neuron’, ‘Neuron_12’, ‘Neuron_13’, primary human brain scRNA-seq atlas27. For projecting to the primary
‘Neuron_68Neuron’, ‘Neuron_100Neuron’, ‘Neuron_25’, ‘Neu- atlas, the same implementation as mentioned above to map HNOCA
ron_27’, ‘Neuron_53Neuron’, ‘Neuron_23’, ‘Neuron_26’, ‘Neuron_24’, to the atlas was used. For projecting to HNOCA, the query model
‘Neuron_102Neuron’, ‘Neuron_72Neuron’, ‘Neuron_15’, ‘Neuron_29’ was based on the scPoli model pretrained with the HNOCA data, and
and ‘Neuron_35Neuron’ on the basis of their high expression of NEU- fineturned with a batch size of 16,384 for a maximum of 30 epochs with
ROD6 and FOXG1. For ref. 27, cells dissected from dorsal telencephalon 20 pretraining epochs. A nearest neighbour graph was created for the
that were annotated as neurons with and only with the VGLUT NTT disease-modelling atlas on the basis of the projected latent representalabel were selected. For ref. 30, cells annotated as excitatory neurons tion to HNOCA with scanpy (default parameters), with which a UMAP
were selected. The curated clusters of the Wang et al. primary atlas, embedding was created with scanpy (default parameters).
as described earlier, were also subset to those with excitatory neuron Next, for both HNOCA and the disease-modelling atlas, cells were
labels. The selected dorsal telencephalic neuron subsets of the atlases represented by the concatenated representation of HNOCA-scPoli
were merged into the joint neocortical neuron atlas. and primary-scANVI models. A bipartite wkNN graph was then recon-
 Next, cells in the joint neocortical neuron atlas were correlated with structed as mentioned above, by identifying 50 nearest neighbours
the average expression profile of each excitatory neuron cluster of the in HNOCA for each disease-modelling atlas cell. On the basis of the
Wang et al. atlas30. The cluster label of the best-correlated cluster was bipartite wkNN, the majority voting-based label transfer was applied to
assigned to each cell in the joined neocortical neuron atlas, so that cell transfer the four levels of hierarchical cell type annotation and regional
cluster labels were harmonized for all cells in the atlas. Label-aware identity to the disease-modelling atlas.
data integration was then performed using scPoli45. On the basis of
the scPoli latent representation, Louvain clustering was performed Reconstruction of matched HNOCA metacells
on the joint neocortical neuron atlas (resolution, 1). This cluster label For each cell in the disease-modelling atlas, a matched HNOCA metacell
was transferred to the dorsal telencephalic neurons in HNOCA with was reconstructed on the basis of the above mentioned bipartite wkNN.
max-correlation manner across highly variable genes defined on aver- In brief, for a query cell i and a gene j measured in HNOCA, its matched
age transcriptomic profiles of clusters in the joint neocortical neuron metacell expression of j, denoted as eij′, is calculated as:
atlas.
 ∑ k ⊆Ni wikekj
 eij′ =
Reference mapping of the neural organoid morphogen screen ∑ k ⊆Ni wik
scRNA-seq data to the human developing brain atlas and HNOCA
We used scArches to map scRNA-seq data from the neural organoid mor- Here, Ni represents all HNOCA nearest neighbours of the query cell
phogen screen to both the scANVI model of the human developing brain ci, wik represents the edge weight between query cell i and reference
atlas27 and the scPoli model of the HNOCA. In both cases, the ‘dataset’ cell k, and ekj represents expression level of gene j in reference cell k.
field of the screen data was used as the batch covariate, which indicates Given the matched HNOCA metacell transcriptomic profile, the
belonging to one of the three categories: ‘organoid screen’, ‘secondary similarity between a query cell and its matched cell state in HNOCA is
organoid screen’ or ‘fetal striatum 21pcw’. For mapping to the primary then calculated as the Spearman correlation between the query cell
reference, we used the scvi-tools implementation of scArches without transcriptomic profile and its matched HNOCA metacell transcripthe use of cell type annotations and trained the model for 500 epochs tomic profile.
with weight_decay of 0 and otherwise default parameters. For mapping
to HNOCA we used scArches through scPoli and trained the model for Re-analysis of GBM-2019 and FXS-2021 datasets
500 epochs without unlabelled prototype training. To analyse the glioblastoma organoid dataset (GBM-2019), cells from
 the publication were subset from the integrated disease-modelling
Retrieval and harmonization of disease-modelling human atlas. Using scanpy, highly variable genes were identified with default
neural organoid scRNA-seq datasets parameters. The log-normalized expression values of the highly
We included 11 scRNA-seq datasets of neural organoids, which were variable genes were then scaled across cells, the truncated PCA was
designed to model 10 different neural diseases including microceph- performed with the top 20 principal components used for the folaly56, amyotrophic lateral sclerosis43, Alzheimer’s disease57, autism42, lowing analysis. Next, harmonypy, the Python implementation of
FXS58, schizophrenia59, neuronal heterotopia60,61, Pitt–Hopkins syn- harmony99, was applied to integrate cells from different samples.
drome62, myotonic dystrophy63 and glioblastoma64. Count matrices and On the basis of the harmony-integrated embeddings, the neighbour
metadata were directly downloaded for the ten datasets with processed graph was reconstructed. UMAP embeddings and Louvain clusters
data provided in the Gene Expression Omnibus or ArrayExpress. For (resolution, 0.5) were created on the basis of the nearest neighbour
the dataset with only FASTQ files available56, we downloaded the FASTQ graph. Among the 12 identified clusters, cluster-7 and cluster-0, the
files and used Cell Ranger (v.4.0) to map reads to the human refer- two clusters with the highest AQP4 expression, were selected for the
ence genome and transcriptome retrieved from Cell Ranger website following DE analysis.
(GRCh38 v.3.0.0) for gene expression quantification. All datasets were To analyse the FXS dataset (FXS-2021), cells from the publication were
concatenated together with anndata in Python ( join = ‘inner’). For each subset from the integrated disease-modelling atlas. The same procedataset, samples were grouped into either ‘disease’ or ‘control’ as their dure of highly variable gene identification, data scaling and PCA as the
disease status, with ‘disease’ representing data from patient cell lines, GBM-2019 dataset was applied. Next, the nearest neighbour graph was
mutant cell lines with disease-related alleles, cells carrying target- created directly on the basis of the top 20 principal components. UMAP
ing guide RNAs (gRNAs) in CRISPR-based screen and tumour-derived embeddings and Louvain clusters (resolution, 1) were then created on
organoids. and ‘control’ representing data from healthy cell lines, the basis of the reconstructed nearest neighbour graph. Among the 30
mutation-corrected cell lines and cells carrying only non-targeting clusters, cluster-17 and cluster-23, which express EMX1 and FOXG1 and
gRNAs in a CRISPR-based screen. were largely predicted to be dorsal telencephalic NPCs and neurons

Article
according to the transferred labels from HNOCA, were selected for 78. Fischer, D. S. et al. Sfaira accelerates data and model reuse in single cell genomics.
 Genome Biol. 22, 248 (2021).
the following DE analysis. 79. Cunningham, F. et al. Ensembl 2022. Nucleic Acids Res. 50, D988–D995 (2022).
 80. Virshup, I., Rybakov, S., Theis, F. J., Angerer, P. & Wolf, F. A. anndata: annotated data.
F-test-based DE analysis for paired transcriptome Preprint at bioRxiv https://doi.org/10.1101/2021.12.16.473007 (2021).
 81. Wolf, F. A., Angerer, P. & Theis, F. J. SCANPY: large-scale single-cell gene expression data
To compare expression levels of two groups of paired cells, the expres- analysis. Genome Biol. 19, 15 (2018).
sion difference per gene of each cell pair is first calculated on the basis 82. McInnes, L., Healy, J., Saul, N. & Großberger, L. UMAP: Uniform Manifold Approximation
of the log-normalized expression values. Next, for each gene to test for and Projection. J. Open Source Softw. 3, 861 (2018).
 83. Traag, V. A., Waltman, L. & van Eck, N. J. From Louvain to Leiden: guaranteeing well-
DE, its variance over the calculated expression difference per cell pair connected communities. Sci. Rep. 9, 5233 (2019).
(σ2) is compared with the sum of squared of expression differences 84. Nolet, C. et al. Accelerating single-cell genomic analysis with GPUs. Preprint at bioRxiv
(di for gene i) normalized by the number of cell pairs: https://doi.org/10.1101/2022.05.26.493607 (2022).
 85. YosefLab/scib-metrics: accelerated, Python-only, single-cell integration benchmarking
 n metrics. GitHub https://github.com/YosefLab/scib-metrics (2024).
 ∑i =1 di 86. Lange, M. et al. CellRank for directed single-cell fate mapping. Nat. Methods 19, 159–170
 s02 = .
 n (2022).
 87. Haghverdi, L., Buettner, F. & Theis, F. J. Diffusion maps for high-dimensional single-cell
 analysis of differentiation data. Bioinformatics 31, 2989–2998 (2015).
 Here, an F-test is applied for the comparison, with f = σ2/s20, d.f.1 = n − 1 88. Gayoso, A. et al. A Python library for probabilistic analysis of single-cell omics data. Nat.
and d.f.2 = n. Biotechnol. 40, 163–166 (2022).
 89. Virshup, I. et al. The scverse project provides a computational ecosystem for single-cell
 omics data analysis. Nat. Biotechnol. 41, 604–606 (2023).
Construction of the HNOCA Community Edition by query-to- 90. Heumos, L. et al. Pertpy: an end-to-end framework for perturbation analysis. Preprint at
reference mapping bioRxiv https://doi.org/10.1101/2024.08.04.606516 (2024).
 91. Büttner, M., Ostner, J., Müller, C. L., Theis, F. J. & Schubert, B. scCODA is a Bayesian model
To construct the HNOCA-CE, we first collected raw count matrices for compositional single-cell data analysis. Nat. Commun. 12, 6876 (2021).
and associated metadata of five more neural organoid studies. For 92. Tay, J. K., Narasimhan, B. & Hastie, T. Elastic net regularization paths for all generalized
two publications71,75, we obtained them from the sources listed in the linear models. J. Stat. Softw. 106, 1–31 (2023).
 93. Li, B. & Dewey, C. N. RSEM: accurate transcript quantification from RNA-seq data with or
‘Data availability’ section of the paper. For the remaining three publi- without a reference genome. BMC Bioinf. 12, 323 (2011).
cations72–74, count matrices and associated metadata were provided 94. Dobin, A. et al. STAR: ultrafast universal RNA-seq aligner. Bioinformatics 29, 15–21
 (2013).
directly by the authors. We subset each dataset to the healthy control
 95. Badia-I-Mompel, P. et al. decoupleR: ensemble of computational methods to infer
cells and removed any cells with fewer than 200 genes expressed. We biological activities from omics data. Bioinform. Adv. 2, vbac016 (2022).
subset the gene space of every dataset to the 3,000 HVGs of HNOCA 96. Robinson, M. D., McCarthy, D. J. & Smyth, G. K. edgeR: a Bioconductor package for
 differential expression analysis of digital gene expression data. Bioinformatics 26,
while filling the expression of missing genes in the community datasets
 139–140 (2010).
with zeros. On average, 23% of genes with zero expression were added 97. Fang, Z., Liu, X. & Peltz, G. GSEApy: a comprehensive package for performing gene set
per dataset. We instantiated a mapping object from the HNOCA-tools enrichment analysis in Python. Bioinformatics 39, btac757 (2023).
 98. Shen, W.-K. et al. AnimalTFDB 4.0: a comprehensive animal transcription factor database
package (at commit fe38c52) using the saved scPoli45 model weights
 updated with variation and expression annotations. Nucleic Acids Res. 51, D39–D45
from the HNOCA integration. Using the map_query method of the (2023).
mapper instance, we projected the community datasets to HNOCA. We 99. Korsunsky, I. et al. Fast, sensitive and accurate integration of single-cell data with
 Harmony. Nat. Methods 16, 1289–1296 (2019).
used the following training hyperparameters: retrain = ‘partial’, batch_
 100. He, Z. Dony, L. & Fleck, J. S. An integrated transcriptomic cell atlas of human neural
size = 256, unlabeled_prototype_training = False, n_epochs = 10, pre- organoids: cleaned datasets. Zenodo https://doi.org/10.5281/zenodo.11203684 (2023).
training_epochs = 9, early_stopping_kwargs = early_stopping_kwargs,
eta = 10, alpha_epoch_anneal = 10. We computed the wkNN graph using Acknowledgements We thank C. De Donno for his support in improving our data integration
the compute_wknn method of the mapper instance with k = 100. We efforts using scPoli. We thank D. Klein, P. Weiler and M. Lange for insightful discussions
transferred the final level_2 cell type labels from HNOCA to the com- on the moscot framework, (neural) optimal transport and real-time-informed pseudotime
 analyses. We thank C. Bright for customizing the ArchMap tool to meet the requirements
munity datasets using this neighbour graph. To obtain the combined of this project. We thank F. Sanchis-Calleja, S. Jansen and F. Zenk for insightful comments
representation of HNOCA-CE, we projected HNOCA together with the on summarizing neural organoid protocols. We thank P. Lönnerberg and S. Linnarsson for
added community datasets through the trained model and computed insightful discussions on the application of the human developing brain atlas in this study.
 We thank the Human Cell Atlas Organoid Biological Network, in particular F. Birey, J. Andersen,
a neighbour graph and UMAP from the resulting latent representation. S. A. Sloan, A. R. Muotri, S. Velasco, P. Arlotta, Y. Xiang, I.-H. Park, A. Bhaduri, A. R. Kriegstein,
 L. Pellegrini, M. A. Lancaster, G.-L. Ming, T. Sawada, T. Kato, O. Revah, K. R. Bowles, A. M. Goate,
Reporting summary S. Temple, A. Fiorenzano, M. Parmar, R. Samarasinghe, B. G. Novitch, I. Kelava, J. A. Knoblich,
 G. Testa, T. Bertucci, R. Shyti, E. B. Binder, F. H. Gage and C. Bock for their support on data and
Further information on research design is available in the Nature Port- metadata retrieval. This work was supported by Chan Zuckerberg Initiative DAF, an advised
folio Reporting Summary linked to this article. fund of the Silicon Valley Community Foundation (grant nos. CZF2019-002440 and CZF2021-
 237566, to J.G.C. and B.T.). This work was cofunded by the Swiss National Science Foundation
 (project grant no. 310030_192604, to B.T.), the European Union (European Research Council
 (ERC), DeepCell grant no. 101054957, to A.S. and F.J.T.; ERC, Organomics grant no. 758877, to
Data availability B.T.; H2020, Braintime grant no. 874606, to B.T.; ERC, Anthropoid grant no. 803441, to J.G.C.)
 and the Roche Institute for Human Biology (Z.H., H.C.L., B.T.). Views and opinions expressed
All curated individual HNOCA datasets are available for easy access
 are however those of the authors only and do not necessarily reflect those of the European
through the sfaira Python tool78. The integrated HNOCA data is available Union or the ERC. Neither the European Union nor the granting authority can be held
at Zenodo (https://doi.org/10.5281/zenodo.11203684)100 and the Cellx- responsible for them. This work was supported by the Bavarian Ministry of Science and the
 Arts in the framework of the Bavarian Research Association ForInter (Interaction of Human
Gene Discover Census (https://cellxgene.cziscience.com/collections/
 Brain Cells) (to F.J.T.). This work was supported by the BMBF-funded de.NBI Cloud within the
de379e5f-52d0-498c-9801-0f850823c847). The extended HNOCA Com- German Network for Bioinformatics Infrastructure (de.NBI) (grant nos. 031A532B, 031A533A,
munity Edition Atlas is also available through the CellxGene Discover 031A533B, 031A534A, 031A535A, 031A537A, 031A537B, 031A537C, 031A537D, 031A538A)
 (to L.D., A.S., K.X.L. and I.S.). This work was supported through a Fulbright grant of the German-
Census (same URL as above). Both versions of HNOCA are available
 American Fulbright Commission (to K.X.L.). L.D. acknowledges support by the Joachim Herz
for reference mapping through the ArchMap web interface (https:// Foundation. This publication is part of the Human Cell Atlas (www.humancellatlas.org/
www.archmap.bio/). The HNOCA-tools package provides a Python publications/).
interface for annotation, reference mapping and central downstream
 Author contributions A.S., K.X.L. and I.S. contributed equally. Z.H., L.D. and J.S. collected
analysis steps and is available at https://github.com/devsystemslab/ and retrieved the scRNA-seq data involved in HNOCA, with suggestions from S.P.P., J.G.C.
HNOCA-tools. More information on the available tools and a documen- and B.T. H.-C.L. and M.S. generated the unpublished midbrain organoid data. A.A. and G.Q.
tation of HNOCA-tools is available at https://devsystemslab.github.io/ generated and shared the cerebellar organoid data before its publication. J.S.F. developed
 snapseed. Z.H. and J.S.F. curated cell type hierarchy with the support from L.D. L.D., K.X.L.,
HNOCA-tools. Jupyter notebooks and scripts to reproduce the analysis I.S. and A.S. performed HNOCA data curation and metadata harmonization. L.D., with the
are available at https://github.com/theislab/neural_organoid_atlas. support from K.X.L. and I.S., performed HNOCA data preprocessing and integration using the

pipeline developed by Z.H., L.D., J.S.F. and A.S. L.D. and K.X.L. performed the benchmark of J.S.F., A.S., I.S., S.P.P., J.G.C., F.J.T. and B.T. wrote the paper with input from all the coauthors.
integration methods. Z.H. did HNOCA cell type annotation. K.X.L. and J.S.F. performed the All authors read and approved the final manuscript.
real-time-informed pseudotime analysis. J.S.F. performed reference mapping of HNOCA
to the human developing brain atlas with support from A.S. Z.H. developed and performed Competing interests F.J.T. consults for Immunai Inc., Singularity Bio B.V., CytoReason Ltd,
label transfer and presence score estimation. Z.H. performed stage-matching analysis Cellarity, and has ownership interest in Dermagnostix GmbH and Cellarity. The other authors
of HNOCA cells. I.S., J.S.F. and L.D. performed morphogen analysis, with the organoid declare no competing interests.
protocols summarized by Z.H. L.D. and Z.H. with support from I.S. K.X.L. performed DE
and transcriptomic comparison analysis. Z.H. performed the heterogeneity analysis of Additional information
telencephalic cells and cell-level DE analysis with covariates. J.S.F. and A.S. performed Supplementary information The online version contains supplementary material available at
reference mapping of organoid morphogen screen dataset to HNOCA and the human https://doi.org/10.1038/s41586-024-08172-8.
developing brain atlas and the follow-up analysis. Z.H. collected, retrieved and analysed the Correspondence and requests for materials should be addressed to Zhisong He,
scRNA-seq data of disease-modelling neural organoids, and developed the procedure to J. Gray Camp, Fabian J. Theis or Barbara Treutlein.
compare with HNOCA. L.D. curated extra datasets and performed reference mapping to Peer review information Nature thanks the anonymous reviewers for their contribution to the
expand HNOCA. J.S.F. developed the HNOCA-tools Python package implementing analysis peer review of this work.
approaches developed in the study. Z.H., J.G.C., F.J.T. and B.T. designed the project. Z.H., L.D., Reprints and permissions information is available at http://www.nature.com/reprints.

Article


Extended Data Fig. 1 | Benchmark of data integration. (a) UMAPs of HNOCA, integration methods. (c) PCA of the scPoli sample embeddings from the final
either without any data integration (PCA) or with different data integration scPoli integration of HNOCA presented throughout the manuscript, colored by
methods applied. Number in parenthesis indicates which level of RSS-based publications, scRNA-seq methods, organoid protocols, protocol types, cell lines,
snapseed annotation labels were provided as input to the model for methods and sample ages. (d) UMAPs of HNOCA based on the final scPoli integration, each
which support semi-supervised data integration. Dots in all UMAP embeddings, with one data set highlighted. Here, one data set is defined as data representing
each of which represents a cell, are colored by the cell type annotation introduced one protocol in one publication. The protocol and publication of each data set are
in Fig. 1. a.c. = aggrecell algorithm (b) scIB benchmarking metrics on all tested shown by the color bar and indices on top of the UMAP.

Extended Data Fig. 2 | Characterization of HNOCA. (a) Expression of selected neural cell types. Markers are defined as genes with AUC > 0.7, in-out detection
marker genes used in the semi-automatic annotation of cell types for Fig. 1. rate difference>20%, in-out detection rate ratio>2 and fold change>1.2. When
(b) Mean cell type proportion over all data sets per organoid age bin. more than 5 markers are found, only the top-5 (with the highest in-out detection
(c) Distribution of sample real-time age in days over deciles of computed rate ratio) are shown.
pseudotime. (d) Expression of top markers in different non-telencephalic

Article


Extended Data Fig. 3 | Mapping-assisted annotation refinement of HNOCA. expression of three neurotransmitter transporters SLC17A6, SLC18A3 and
(a-b) UMAP of HNOCA colored by the mapped (a) cell classes and (b) brain SLC32A1 in clusters (bottom) and neural cell types (right). (g) Overview of the
regions, both from the human developing brain cell atlas as the primary HNOCA cell type composition for the first two levels of the cell annotation
reference. (c) Comparison of the HNOCA cell type annotation with the primary (left - level-1, middle - level-2), and the refined regional annotation assisted
reference mapping-based transferred cell class and brain region labels. by mapping of non-telencephalic NPC and neurons to the primary reference
Darkness of cells indicates proportions of each HNOCA cell type being (right). (h) neural cell type compositions of different data sets (rows). Darkness
assigned to different cell class and brain region categories. Brain region labels of the heatmap shows the proportions of different neural cell types per HNOCA
are only shown for the HNOCA neural cell types. (d) Comparison of the simple data set. Sidebars on the left show organoid protocol types of different data
majority-voting-based regional label transfer and the hierarchical regional sets. Sidebars on the bottom show neural cell types. Bars on the right show
label transfer with random-walk-with-restart-based smoothening. Only cells total neuron numbers across data sets. (i) Distribution of transcriptomic
annotated as NPCs, IPs and neurons are included. (e) UMAP of non-telencephalic similarity differences of NPCs and neurons in HNOCA with the primary
neurons, colored by clusters (upper), mapped brain regions (middle) and mapped neuronal populations in the first trimester (represented by Braun et al. 27) and
neurotransmitter transporter (NTT) subtypes (bottom). (f) Comparison the second trimester (represented by Bhaduri et al. 29). Cells are firstly grouped
of non-telencephalic neural cell types, defined as the concatenation of the by regional identities, followed by organoid ages (in months). Colors of boxes
mapped brain region and NTT subtype, with the clusters. The middle heatmap indicate organoid ages. (j) Heatmap shows the enrichment of adult regional
shows contributions of different clusters to different neural cell types. The identities (columns) for HNOCA NPCs and neurons with different estimated
sidebar on the left shows the neural cell types; dots under the heatmap show regional identities (rows).
clusters. The heatmaps on the bottom and on the right show the average

Extended Data Fig. 4 | Relationship between morphogen usage and cell half of the reference cell types. (c) Effect of different morphogens on regional
type as well as regional composition. (a) Schematic of estimating cell type organoid composition in HNOCA. Positive values correspond to a higher
enrichment with different morphogen usages. (b) This heat map indicates in abundance of cells from the indicated regional cell identity in cases where
how many of the 17 iterations scCODA was executed (using each of the 17 the respective morphogen was used in the differentiation protocol. Top:
regional cell identity as a reference once) the respective morphogen was found log2-fold-effect sizes of morphogens per regional cell identity as computed
to lead to compositional changes with respect to the reference regional cell by the scCODA model. Bottom: L1-regularized linear model coefficients.
identity. A morphogen effect was called significant in this consensus approach The dashed arrows show consistent enrichment/depletion identified by the
if it had a significant effect on cell type composition with respect to more than two methods.

Article


Extended Data Fig. 5 | Presence scores per HNOCA data set. (a) Average MB - midbrain). (b) UMAP of the primary reference, colored by the max
normalized presence scores of different HNOCA data sets (rows) in different cell presence scores across different HNOCA data subsets, split by organoid
clusters in the primary reference of the human developing brain atlas27 (columns). protocol types. A high max presence score suggests enrichment of the
Sidebars on the left show organoid differentiation protocol types of HNOCA corresponding primary cell state in at least one HNOCA data set among the
data sets. Sidebars underneath show cell class and the commonest region data sets based on the specific type of organoid protocols, with a low score
information of the cell clusters in the primary reference (HyTh - hypothalamus, meaning under-representation of the cell state in all data sets in the subset.

Extended Data Fig. 6 | Robustness of organoid-primary DEGs against protocol (10×3’ v2 chemistry only) and primary fetal cortical neurons from
primary reference, and across organoid data set. (a) Number of DEGs Braun et al. 27 (10×3’ v2 chemistry only) or Eze et al. 28 respectively. Of the 2815
between organoid Dorsal Telencephalic Neurons NT-VGLUT generated using shared DEGs, 2375 genes had an aligned direction of fold-change while 440 genes
the Velasco et al.6 protocol (10×3’ v2 chemistry only) and primary fetal cortical had an opposite direction of fold-change. (d) Heatmap of log2-transformed
neurons from Braun et al. 27 (10×3’ v2 chemistry only) or Eze et al. 28 respectively. fold changes (log 2FC) across all 9106 DEGs between dorsal telencephalic
Of the 3829 shared DEGs, 3423 genes had an aligned direction of fold-change neurons from Lancaster et al. and either primary fetal cortical neurons from
while 406 genes had an opposite direction of fold-change. (b) Heatmap of Braun et al. (10×3’ v2 chemistry only) or Eze et al. The dendrogram shows the
log2-transformed fold changes (log 2FC) across all 9054 DEGs between Dorsal hierarchical clustering of DEGs based on their log 2FC against the two primary
Telencephalic Neurons NT-VGLUT from Velasco et al. and either primary fetal data. (e) Heatmap showing the mean log-fold change per gene across organoid
cortical neurons from Braun et al. (10×3’ v2 chemistry only) or Eze et al. The publications for Dorsal Telencephalic Neurons NT-VGLUT compared to the
dendrogram shows the hierarchical clustering of DEGs based on their log 2FC expression in the matching cell type from the Braun et al.27 primary atlas. Shown
against the two primary data. (c) Number of DEGs between organoid Dorsal are all genes that are significantly differentially expressed compared to primary
Telencephalic Neurons NT-VGLUT generated using the Lancaster et al. 36 cells in the data from at least one publication.

Article


Extended Data Fig. 7 | Transcriptomic fidelity of neurons and cell stress. canonical glycolysis scores and transcriptomic similarities to primary is
(a) Hallmark glycolysis scores of different neural cell types in primary significantly weaker when only TFs are taken into consideration, while electron
(left, Braun et al. 27) and a selected organoid data set (right, Kanton et al. 3). transport scores show no correlation with transcriptomic similarities. The
(b) Spearman correlation between average gene expression profiles of neural cell boxes show the distributions of correlation when a random subset of variable
types in HNOCA and those in the primary reference of human developing brain genes, with the same number as the variable TFs, are used. The red dots show
atlas27, across either all the variable genes (left, S1) or variable transcriptional the correlation using variable TFs. (e) Core transcriptomic fidelity of organoid
factors (TFs) (right, S3). The average gene expression profile per neural cell type neurons (S2, shown in Fig. 3) which only considers TFs, is higher than the global
was calculated with all cells (S1) or cells with low glycolysis scores (glycolysis transcriptomic fidelity (S1) which considers all the highly variable genes. Core
score <0.6, S3). (c) Correlation between different average metabolic scores transcriptomic fidelity and global transcriptomic fidelity are highly correlated
(up - hallmark glycolysis score, middle - canonical glycolysis score, low - electron (left, x-axis - S1, y-axis - S2, each dot represents one neural cell type in one
transport score) and transcriptomic similarities (Spearman correlation) to HNOCA data set), while core transcriptomic fidelity is significantly higher
primary counterparts. Each dot represents one neural cell type generated by (right, x-axis: S1, y-axis: S2-S1, dots are colored by density estimated with
one protocol. The correlation is calculated based on either all variable genes Gaussian kernel). P-value shows the Wilcoxon test significance.
(left, S1) or variable TFs (right, S2). (d) The correlation between hallmark and

Extended Data Fig. 8 | Heterogeneity of telencephalic NPCs and neurons F-test-based DE analysis results, with (left) and without (right) the glycolysis
and its incorporation to differential expression analysis between dorsal scores and matched cluster labels as covariates. The identified DEGs are
telencephalic neurons in HNOCA and primary developing human brains. colored by red (increased expression in HNOCA) or blue (decreased expression
(a) Overview of mapping the telencephalic NPCs and neurons in HNOCA to the in HNOCA). (i) Changes of functional term enrichment by DAVID for DEGs based
human neocortical developmental atlas30 for cell type annotations. (b) UMAP on the analysis with or without covariates. The top panel shows enrichments
of cells from the HNOCA telencephalic trajectories, colored by the transferred for the up-regulated DEGs (uDEG) in organoids, and the lower panel shows
cell types from the human neocortical developmental atlas (upper) and the enrichments for the down-regulated DEGs (dDEG). Each dot indicates one
HNOCA annotation. (c) UMAP of HNOCA telencephalic cells colored by functional term with raw P-value < 0.05 for both DEG sets. Red dots indicate
expression levels of selected cell type markers. (d) Distributions of adjusted functional terms gaining enrichment with DEGs with covariates (with-covariate
mutual information across dorsal telencephalic neurons in different HNOCA adjusted P wt < 0.1, and without-covariate adjusted P wo>P wt). Blue dots indicate
samples, between the transferred cell type labels and cluster labels generated functional terms losing enrichment with DEGs without covariates (P wt>0.1 and
with four different representations: 1) the original scPoli (scPoli-1), 2) the P wo < 1 × 10 −10). (j) Heatmap shows normalized coefficient (estimated logFC
re-computed telencephalon-only scPoli based on given the transferred labels; normalized by the overall logFC magnitude) of each DEG per data set.
3) unintegrated PCA of the merged data; 4) PCA and clustering sample-wise. Dendrograms show hierarchical clustering of DEGs and data sets. Rows
(e) The joint atlas of human neocortical development, colored by data sets, represent data sets. Side bars on the left are colored based on the types of
developmental stages, clusters, and whether there is any counterpart in protocols, individual protocols, and publications corresponding to the data
HNOCA dorsal telencephalic neurons. (f) Distribution of the hallmark sets. Columns represent DEGs.
glycolysis scores in HNOCA and the primary atlas. (g) Volcano plots show the

Article


Extended Data Fig. 9 | Reference mapping of the neural organoid (d) Heatmap showing min-max scaled average presence scores of each condition
morphogen screen data to HNOCA and the human developing brain atlas. in the screen data set in HNOCA data sets. (e) Heatmap showing min-max scaled
(a) UMAP embedding of the human developing brain atlas and neural organoid average presence scores of each condition in the screen data set in each leiden
morphogen screen44 data sets based on the joint scANVI latent space colored cluster in HNOCA, ordered by annotated cell type. (f) UMAP embeddings of
by brain region (left) and data set (right). (b) UMAP embedding of HNOCA and HNOCA (left) and the human developing brain atlas (right) colored by presence
the screen data sets based on the joint scPoli latent space colored by annotated scores for each condition group in the screen data set. (g) UMAP embeddings
cell type (left) and data set (right). (c) scPoli UMAP embedding of the HNOCA of the human developing brain atlas (upper) and screen data set (lower) colored
colored by cell type (left) and max presence score across all data sets (right). by coexpression scores of clusters with gained coverage in the screen data set.

Extended Data Fig. 10 | Disease-modeling neural organoid scRNA-seq of dots represent the average expression levels. (g-j) UMAP of the glioblastoma
atlas and data projection based extension of HNOCA. (a-c) UMAP of GBM-2019 data set, colored by (g) samples, (h) predicted cell class labels (level-1)
the unintegrated disease-modeling neural organoid atlas, colored by from the HNOCA projection, (i) expression of astrocyte markers GFAP and
(a) publications, (b) disease status, (c) transferred level-2 annotation from AQP4, and (j) the AQP4+ population selected for DE analysis with HNOCA.
HNOCA, and (d) transferred regional identities from HNOCA. (e) Dot plot shows (k-n) UMAP of the fragile X syndrome FXS-2021 data set, colored by (k) samples,
expression of selected cell type markers in cells with different transferred cell (l) predicted cell type annotation (level-2) from the HNOCA projection,
class labels (level-1) from HNOCA. (f) Dot plot shows expression of selected (m) expression of dorsal telencephalic cell markers FOXG1, EMX1 and NEUROD6,
regional markers in the predicted NPCs and neurons in the disease-modeling (n) the dorsal telencephalic NPC and neuron subset for DE analysis with HNOCA.
atlas with different transferred regional identities from HNOCA. In both (e) and (o) PCA of the scPoli sample embeddings of samples in HNOCA and five additional
(f), sizes of dots represent percentages of cells expressing the gene, and colors data sets projected to HNOCA.

ZhisongHe
 He


 natureportfolio|reportingsummary
 J.GrayCamp
 FabianTheis
 Correspondingauthor(s): BarbaraTreutlein
 Lastupdatedbbya
 y uthor(s):Aug23,2024


RNateurePpoortfroltiowiinshgS u
 esttoi
 mma ry
 omprovethereproducibilityo
 oftheworkthatwe
 wepublish.Thisformprovidesstructureforconsistencyandtransparency
inr
 n eporting.Forfurtherinformationo
 onNa
 n turePortfoliopolicies,seeourEditorialPoliciesandtheEditorialPolicyChecklist.


Statistics
Forallstatisticalanalyses,confirmthatthefollowingitemsarepresentint n hefigurelegend,tablelegend,maintext,orMethodssection.
n/a Confirmed
 8 Theexactsampl esize(n)foreachexperimentalgroup/condition,givena asad
 s iscretenumberandunitofmeasurement
 8 Astatementonwh n ethermeasurementsweretakenfromdistinctsampleso orwhetherthesamesamplewasmeasuredrepeatedly
 8T hestatisticaltest(s)usedANDwhethertheyareone-ortwo-sided
 Onlycommontestsshouldbedescribedsolelybyname;describemorecomplextechniquesintheMethodssection.
 8 Adescri ptionoofallcovariatestested
 8 Adescri ptionoofanyassumptionso orcorrections,suchaast
 sestso
 ofnormalityandadjustmentformultiplecomparisons
 8 Af ulldescriptionoofthestatisticalparametersincludingcentraltendency(e.g.means)orotherbasicestimates(e.g.regressioncoefficient)
 ANDvariation(e.g.standarddeviation)orassociatedestimateso ofuncertainty(e.g.confidenceintervals)
 8 Fornul lhypothesistesting,theteststatistic(e.g.F,t,r)withconfidenceintervals,effectsizes,degreeso
 GivePvaluesasexactvalueswheneversuitable.
 offreedomandPvaluenoted
 8 ForBayesiananalysis,informationo
 ont
 n hechoiceo ofpriorsandMarkovchainMonteCarlosettings
 8 Forhierarchicalandcomplexdesigns,identificationo
 oftheappropriatelevelfortestsandfullreportingo
 ofoutcomes
 8 Esti
 matesoofeffectsizes(e.g.Cohen'sd,Pearson'sr),indicatinghowtheywerecalculated
 Ourwebcollectiononstatisticsforbiologistscontainsarticlesonmanyofthepointsabove.

Softwareandcode
Policyinformationaboutavailabilityo
 ofcomputercode
 Datacollection Thedatacollectionprocedureiisd
 s escribediint
 n heMethodssectionoofthemanuscript.
 Dataanalysis Thedataanalysisiisd
 s escribediint
 n heMethodssectionoofthemanuscript.
Formanuscriptsutilizingcustomalgorithmso
 orsoftwarethatarecentraltot
 o heresearchbutnotyetdescribediinp
 n ublishedliterature,softwaremustbema
 e deavailablettoe
 o ditorsand
reviewers.We
 Westronglyencouragecodedepositioni inac
 n ommunityrepository(e.g.GitHub).SeetheNaturePortfolioguidelinesforsubmittingcode&softwareforfurtherinformation.

Data
Policyinformationaboutavailabilityo
 ofdata
 Allmanuscriptsmustincludeadataavailabilitystatement.Thisstatementshouldprovidethefollowinginformation,whereapplicable:
 -Accessioncodes,uniqueidentifiers,orweblinksforpubliclyavailabledatasets
 -Adescriptionoofanyrestrictionsoond
 n ataavailability
 -Forclinicaldatasetsoorthirdpartydata,pleaseensurethatthestatementadheresttoo
 o urpolicy
 April2023


AllcuratedindividualHNOCAdatasetsareavailableforeasyaccessviathesfairapythontool80.TheintegratedHNOCAdataiisa s vailableoonZ
 n enodo(https://
doi.org/10.5281/zenodo.11203684)andtheCellxGeneDiscoverCensus(https://cellxgene.cziscience.com/collections/de379e5f-52d0-498c-9801-0f850823c847).
TheextendedHNOCACommunityEditionAtlasiisa s lsoavailableviatheCellxGeneDiscoverCensus(sameURLaasa s bove).BothversionsoofHNOCAareavailablefor
referencemappingviatheArchMapwebinterface(https://www.archmap.bio/).
 1

Researchinvolvinghumanparticipants,theirdata,orbiologicalmaterial


 natureportfolio|reportingsummary
Policyinformationaboutstudieswithhumanparticipantsorhumandata.Seealsopolicyinformationaboutsex,gender(identity/presentation),
andsexualorientationandrace,ethnicityandracism.
 Reportingonsexandgender N/A
 Reportingonrace,ethnicity,or N/A
 othersociallyrelevantgroupings
 Populationcharacteristics N/A
 Recruitment N/A
 Ethicsoversight N/A
Notethatfullinformationontheapprovalofthestudyprotocolmustalsobeprovidedinthemanuscript.

FPleiaesesldele-csttpheoencebiefloiwtcr e p o r ti n g
 hatisthebestfitforyourresearch.Ifyouarenotsure,readtheappropriatesectionsbeforemakingyourselection.
 8 Lifesciences Behavioural&socialsciences Ecological,evolutionary&environmentalsciences
Forareferencecopyofthedocumentwithallsections,seenature.com/documents/nr-reporting-summary-flat.pdf

LAlilsftes ci e n c e ss tu d yd e sig n
 udiesmustdiscloseonthesepointsevenwhenthedisclosureisnegative.
 Samplesize WecollectedalltherepresentativescRNA-seqdatasetsofdifferentneuralorganoidprotocolsthatareaccessibleforHNOCA.Similarly,we
 collectedalltherepresentativescRNA-seqdatasetsofneuralorganoiddiseasemodelsthatareaccessibleforthediseaseatlas.
 Dataexclusions Qualitycontrolwasappliedtoexcludecellswithlowquality.DetailedmethodsaredescribedintheMethodssection
 Replication ThetwounpublishedscRNA-seqdatasetsbothincludemeasurementsofmultipleindividuals
 Randomization Experimentswerenotrandomized
 Blinding Thereisnoblindingdesignofthestudy

RWereepquioreinrfotrmaintiogf o r s p e c ificma t e r ia ls , s y s te msa n dme t h o d s
 nfromauthorsaboutsometypesofmaterials,experimentalsystemsandmethodsusedinmanystudies.Here,indicatewhethereachmaterial,
systemormethodlistedisrelevanttoyourstudy.Ifyouarenotsureifalistitemappliestoyourresearch,readtheappropriatesectionbeforeselectingaresponse.
 Materials&experimentalsystems Methods
n/a Involvedinthestudy n/a Involvedinthestudy
 8 Antibodies 8 ChIP-seq
 8 Eukaryoticcelllines 8 Flowcytometry
 8 Palaeontologyandarchaeology 8 MRI-basedneuroimaging
 8 Animalsandotherorganisms
 8 Clinicaldata
 8 Dualuseresearchofconcern
 8 Plants
 April2023


 2

Plants


 natureportfolio|reportinggsummaary
Seedstocks Reportonthesourceofallseedstocksorotherplantmaterialused.Ifapplicable,statetheseedstockcentreandcataloguenumber.If
 plantspecimenswerecollectedfromthefield,describethecollectionlocation,dateandsamplingprocedures.
Novelplantgenotypes De scribethemethodsbywhichallnovelplantgenotypeswereproduced.Thisincludesthosegeneratedbytransgenicapproaches,
 geneediting,chemical/radiation-basedmutagenesisandhybridization.Fortransgeniclines,describethetransformationmethod,the
 numberofindependentlinesanalyzedandthegenerationuponwhichexperimentswereperformed.Forgene-editedlines,describe
 theeditorused,theendogenoussequencetargetedforediting,thetargetingguideRNAsequence(ifapplicable)andhowtheeditor
Authentication wa
 Desscaripbpeliaendy.authenticationproceduresforeachseedstockusedornovelgenotypegenerated.Describeanyexperimentsusedto
 assesstheeffectofamutationand,whereapplicable,howpotentialsecondaryeffects(e.g.secondsiteT-DNAinsertions,mosiacism,
 off-targetgeneediting)wereexamined.


 April2023


 3
